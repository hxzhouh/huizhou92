<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head>

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name="baidu-site-verification" content="codeva-3VTxLtnqFP" /><meta name='description' content="Go å¯èƒ½ä¼šå¼•å…¥ SwissTable ä½œä¸º map çš„æ ‡å‡†å®ç°ï¼Œä»¥æé«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ï¼ğŸš€ #Golang #SwissTable #ç¼–ç¨‹">
<title> SwissTable ä¼šæˆä¸º Golang std mapå˜›ï¼Ÿ</title>

<link rel='canonical' href='https://huizhou92.com/zh-cn/p/swisstable-%E4%BC%9A%E6%88%90%E4%B8%BA-golang-std-map%E5%98%9B/'>

<link rel="stylesheet" href="/scss/style.min.7a8650e463f7bf12cc86f69675ab60349b39aa794883f0c4ba0547d9e71cd5b5.css"><meta property='og:title' content=" SwissTable ä¼šæˆä¸º Golang std mapå˜›ï¼Ÿ">
<meta property='og:description' content="Go å¯èƒ½ä¼šå¼•å…¥ SwissTable ä½œä¸º map çš„æ ‡å‡†å®ç°ï¼Œä»¥æé«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ï¼ğŸš€ #Golang #SwissTable #ç¼–ç¨‹">
<meta property='og:url' content='https://huizhou92.com/zh-cn/p/swisstable-%E4%BC%9A%E6%88%90%E4%B8%BA-golang-std-map%E5%98%9B/'>
<meta property='og:site_name' content='huizhou92&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='go' /><meta property='article:tag' content='SwissTable' /><meta property='article:published_time' content='2024-09-30T11:25:51&#43;08:00'/><meta property='article:modified_time' content='2024-09-30T11:25:48&#43;08:00'/><meta property='og:image' content='https://images.hxzhouh.com/blog-images/2024/09/f08c74aea8485d51d461d18494df416e.png' />
<meta name="twitter:site" content="@piaopiaopig">
    <meta name="twitter:creator" content="@piaopiaopig"><meta name="twitter:title" content=" SwissTable ä¼šæˆä¸º Golang std mapå˜›ï¼Ÿ">
<meta name="twitter:description" content="Go å¯èƒ½ä¼šå¼•å…¥ SwissTable ä½œä¸º map çš„æ ‡å‡†å®ç°ï¼Œä»¥æé«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ï¼ğŸš€ #Golang #SwissTable #ç¼–ç¨‹"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://images.hxzhouh.com/blog-images/2024/09/f08c74aea8485d51d461d18494df416e.png' />
    <link rel="shortcut icon" href="/favicon.png" />

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-JMPMQ2QREG"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-JMPMQ2QREG');
        }
      </script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9000447749076746"
crossorigin="anonymous"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9000447749076746"
     crossorigin="anonymous"></script>

<script defer src="https://cloud.umami.is/script.js" data-website-id="e4ee8ffe-fb88-4635-9953-715598461baa"></script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/zh-cn/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_e52293b5d2b8c5f7.jpeg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/zh-cn">huizhou92&#39;s Blog</a></h1>
            <h2 class="site-description">Backend Engineer With A Focus On Golang, Cloud Computing, Data Storage And Efficiency Tools. Lifelong Learner.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/hxzhouh'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/piaopiaopig'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/zh-cn/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/zh-cn/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/zh-cn/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/zh-cn/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/zh-cn/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://huizhou92.com/" >English</option>
                                
                                    <option value="https://huizhou92.com/zh-cn/" selected>ä¸­æ–‡</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>


<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-9000447749076746"
   data-ad-slot="5063552270"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
<script>
   (adsbygoogle = window.adsbygoogle || []).push({});
</script>


    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ä¼ ç»Ÿ-hashtable">ä¼ ç»Ÿ <code>hashtable</code></a>
      <ol>
        <li><a href="#é“¾è¡¨æ³•">é“¾è¡¨æ³•</a></li>
        <li><a href="#çº¿æ€§æ¢æµ‹æ³•">çº¿æ€§æ¢æµ‹æ³•</a></li>
        <li><a href="#go-hashmap-å¦‚ä½•å­˜å‚¨æ•°æ®">Go Hashmap å¦‚ä½•å­˜å‚¨æ•°æ®</a></li>
      </ol>
    </li>
    <li><a href="#swisstableä¸€ç§é«˜æ•ˆçš„-hashtable-å®ç°æ–¹å¼">SwissTableï¼Œä¸€ç§é«˜æ•ˆçš„ <code>hashtable</code> å®ç°æ–¹å¼</a>
      <ol>
        <li><a href="#swisstable-çš„åŸºæœ¬ç»“æ„">SwissTable çš„åŸºæœ¬ç»“æ„</a></li>
        <li><a href="#æ·»åŠ æ•°æ®">æ·»åŠ æ•°æ®</a></li>
        <li><a href="#swisstable-çš„ä¼˜åŠ¿">SwissTable çš„ä¼˜åŠ¿</a></li>
      </ol>
    </li>
    <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
    <li><a href="#å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</a></li>
  </ol>
</nav>
        </div>
    </section>


<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-9000447749076746"
   data-ad-slot="5063552270"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
<script>
   (adsbygoogle = window.adsbygoogle || []).push({});
</script>
            
        
              
              <section class="widget">
                 
                <div class="widget-content">
                    <iframe frameborder="0"
                        src="https://support.nodeget.com/page/promotion?id=30795"
                        style="border-radius:8px; height: 270px; width: 100%; display: block;"></iframe>
                        
                </div>
            </section>
    </aside>
  




<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-9000447749076746"
   data-ad-slot="5063552270"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
<script>
   (adsbygoogle = window.adsbygoogle || []).push({});
</script>



            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/zh-cn/p/swisstable-%E4%BC%9A%E6%88%90%E4%B8%BA-golang-std-map%E5%98%9B/">
                
                    <img src="https://images.hxzhouh.com/blog-images/2024/09/f08c74aea8485d51d461d18494df416e.png" loading="lazy" alt="Featured image of post  SwissTable ä¼šæˆä¸º Golang std mapå˜›ï¼Ÿ" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/zh-cn/categories/tech/" style="background-color: #2a9d8f; color: #fff;">
                æŠ€æœ¯
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/zh-cn/p/swisstable-%E4%BC%9A%E6%88%90%E4%B8%BA-golang-std-map%E5%98%9B/"> SwissTable ä¼šæˆä¸º Golang std mapå˜›ï¼Ÿ</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Go å¯èƒ½ä¼šå¼•å…¥ SwissTable ä½œä¸º map çš„æ ‡å‡†å®ç°ï¼Œä»¥æé«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ï¼ğŸš€ #Golang #SwissTable #ç¼–ç¨‹
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 30, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 4 åˆ†é’Ÿ
                </time>
            </div>
        
         
        <div class="article-analysic">&nbsp
    
            <?xml version="1.0" encoding="utf-8"?>

<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg fill="#000000" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  
  <g id="read">
    <g>
      <path  d="M12,18.883a10.8,10.8,0,0,1-9.675-5.728,2.6,2.6,0,0,1,0-2.31A10.8,10.8,0,0,1,12,5.117a10.8,10.8,0,0,1,9.675,5.728h0a2.6,2.6,0,0,1,0,2.31A10.8,10.8,0,0,1,12,18.883ZM12,6.117a9.787,9.787,0,0,0-8.78,5.176,1.586,1.586,0,0,0,0,1.415A9.788,9.788,0,0,0,12,17.883a9.787,9.787,0,0,0,8.78-5.176,1.584,1.584,0,0,0,0-1.414h0A9.787,9.787,0,0,0,12,6.117Z"/>
      <path  d="M12,16.049A4.049,4.049,0,1,1,16.049,12,4.054,4.054,0,0,1,12,16.049Zm0-7.1A3.049,3.049,0,1,0,15.049,12,3.052,3.052,0,0,0,12,8.951Z"/>
      <circle  cx="12" cy="12" r="2.028"/>
    </g>
  </g>
</svg>
            <time class="article-words">
                <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span> &nbspReads</span>
            </time>
        </div>
    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://huizhou92.com/p/swisstable-a-high-performance-hash-table-implementation/" class="link">English</a>
                
            </div>
        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <p>2022å¹´ï¼Œå­—èŠ‚è·³åŠ¨ç»™<code>Golang</code>æäº†<a class="link" href="https://github.com/golang/go/issues/54766"  target="_blank" rel="noopener"
    >issue</a>å»ºè®®æŠŠmapçš„åº•å±‚å®ç°æ”¹æˆSwissTableçš„ã€‚2023å¹´ï¼Œdoltå†™äº†ä¸€ç¯‡åšå®¢<a class="link" href="https://www.dolthub.com/blog/2023-03-28-swiss-map/"  target="_blank" rel="noopener"
    >SwissMap: A smaller, faster Golang Hash Table</a> åˆ†äº«ä»–ä»¬ è®¾è®¡äº†ä¸€ä¸ªåŸºäºSwissTable çš„ Map ,å¼•èµ·äº†å¹¿æ³›çš„å…³æ³¨ã€‚ç›®å‰ Go æ ¸å¿ƒå›¢é˜Ÿå·²ç»å¼€å§‹é‡æ–°å®¡è§†  <code>swisstable</code> è®¾è®¡ï¼Œåœ¨<a class="link" href="https://github.com/golang/go/blob/6a730e1ef0b7f312fe01815086a2eb5a25739f2d/src/runtime/map_swiss.go#L7"  target="_blank" rel="noopener"
    ><code>runtime</code></a>ä¸­ä¹Ÿæ·»åŠ äº†éƒ¨åˆ†ä»£ç ï¼Œè¶ç€å‡æœŸï¼Œåˆšå¥½æœ‰æ—¶é—´æ·±å…¥äº†è§£ä¸€ä¸‹åŸç†ï¼Œè·Ÿ<code>runtime map</code> ç›¸æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒå¯èƒ½ä¼šæˆä¸º<code>map</code>çš„æ ‡å‡†å®ç°ã€‚</p>
<!-- more-->
<blockquote>
<p>This article was first published in the Medium MPP plan. If you are a Medium user, please follow me on <a class="link" href="https://medium.huizhou92.com/"  target="_blank" rel="noopener"
    >Medium</a>. Thank you very much.</p></blockquote>
<p>æœ¬æ–‡ä¸ä¼šå®Œå…¨è§£é‡Š<code>hashtable</code>æˆ–è€…<code>swisstable</code>çš„åŸç†ã€‚æ‚¨éœ€è¦å¯¹<code>hashtable</code> æœ‰ä¸€å®šçš„äº†è§£ã€‚</p>
<p>å“ˆå¸Œè¡¨æä¾›äº†ä¸€ä¸ª<code>key</code>åˆ°å¯¹åº”<code>value</code>çš„æ˜ å°„ï¼Œé€šè¿‡ä¸€ä¸ª<code>hashå‡½æ•°</code>æŠŠ<code>key</code>è½¬æ¢æˆæŸä¸ªâ€œä½ç½®â€œï¼Œä»è¿™ä¸ªä½ç½®ä¸Šå¯ä»¥ç›´æ¥æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„valueï¼Œ</p>
<h2 id="ä¼ ç»Ÿ-hashtable">ä¼ ç»Ÿ <code>hashtable</code>
</h2><p>å“ˆå¸Œè¡¨æä¾›äº†ä¸€ä¸ª<code>key</code>åˆ°å¯¹åº”valueçš„æ˜ å°„ï¼Œé€šè¿‡ä¸€ä¸ª<code>hashå‡½æ•°</code>æŠŠkeyè½¬æ¢æˆæŸä¸ªâ€œä½ç½®â€œï¼Œä»è¿™ä¸ªä½ç½®ä¸Šå¯ä»¥ç›´æ¥æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„valueã€‚ä¸è¿‡ï¼Œå³ä½¿<code>hashå‡½æ•°</code>å†å®Œç¾ï¼ŒæŠŠæ— é™çš„<code>key</code>æ˜ å°„åˆ°ä¸€ä¸ªæœ‰é™å¤§å°çš„å†…å­˜ç©ºé—´å†…ä¹Ÿè¿˜æ˜¯ä¸å¯é¿å…å¾—ä¼šäº§ç”Ÿå†²çªï¼šä¸¤ä¸ªä¸åŒçš„<code>key</code>ä¼šè¢«æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®ã€‚  ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¼ ç»Ÿçš„<code>hashtable</code>æœ‰å¥½å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæœ€å¸¸è§çš„è§£å†³å†²çªçš„åŠæ³•æœ‰â€œé“¾è¡¨æ³•â€å’Œâ€œçº¿æ€§æ¢æµ‹æ³•â€ã€‚</p>
<h3 id="é“¾è¡¨æ³•">é“¾è¡¨æ³•
</h3><p>é“¾è¡¨æ³•æ˜¯æœ€å¸¸è§çš„ï¼Œå®ƒçš„ä¸­å¿ƒæ€æƒ³åœ¨äºå¦‚æœkeyæ˜ å°„åˆ°äº†ç›¸åŒçš„ä½ç½®ï¼Œé‚£ä¹ˆå°±æŠŠè¿™äº›keyå’Œvalueå­˜åœ¨ä¸€å¼ é“¾è¡¨é‡Œã€‚æŸ¥æ‰¾çš„æ—¶å€™å…ˆç”¨hashå‡½æ•°è®¡ç®—å¾—åˆ°ä½ç½®ï¼Œç„¶åå†ä»å­˜æ”¾åœ¨è¯¥ä½ç½®ä¸Šçš„é“¾è¡¨é‡Œä¸€ä¸ªä¸ªéå†æ‰¾åˆ°keyç›¸ç­‰çš„æ¡ç›®ã€‚å®ƒçš„ç»“æ„ç±»ä¼¼è¿™æ ·ï¼š<br>
figure 1: æ‹‰é“¾æ³•å®ç° <code>hashtable</code><br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/096dbea584499aaf3f2adb6111a89b0e.png"
	
	
	
	loading="lazy"
	
		alt="Pasted image 20240929145217"
	
	
><br>
é“¾è¡¨æ³•å®ç°å¾ˆç®€å•ï¼Œæ²¡é‚£ä¹ˆå¤šè¾¹ç•Œæ¡ä»¶è¦è€ƒè™‘,æ’å…¥æ•°æ®å’Œåˆ é™¤æ•°æ®å¾ˆå¿«ï¼Œæ’å…¥ç”¨é“¾è¡¨çš„å¤´æ’æ³•ï¼Œåˆ é™¤åªéœ€è¦ç§»åŠ¨éƒ¨åˆ†èŠ‚ç‚¹çš„nextæŒ‡é’ˆã€‚æ­¤å¤–ï¼Œé“¾è¡¨æ³•èƒ½é‡‡å–æ‰©å®¹ä¹‹å¤–çš„æ‰‹æ®µé˜»æ­¢æŸ¥è¯¢æ€§èƒ½é€€åŒ–ï¼Œæ¯”å¦‚æŠŠè¿‡é•¿é“¾è¡¨è½¬æ¢æˆæœç´¢æ ‘ç­‰ã€‚é“¾è¡¨æ³•çš„ç¼ºç‚¹æ˜¯æœ¬èº«å¯¹ç¼“å­˜ä¸å¤Ÿå‹å¥½ï¼Œå†²çªè¾ƒå¤šçš„æ—¶å€™ç¼“å­˜å‘½ä¸­ç‡è¾ƒä½ä»è€Œå½±å“æ€§èƒ½ã€‚ä¸åŒçš„<code>slot</code>ä¹‹é—´æ•°æ®åœ¨å†…å­˜é‡Œçš„è·¨åº¦è¾ƒå¤§ï¼Œæ•°æ®ç»“æ„æ•´ä½“çš„ç©ºé—´å±€éƒ¨æ€§è¾ƒå·®ã€‚</p>
<h3 id="çº¿æ€§æ¢æµ‹æ³•">çº¿æ€§æ¢æµ‹æ³•
</h3><p>çº¿æ€§æ¢æµ‹æ˜¯å¦ä¸€ç§å¸¸è§çš„å“ˆå¸Œè¡¨å†²çªè§£å†³æ–¹æ³•ã€‚å®ƒè§£å†³å†²çªçš„æ–¹å¼äºé“¾è¡¨æ³•ä¸åŒï¼Œåœ¨é‡åˆ°hashå†²çªçš„æ—¶å€™ï¼Œå®ƒä¼šä»å†²çªçš„ä½ç½®å¼€å§‹å‘åä¸€ä¸ªä¸ªæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºä½ï¼Œæˆ–è€…æ²¡æ‰¾åˆ°ç„¶åç´¢å¼•å›åˆ°äº†å†²çªå‘ç”Ÿçš„ä½ç½®ï¼Œè¿™æ—¶ä¼šè¿›è¡Œæ‰©å®¹ç„¶åå†é‡æ–°æ‰§è¡Œä¸Šè¿°æ’å…¥æµç¨‹ã€‚<br>
Figure 2 ï¼šçº¿æ€§æ¢æµ‹æ³•æ·»åŠ æ•°æ® åŠ¨ç”»æ¼”ç¤º<br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/bfb5cfbb7f611f0fed2f4d58c0eceaf4.gif"
	
	
	
	loading="lazy"
	
		alt="çº¿æ€§æ¢ æµ‹æ³•åŠ¨ç”»æ¼”ç¤º"
	
	
></p>
<p>æŸ¥æ‰¾ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œé¦–å…ˆé€šè¿‡hashå‡½æ•°è®¡ç®—å¾—åˆ°å…ƒç´ åº”è¯¥åœ¨çš„ä½ç½®ï¼Œç„¶åä»è¿™ä¸ªä½ç½®å¼€å§‹ä¸€ä¸ªä¸ªæ¯”è¾ƒkeyæ˜¯å¦ç›¸ç­‰ï¼Œé‡åˆ°è¢«åˆ é™¤çš„å…ƒç´ å°±è·³è¿‡ï¼Œé‡åˆ°ç©ºçš„slotå°±åœæ­¢æœç´¢ï¼Œè¿™è¡¨ç¤ºå…ƒç´ ä¸åœ¨è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­ã€‚æ‰€ä»¥åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯æ ‡è®°åˆ é™¤ã€‚<br>
Figure 3: çº¿æ€§æ¢æµ‹æ³•æŸ¥æ‰¾æ•°æ®æ¼”ç¤º<br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/f0052b66a4e66fb5e9558c4e48601bd7.gif"
	
	
	
	loading="lazy"
	
		alt="çº¿æ€§æ¢æµ‹æ³•æŸ¥æ‰¾æ¼”ç¤º"
	
	
><br>
çº¿æ€§æ¢æµ‹æ³• çš„æ—¶é—´å¤æ‚åº¦è·Ÿé“¾è¡¨æ³•å·®ä¸å¤šï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯å¯¹ç¼“å­˜å‹å¥½ï¼Œç°åœ¨å¯ä»¥ç”¨æ•°ç»„ä¹‹ç±»çš„ç´§å¯†æ•°æ®ç»“æ„å®ç°ã€‚åŒæ—¶ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p>
<ol>
<li>å®ç°å¤æ‚ï¼Œä¸€ä¸ª<code>slot</code>æœ‰å…ƒç´ ã€ç©ºã€è¢«åˆ é™¤è¿™ä¸‰ç§çŠ¶æ€</li>
<li>hashå†²çªæ˜¯è¿é”å¼çš„ï¼Œä¸€å¤„å†²çªå¯èƒ½ä¼šè¿ç»­å½±å“å¤šå¤„ï¼Œæœ€ç»ˆå¯¼è‡´æ’å…¥åŒæ ·çš„æ•°æ®ï¼Œå®ƒæ‰©å®¹çš„æ¬¡æ•°ä¼šæ¯”é“¾è¡¨æ³•æ›´å¤šï¼Œæœ€ç»ˆå¯èƒ½ä¼šç”¨æ‰æ›´å¤šçš„å†…å­˜ã€‚</li>
<li>å› ä¸ºå†²çªä¼šé€ æˆåç»­æ’å…¥å’Œåˆ é™¤çš„è¿é”ååº”ï¼Œæ‰€ä»¥æŸ¥æ‰¾è¿‡ç¨‹é€€åŒ–åˆ°<code>O(n)</code>çš„æ¦‚ç‡æ›´å¤§ï¼Œè€Œä¸”æ²¡æ³•åƒé“¾è¡¨æ³•é‚£æ ·æŠŠæœ‰å¤§é‡å†²çªçš„åœ°æ–¹è½¬æ¢æˆæœç´¢æ ‘ä¹‹ç±»çš„ç»“æ„ã€‚<br>
å› ä¸ºåˆ é™¤å…ƒç´ éº»çƒ¦ï¼ŒåŠ ä¸Šå†²çªä¼šæœ‰è¿é”å½±å“ï¼Œæ‰€ä»¥å¾ˆå¤šåº“å®ç°çš„<code>hashtable</code>éƒ½æ˜¯ç”¨çš„é“¾è¡¨æ³•ã€‚ä¸è¿‡å³ä½¿æœ‰è¿™ä¹ˆå¤šç¼ºç‚¹ï¼Œå…‰ç¼“å­˜å‹å¥½å’Œå†…å­˜åˆ©ç”¨ç‡é«˜åœ¨ç°ä»£è®¡ç®—æœºä¸Šå°±æ˜¯éå¸¸å¤§çš„æ€§èƒ½ä¼˜åŠ¿äº†ï¼Œæ‰€ä»¥åƒ<code>golang</code>å’Œ<code>python</code>éƒ½ä¼šä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•çš„è¿‘ä¼¼å˜ç§æ¥å®ç°å“ˆå¸Œè¡¨ã€‚</li>
</ol>
<h3 id="go-hashmap-å¦‚ä½•å­˜å‚¨æ•°æ®">Go Hashmap å¦‚ä½•å­˜å‚¨æ•°æ®
</h3><p>æˆ‘ä»¬é¦–å…ˆæ¥å›å¿†ä¸€ä¸‹<code> Go Map</code> æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ã€‚<br>
figure 4: go map ç¤ºæ„å›¾<br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/02e000848c6f7972b40e08647618d409.png"
	
	
	
	loading="lazy"
	
		alt="Pasted image 20240927142057"
	
	
><br>
å¿«é€Ÿæ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>Go <code>map</code> åº•å±‚é€šè¿‡å“ˆå¸Œå‡½æ•°å°† key æ˜ å°„åˆ°å¤šä¸ª <code>bucket</code>ä¸­ã€‚æ¯ä¸ª <code>bucket</code> å…·æœ‰å›ºå®šæ•°é‡çš„é”®å€¼å¯¹<code>slot</code>ï¼Œç”¨äºå­˜å‚¨ key å’Œå¯¹åº”çš„ valueã€‚</li>
<li>æ¯ä¸ª <code>bucket</code> èƒ½å­˜å‚¨ 8ä¸ªé”®å€¼å¯¹ã€‚å½“å†²çªå‘ç”Ÿæ—¶ï¼ˆå³å¤šä¸ª key è¢«æ˜ å°„åˆ°åŒä¸€ä¸ª <code>bucket</code>ï¼‰ï¼Œè¿™äº› key å’Œ value ä¼šåœ¨åŒä¸€ä¸ª <code>bucket</code> å†…å­˜å‚¨ã€‚</li>
<li><code>map</code> é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼Œå¹¶æ ¹æ®å“ˆå¸Œå€¼æ‰¾åˆ°å¯¹åº”çš„ <code>bucket</code>ã€‚</li>
<li>å¦‚æœæŸä¸ª <code>bucket</code> è¢«å¡«æ»¡ï¼ˆ8 ä¸ª<code>slot</code>å·²ç”¨å®Œï¼‰ï¼Œä¼šç”Ÿæˆä¸€ä¸ª <code>overflow bucket</code>ï¼Œç»§ç»­å­˜å‚¨æ–°çš„é”®å€¼å¯¹ã€‚</li>
<li>æŸ¥æ‰¾æ—¶æ•°æ®æ—¶ï¼Œé¦–å…ˆè®¡ç®—è¦æŸ¥æ‰¾çš„ key çš„å“ˆå¸Œå€¼ï¼Œç„¶åç¡®å®šè¯¥å“ˆå¸Œå€¼æ˜ å°„åˆ°çš„ <code>bucket</code>ã€‚Go ä¼šæ£€æŸ¥æ¯ä¸ª<code>slot</code>ï¼Œå¦‚æœ <code>bucket</code> ä¸­å­˜åœ¨<code>overflow bucket</code>ï¼Œä¼šé¡ºåºæ£€æŸ¥<code>overflow bucket</code>ä¸­çš„ keyã€‚</li>
</ul>
<h2 id="swisstableä¸€ç§é«˜æ•ˆçš„-hashtable-å®ç°æ–¹å¼">SwissTableï¼Œä¸€ç§é«˜æ•ˆçš„ <code>hashtable</code> å®ç°æ–¹å¼
</h2><p><code>SwissTable</code> æ˜¯ä¸€ç§åŸºäºæ”¹è¿›çš„çº¿æ€§æ¢æµ‹æ³•çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ”¹è¿›å“ˆå¸Œè¡¨çš„ç»“æ„å’Œå…ƒæ•°æ®å­˜å‚¨ï¼Œä¼˜åŒ–äº†æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ã€‚SwissTable é‡‡ç”¨äº†ä¸€ç§æ–°çš„å…ƒæ•°æ®æ§åˆ¶æœºåˆ¶ï¼Œå¤§å¹…å‡å°‘äº†ä¸å¿…è¦çš„é”®æ¯”è¾ƒæ“ä½œï¼ŒåŒæ—¶åˆ©ç”¨ SIMD æŒ‡ä»¤æå‡ååé‡ã€‚</p>
<p>æˆ‘ä»¬å›é¡¾äº†ä¸€ä¸‹ä¸¤ç§å¸¸è§çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå®ƒä»¬è¦ä¹ˆæµªè´¹å†…å­˜ä¸”å¯¹ç¼“å­˜ä¸å‹å¥½ï¼›è¦ä¹ˆå‘ç”Ÿå†²çªåä¼šæ›´å®¹æ˜“å¯¼è‡´æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œæ€§èƒ½ä¸‹é™ã€‚è¿™è¿˜æ˜¯åœ¨æœ‰â€œå®Œç¾å“ˆå¸Œå‡½æ•°â€çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ç”¨äº†ä¸ªä¸é‚£ä¹ˆå¥½çš„å“ˆå¸Œå‡½æ•°ï¼Œé‚£ä¼šå¯¼è‡´keyå†²çªçš„æ¦‚ç‡å¤§å¤§ä¸Šå‡ï¼Œæ€§èƒ½é—®é¢˜ä¼šæ›´åŠ æ˜æ˜¾ï¼Œæœ€åçš„æƒ…å†µä¸‹æ€§èƒ½ç”šè‡³ä¼šä¸å¦‚åœ¨æ•°ç»„é‡Œè¿›è¡Œçº¿æ€§æœç´¢ã€‚</p>
<p>ä¸šç•Œå¼€å§‹å¯»æ‰¾ä¸€ç§æ—¢å¯¹ç¼“å­˜å‹å¥½åˆä¸ä¼šè®©æŸ¥æ‰¾æ€§èƒ½é€€åŒ–çš„å¤ªå‰å®³çš„å“ˆå¸Œè¡¨ç®—æ³•ã€‚å¤§å¤šæ•°äººçš„ç ”ç©¶æ–¹å‘æ˜¯å¼€å‘æ›´å¥½çš„å“ˆå¸Œå‡½æ•°ï¼Œåœ¨è®©å“ˆå¸Œå‡½æ•°ä¸æ–­æ¥è¿‘â€œå®Œç¾å“ˆå¸Œå‡½æ•°â€çš„å“è´¨çš„åŒæ—¶ç”¨å„ç§æ‰‹æ®µä¼˜åŒ–è®¡ç®—æ€§èƒ½ï¼›å¦å¤–ä¸€äº›äººåœ¨æ”¹è¿›å“ˆå¸Œè¡¨æœ¬èº«çš„ç»“æ„åŠ›æ±‚åœ¨ç¼“å­˜å‹å¥½ã€æ€§èƒ½å’Œå†…å­˜ç”¨é‡ä¸Šæ‰¾åˆ°å¹³è¡¡ã€‚<a class="link" href="https://abseil.io/about/design/swisstables"  target="_blank" rel="noopener"
    ><code>swisstable</code></a>å°±å±äºåè€…ã€‚<br>
<code>swisstable</code>çš„æ—¶é—´å¤æ‚åº¦å’Œçº¿æ€§æ¢æµ‹æ³•çš„å·®ä¸å¤šï¼Œç©ºé—´å¤æ‚åº¦ä»‹äºé“¾è¡¨æ³•å’Œçº¿æ€§æ¢æµ‹ä¹‹é—´ã€‚  <code>swisstable</code>çš„å®ç°æœ‰å¾ˆå¤šï¼Œæˆ‘ä¸»è¦åŸºäº<a class="link" href="https://github.com/dolthub/swiss/tree/main"  target="_blank" rel="noopener"
    >dolthub/swiss</a>è¿™ä¸ªå®ç°è¿›è¡Œç®€è¦çš„ä»‹ç»ã€‚</p>
<h3 id="swisstable-çš„åŸºæœ¬ç»“æ„">SwissTable çš„åŸºæœ¬ç»“æ„
</h3><p>è™½ç„¶åå­—å˜äº†ï¼Œå®é™…ä¸Š<code>swisstable</code>ä¾ç„¶æ˜¯<code>hashtable</code>ï¼Œè€Œä¸”ä½¿ç”¨æ”¹è¿›çš„çº¿æ€§æ¢æµ‹æ³•æ¥è§£å†³hashå†²çªã€‚  æ‰€ä»¥å¤§å®¶åº”è¯¥èƒ½æƒ³è±¡åˆ°ï¼Œswisstableçš„åº•å±‚åº”è¯¥ä¹Ÿæ˜¯ä¸ªç±»ä¼¼æ•°ç»„çš„ç»“æ„ã€‚æœ‰äº†è¿™æ ·å¤§è‡´çš„æ¨¡ç³Šå°è±¡å°±å¯ä»¥äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹<a class="link" href="https://github.com/dolthub/swiss/blob/f4b2babd2bc1cf0a2d66bab4e579ca35b6202338/map.go#L27"  target="_blank" rel="noopener"
    >swisstable</a>çš„ç»“æ„äº†:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Map</span><span class="p">[</span><span class="nx">K</span> <span class="nx">comparable</span><span class="p">,</span> <span class="nx">V</span> <span class="kt">any</span><span class="p">]</span> <span class="kd">struct</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">ctrl</span>     <span class="p">[]</span><span class="nx">metadata</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">groups</span>   <span class="p">[]</span><span class="nx">group</span><span class="p">[</span><span class="nx">K</span><span class="p">,</span> <span class="nx">V</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">hash</span>     <span class="nx">maphash</span><span class="p">.</span><span class="nx">Hasher</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">resident</span> <span class="kt">uint32</span>   <span class="c1">//currently occupied slots in the hash map </span>
</span></span><span class="line"><span class="cl">    <span class="nx">dead</span>     <span class="kt">uint32</span>  <span class="c1">//A tombstone indicates a slot that was previously occupied but has been deleted </span>
</span></span><span class="line"><span class="cl">    <span class="nx">limit</span>    <span class="kt">uint32</span>  <span class="c1">// This field represents the maximum number of elements that can be added to the hash map before it needs to be resized. It is calculated based on the load factor and the number of groups.</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1">// metadata is the h2 metadata array for a group.  </span>
</span></span><span class="line"><span class="cl"><span class="c1">// find operations first probe the controls bytes  </span>
</span></span><span class="line"><span class="cl"><span class="c1">// to filter candidates before matching keys  </span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">metadata</span> <span class="p">[</span><span class="nx">groupSize</span><span class="p">]</span><span class="kt">int8</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1">// group is a group of 16 key-value pairstype group[K comparable, V any] struct {  </span>
</span></span><span class="line"><span class="cl">    <span class="nx">keys</span>   <span class="p">[</span><span class="nx">groupSize</span><span class="p">]</span><span class="nx">K</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">values</span> <span class="p">[</span><span class="nx">groupSize</span><span class="p">]</span><span class="nx">V</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>swisstable</code> çš„å®ç°ä¸­ï¼Œctrl æ˜¯ä¸€ä¸ª <code>[]metadata</code> ï¼Œ<code>[]metadata</code> è·Ÿ<code> []group[K, V]</code> æ•°é‡å¯¹åº” ã€‚æ¯ä¸ª<code>group</code>æœ‰8ä¸ª<code>slot</code></p>
<p>hashä¼šè¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼š<code>57bits</code>é•¿åº¦çš„ä¸ºH1ï¼Œç”¨äºç¡®å®šä»å“ªä¸ª<code>groups</code>å¼€å§‹æ¢æµ‹ï¼Œå‰©ä¸‹çš„<code>7bits</code>å«åšH2ï¼Œåˆšå¥½æ”¾åœ¨<code>metadata</code>ä¸­ï¼Œ è¢«ç”¨ä½œæ˜¯å½“å‰keyçš„å“ˆå¸Œç‰¹å¾å€¼ï¼Œç”¨äºåé¢çš„æŸ¥æ‰¾å’Œè¿‡æ»¤ã€‚<br>
<code>swisstable</code>æ¯”ä¼ ç»Ÿå“ˆå¸Œè¡¨æ›´å¿«çš„ç§˜è¯€å°±åœ¨äºè¿™äº›è¢«å«åš<code>ctrl</code>çš„<code>metadata</code>ã€‚æ§åˆ¶ä¿¡æ¯ä¸»è¦æ˜¯ä¸‹é¢è¿™å‡ ç§ï¼š</p>
<ul>
<li>slotæ˜¯å¦ä¸ºç©º: <code>0b10000000</code></li>
<li>sloté‡Œçš„å…ƒç´ æ˜¯å¦å·²ç»è¢«åˆ é™¤: <code>0b11111110</code></li>
<li>sloté‡Œå­˜çš„é”®å€¼å¯¹çš„keyçš„å“ˆå¸Œç‰¹å¾ï¼ˆH2ï¼‰<code>0bh2</code><br>
å¯¹äºç©ºã€åˆ é™¤è¿™å‡ ç§ç‰¹æ®ŠçŠ¶æ€ï¼Œå¯¹åº”çš„å€¼éƒ½æ˜¯ç‰¹æ„è®¾ç½®çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨åé¢çš„åŒ¹é…ä¸­ä½¿ç”¨<code>SIMD</code>æŒ‡ä»¤ï¼Œè·å¾—æœ€é«˜çš„æ€§èƒ½ã€‚</li>
</ul>
<p>æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤éƒ½æ˜¯åŸºäºè¿™äº›<code>ctrl</code>çš„ï¼Œå®ƒä»¬éå¸¸å°ï¼Œå¯ä»¥å°½é‡å¤šçš„è¢«æ”¾å…¥CPUçš„é«˜é€Ÿç¼“å­˜ï¼ŒåŒæ—¶åˆåŒ…å«äº†è¶³å¤Ÿçš„ä¿¡æ¯ä»¥æ»¡è¶³å“ˆå¸Œè¡¨çš„å¢åˆ æ”¹æŸ¥ã€‚è€Œslotå°±åªç”¨æ¥å­˜æ•°æ®ï¼Œ<code>ctrl</code>å’Œ<code>slot</code>ä¸€ä¸€å¯¹åº”ï¼Œæ§åˆ¶ä¿¡æ¯åœ¨<code>ctrl</code>é‡Œçš„ç´¢å¼•å°±æ˜¯å¯¹åº”çš„æ•°æ®åœ¨sloté‡Œçš„ç´¢å¼•ï¼Œä¸‹é¢ä»¥æ·»åŠ æ•°æ®ä¸ºä¾‹ï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤ éƒ½å·®ä¸å¤šã€‚</p>
<h3 id="æ·»åŠ æ•°æ®">æ·»åŠ æ•°æ®
</h3><p><code>swisstable</code> æ·»åŠ æ•°æ®çš„è¿‡ç¨‹åˆ†æˆå‡ ä¸ªæ­¥éª¤ã€‚</p>
<ol>
<li>è®¡ç®—å“ˆå¸Œå€¼å¹¶åˆ†å‰²ä¸º <code>h1</code> å’Œ <code>h2</code> , æ ¹æ® <code>h1</code> ç¡®å®šå¼€å§‹æ¢æµ‹çš„<code>groups</code> ,</li>
<li>ä½¿ç”¨ <code>metaMatchH2</code> æ£€æŸ¥å½“å‰ç»„ä¸­çš„ <code>metadata</code> æ˜¯å¦æœ‰åŒ¹é…çš„<code> h2</code>ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ <code>h2</code>ï¼Œåˆ™è¿›ä¸€æ­¥æ£€æŸ¥å¯¹åº”æ§½ä½ä¸­çš„é”®æ˜¯å¦ä¸ç›®æ ‡é”®ç›¸åŒã€‚å¦‚æœç›¸åŒï¼Œåˆ™æ›´æ–°å€¼å¹¶è¿”å›ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é”®ï¼Œä½¿ç”¨ <code>metaMatchEmpty</code> æ£€æŸ¥å½“å‰ç»„ä¸­æ˜¯å¦æœ‰ç©ºé—²<code>slot</code>ã€‚å¦‚æœæœ‰<code>slot</code>ï¼Œåˆ™æ’å…¥æ–°çš„é”®å€¼å¯¹ï¼Œå¹¶æ›´æ–° <code>metadata</code> å’Œ <code>resident</code> è®¡æ•°ã€‚</li>
<li>å¦‚æœå½“å‰ç»„æ²¡æœ‰ç©ºé—²æ§½ä½ï¼Œè¿›è¡Œçº¿æ€§æ¢æµ‹ï¼Œæ£€æŸ¥ä¸‹ä¸€ä¸ª<code>groups</code>ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Map</span><span class="p">[</span><span class="nx">K</span><span class="p">,</span> <span class="nx">V</span><span class="p">])</span> <span class="nf">Put</span><span class="p">(</span><span class="nx">key</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">V</span><span class="p">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">resident</span> <span class="o">&gt;=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">limit</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">       <span class="nx">m</span><span class="p">.</span><span class="nf">rehash</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nf">nextSize</span><span class="p">())</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">hi</span><span class="p">,</span> <span class="nx">lo</span> <span class="o">:=</span> <span class="nf">splitHash</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nf">Hash</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">g</span> <span class="o">:=</span> <span class="nf">probeStart</span><span class="p">(</span><span class="nx">hi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">{</span> <span class="c1">// inlined find loop  </span>
</span></span><span class="line"><span class="cl">       <span class="nx">matches</span> <span class="o">:=</span> <span class="nf">metaMatchH2</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">m</span><span class="p">.</span><span class="nx">ctrl</span><span class="p">[</span><span class="nx">g</span><span class="p">],</span> <span class="nx">lo</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">       <span class="k">for</span> <span class="nx">matches</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">s</span> <span class="o">:=</span> <span class="nf">nextMatch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">matches</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">keys</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">{</span> <span class="c1">// update  </span>
</span></span><span class="line"><span class="cl">             <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">keys</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">key</span>  
</span></span><span class="line"><span class="cl">             <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">values</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">value</span>  
</span></span><span class="line"><span class="cl">             <span class="k">return</span>  
</span></span><span class="line"><span class="cl">          <span class="p">}</span>  
</span></span><span class="line"><span class="cl">       <span class="p">}</span>  
</span></span><span class="line"><span class="cl">       <span class="c1">// |key| is not in group |g|,  </span>
</span></span><span class="line"><span class="cl">       <span class="c1">// stop probing if we see an empty slot       matches = metaMatchEmpty(&amp;m.ctrl[g])  </span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="nx">matches</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span> <span class="c1">// insert  </span>
</span></span><span class="line"><span class="cl">          <span class="nx">s</span> <span class="o">:=</span> <span class="nf">nextMatch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">matches</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">keys</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">key</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">values</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">value</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">m</span><span class="p">.</span><span class="nx">ctrl</span><span class="p">[</span><span class="nx">g</span><span class="p">][</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nb">int8</span><span class="p">(</span><span class="nx">lo</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">m</span><span class="p">.</span><span class="nx">resident</span><span class="o">++</span>  
</span></span><span class="line"><span class="cl">          <span class="k">return</span>  
</span></span><span class="line"><span class="cl">       <span class="p">}</span>  
</span></span><span class="line"><span class="cl">       <span class="nx">g</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">// linear probing  </span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="nx">g</span> <span class="o">&gt;=</span> <span class="nb">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">))</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">g</span> <span class="p">=</span> <span class="mi">0</span>  
</span></span><span class="line"><span class="cl">       <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">metaMatchH2</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">metadata</span><span class="p">,</span> <span class="nx">h</span> <span class="nx">h2</span><span class="p">)</span> <span class="nx">bitset</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="c1">// https://graphics.stanford.edu/~seander/bithacks.html##ValueInWord  </span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">hasZeroByte</span><span class="p">(</span><span class="nf">castUint64</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">^</span> <span class="p">(</span><span class="nx">loBits</span> <span class="o">*</span> <span class="nb">uint64</span><span class="p">(</span><span class="nx">h</span><span class="p">)))</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">nextMatch</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">bitset</span><span class="p">)</span> <span class="kt">uint32</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">s</span> <span class="o">:=</span> <span class="nb">uint32</span><span class="p">(</span><span class="nx">bits</span><span class="p">.</span><span class="nf">TrailingZeros64</span><span class="p">(</span><span class="nb">uint64</span><span class="p">(</span><span class="o">*</span><span class="nx">b</span><span class="p">)))</span>  
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">b</span> <span class="o">&amp;=</span> <span class="p">^(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="nx">s</span><span class="p">)</span> <span class="c1">// clear bit |s|  </span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">s</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>   <span class="c1">// div by 8  </span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶ï¼Œæ­¥éª¤å¾ˆå°‘ï¼Œä½†æ˜¯é‡Œé¢ä½¿ç”¨äº†æ¯”è¾ƒå¤æ‚çš„ä½è¿ç®—ï¼ŒæŒ‰ç…§æ­£å¸¸çš„æµç¨‹ï¼Œéœ€è¦æŠŠ<code>h2</code> è·Ÿæ‰€æœ‰çš„ å¯¹æ¯”ï¼Œç›´åˆ°æ‰¾åˆ°æˆ‘ä»¬è¦çš„ç›®æ ‡ã€‚<code>swisstable</code> ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆå·§å¦™çš„æ–¹å¼æ¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚</p>
<ul>
<li>é¦–å…ˆå°†<code>h2 * 0x0101010101010101</code>  å¾—åˆ°ä¸€ä¸ªuint64ï¼Œè¿™æ ·å°±èƒ½ä¸€æ¬¡æ€§å¯¹æ¯” 8ä¸ª <code>ctrl</code></li>
<li>ç„¶åè·Ÿ<code>meta</code> åš xor è¿è¡Œã€‚ å¦‚æœ <code>h2</code> å­˜åœ¨äº <code>metadata</code> ä¸­ã€‚é‚£ä¹ˆå¯¹åº”çš„bit å°±æ˜¯<code>0b00000000</code> ï¼Œ <code>metaMatchH2</code> çš„ä½œç”¨ï¼Œå¯ä»¥ç”¨ ä¸‹é¢çš„å•å…ƒæµ‹è¯•ç†è§£ï¼Œ</li>
<li><code>nextMatch</code>  ç”¨äºç¡®å®š key åœ¨groupä¸­çš„çš„å…·ä½“ä½ç½®ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestMetaMatchH2</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">metaData</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">metadata</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">metaData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="kt">int8</span><span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">}</span> <span class="c1">// Imitate ctrl</span>
</span></span><span class="line"><span class="cl">	<span class="nx">m</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">metaData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h</span> <span class="o">:=</span> <span class="mh">0x7f</span>
</span></span><span class="line"><span class="cl">	<span class="nx">metaUint64</span> <span class="o">:=</span> <span class="nf">castUint64</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">h2Pattern</span> <span class="o">:=</span> <span class="nx">loBits</span> <span class="o">*</span> <span class="nb">uint64</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">xorResult</span> <span class="o">:=</span> <span class="nx">metaUint64</span> <span class="p">^</span> <span class="nx">h2Pattern</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;metaUint64: %b\n&#34;</span><span class="p">,</span> <span class="nx">xorResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nf">hasZeroByte</span><span class="p">(</span><span class="nx">xorResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;r: %b\n&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">r</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">	    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">nextMatch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">r</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">----</span>
</span></span><span class="line"><span class="cl"><span class="nx">output</span>
</span></span><span class="line"><span class="cl"><span class="c1">// metaUint64: 00000000 11111110 11111110 11111110 0000000 01111111 01111111 00000000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// r: 10000000 00000000 00000000 00000000 10000000 00000000 00000000 10000000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 0</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 3</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 7</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="swisstable-çš„ä¼˜åŠ¿">SwissTable çš„ä¼˜åŠ¿
</h3><p>çœ‹å®ŒSwissTableçš„å®ç°ï¼Œå¯ä»¥æ€»ç»“ä¸ºä¸‹é¢å‡ ç‚¹ï¼š</p>
<ul>
<li>å¯¹<code>hashtable</code>çš„æ“ä½œä»<code>slot</code>è½¬ç§»åˆ°äº†<code>ctrl</code>ä¸Šï¼Œ<code>ctrl</code>æ›´å°æ›´å®¹æ˜“è¢«å¡«å…¥CPUçš„é«˜é€Ÿç¼“å­˜ï¼Œå› æ­¤æ¯”ç›´æ¥åœ¨<code>slot</code>ä¸Šæ“ä½œæ›´å¿«ï¼Œå³ä½¿éœ€è¦å¤šä»˜å‡ºä¸€æ¬¡ä»<code>ctrl</code>å¾—åˆ°ç´¢å¼•åå†å»æŸ¥æ‰¾<code>slot</code>çš„ä»£ä»·ã€‚</li>
<li>è®°å½•å“ˆå¸Œç‰¹å¾å€¼ï¼Œå‡å°‘äº†æ— æ„ä¹‰çš„keyç­‰å€¼æ¯”è¾ƒï¼Œè¿™æ˜¯çº¿æ€§æ¢æµ‹æ³•æ€§èƒ½ä¸‹é™çš„ä¸»è¦å…ƒå‡¶ã€‚</li>
<li>å¯¹<code>slot</code>çš„æŸ¥æ‰¾å’Œæ“ä½œæ˜¯é€šè¿‡<code>ctrl</code>æ‰¹é‡è¿›è¡Œçš„ï¼Œå•ä½æ—¶é—´å†…ååé‡æœ‰æ˜¾è‘—æå‡ã€‚</li>
<li>æ ‡å¿—ä½çš„å€¼å’Œæ•´ä¸ªæ•°æ®ç»“æ„çš„å†…å­˜å¸ƒå±€éƒ½ä¸º<code>SIMD</code>è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥æ€§èƒ½ä¼˜åŠ¿ã€‚</li>
<li>å¯¹<code>slot</code>ä¹Ÿæœ‰ä¼˜åŒ–ï¼Œæ¯”å¦‚å¯¹å¤ªå¤§çš„æ•°æ®ä¼šå‹ç¼©å­˜å‚¨ä»¥æé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚<br>
<code>swisstable</code> è§£å†³äº†ç©ºé—´å±€éƒ¨æ€§é—®é¢˜çš„åŸºç¡€ä¸Šï¼Œè¿˜åˆ©ç”¨äº†ç°ä»£CPUçš„ç‰¹æ€§æ‰¹é‡æ“ä½œå…ƒç´ ï¼Œæ‰€ä»¥æ€§èƒ½ä¼šæœ‰é£è·ƒèˆ¬çš„æå‡ã€‚</li>
</ul>
<p>æœ€ååœ¨æˆ‘æœ¬åœ°<code>macbook m1</code> ï¼ˆä¸æ”¯æŒSIMDï¼‰ä¸Šè·‘benchmarkï¼Œç»“æœå¦‚ä¸‹ï¼Œåœ¨å¤§mapåœºæ™¯ä¸‹ï¼Œ<code>swisstable</code> æ€§èƒ½æœ‰æ¯”è¾ƒæ˜æ˜¾çš„æå‡ã€‚<br>
Figure 5:  <code>swisstable</code> å®˜æ–¹benchmark<br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/a59e237341d6076ed79395bd1d1b5f90.png"
	
	
	
	loading="lazy"
	
		alt="Pasted image 20240930110905"
	
	
></p>
<h2 id="æ€»ç»“">æ€»ç»“
</h2><p>ç›®å‰go å®˜æ–¹è¿˜æ²¡æœ‰<code>swisstable</code> çš„å®ç°ï¼Œ ä½†æ˜¯å…³äºå®ƒçš„è®¨è®ºä¸€ç›´å†ç»§ç»­ï¼Œç›®å‰ç¤¾åŒºä¹Ÿæœ‰å‡ ç§å®ç°ã€‚æ¯”å¦‚<a class="link" href="https://github.com/mhmtszr/concurrent-swiss-map"  target="_blank" rel="noopener"
    >concurrent-swiss-map</a> ï¼Œ<a class="link" href="https://github.com/dolthub/swiss"  target="_blank" rel="noopener"
    >swiss</a> ç­‰ã€‚<br>
ä¸è¿‡å®ç°éƒ½ä¸æ˜¯ç‰¹åˆ«å®Œç¾ï¼Œæ¯”å¦‚åœ¨å°map åœºæ™¯ä¸‹<code>swisstable</code> çš„æ€§èƒ½ç”šè‡³æ¯”ä¸ä¸Š <code>runtime_map</code> ç­‰ã€‚ä½†æ˜¯<code>swisstable</code> è¡¨ç°å‡ºæ¥çš„æ½œåŠ›å·²ç»åœ¨å…¶ä»–è¯­è¨€ä¸Šçš„è¡¨ç°ï¼Œè¯´æ˜å®ƒå€¼å¾—æˆ‘ä»¬æœŸå¾…ã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£
</h2><ul>
<li>dolthub <a class="link" href="https://www.dolthub.com/blog/2023-03-28-swiss-map/"  target="_blank" rel="noopener"
    >https://www.dolthub.com/blog/2023-03-28-swiss-map/</a></li>
<li>swisstable åŸç† <a class="link" href="https://abseil.io/about/design/swisstables"  target="_blank" rel="noopener"
    >https://abseil.io/about/design/swisstables</a></li>
<li>é¦–æ¬¡æå‡º<code>swisstable</code>çš„cppconæ¼”è®²ï¼š<a class="link" href="https://www.youtube.com/watch?v=ncHmEUmJZf4"  target="_blank" rel="noopener"
    >https://www.youtube.com/watch?v=ncHmEUmJZf4</a></li>
<li>é’ˆå¯¹<code>swisstable</code>ç®—æ³•çš„ä¸€äº›æ”¹è¿›ï¼š<a class="link" href="https://www.youtube.com/watch?v=JZE3_0qvrMg"  target="_blank" rel="noopener"
    >https://www.youtube.com/watch?v=JZE3_0qvrMg</a></li>
<li>ä½è¿ç®—åŸç†:  <a class="link" href="http://graphics.stanford.edu/~seander/bithacks.html##ValueInWord"  target="_blank" rel="noopener"
    >http://graphics.stanford.edu/~seander/bithacks.html##ValueInWord</a></li>
<li>hash å‡½æ•°å¯¹æ¯”ï¼š <a class="link" href="https://aras-p.info/blog/2016/08/09/More-Hash-Function-Tests/"  target="_blank" rel="noopener"
    >https://aras-p.info/blog/2016/08/09/More-Hash-Function-Tests/</a></li>
<li>å¦å¤–ä¸€ç¯‡ä½è¿ç®—åŸç†çš„æ–‡ç«  <a class="link" href="https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/"  target="_blank" rel="noopener"
    >https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/</a></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/zh-cn/tags/go/">Go</a>
        
            <a href="/zh-cn/tags/swisstable/">SwissTable</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            æœ€åæ›´æ–°äº Sep 30, 2024 11:25 CST
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-9000447749076746"
   data-ad-slot="5063552270"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
<script>
   (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/zh-cn/p/go-1.26-%E9%BB%91%E7%A7%91%E6%8A%80%E8%B7%B3%E8%BF%87-gc-%E7%9B%B4%E6%8E%A5%E9%87%8A%E6%94%BE%E5%86%85%E5%AD%98%E6%80%A7%E8%83%BD%E9%A3%99%E5%8D%87-200/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go 1.26 é»‘ç§‘æŠ€ï¼šè·³è¿‡ GC ç›´æ¥é‡Šæ”¾å†…å­˜ï¼Œæ€§èƒ½é£™å‡ 200%</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/zh-cn/p/green-tea-gc-golang-%E7%9A%84-zgc/">
        
        
            <div class="article-image">
                
                    <img src="https://images.hxzhouh.com/blog-images/2025/05/fb6313678681ee8e97a05ee521bd0e20.png" loading="lazy" data-key="green-tea-gc-golang-%E7%9A%84-zgc" data-hash="https://images.hxzhouh.com/blog-images/2025/05/fb6313678681ee8e97a05ee521bd0e20.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Green Tea GC: Golang çš„ ZGCï¼Ÿ</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/zh-cn/p/%E8%AF%91grpc%E4%B8%91%E9%99%8B%E7%9A%84%E9%83%A8%E5%88%86/">
        
        

        <div class="article-details">
            <h2 class="article-title">ã€è¯‘ã€‘ï¼šgRPCä¸‘é™‹çš„éƒ¨åˆ†</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/zh-cn/p/golang-http-%E6%94%AF%E6%8C%81-negotiateformat/">
        
        

        <div class="article-details">
            <h2 class="article-title">Golang http æ”¯æŒ NegotiateFormat</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/zh-cn/p/go124-%E9%99%A4%E4%BA%86%E6%A0%87%E5%87%86%E5%BA%93%E4%B9%8B%E5%A4%96%E6%82%A8%E4%B9%9F%E8%AE%B8%E5%BA%94%E8%AF%A5%E6%9B%B4%E5%8A%A0%E5%85%B3%E6%B3%A8-go-%E5%B7%A5%E5%85%B7%E7%9A%84%E5%8F%98%E5%8C%96/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go1.24: é™¤äº†æ ‡å‡†åº“ä¹‹å¤–ï¼Œæ‚¨ä¹Ÿè®¸åº”è¯¥æ›´åŠ å…³æ³¨ Go å·¥å…·çš„å˜åŒ–</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>


    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2026 Copyright Â© 2023 huizhou92
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
    <script src="/js/adblock-detection.js" defer></script>
     
	
	<div class="busuanzi-footer">
	<span id="busuanzi_container_site_pv">
		Total site visits: <span id="busuanzi_value_site_pv"></span>
	</span>
	<span id="busuanzi_container_site_uv">
		Total Visitors: <span id="busuanzi_value_site_uv"></span>
	</span>
	</div></footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
