<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Http on huizhou92&#39;s Blog</title>
        <link>https://huizhou92.com/zh-cn/tags/http/</link>
        <description>Recent content in Http on huizhou92&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Copyright © 2023 huizhou92</copyright>
        <lastBuildDate>Tue, 11 Nov 2025 18:57:08 +0800</lastBuildDate><atom:link href="https://huizhou92.com/zh-cn/tags/http/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>HTTP/3：看似无处不在，实则难觅踪影</title>
        <link>https://huizhou92.com/zh-cn/p/http3%E7%9C%8B%E4%BC%BC%E6%97%A0%E5%A4%84%E4%B8%8D%E5%9C%A8%E5%AE%9E%E5%88%99%E9%9A%BE%E8%A7%85%E8%B8%AA%E5%BD%B1/</link>
        <pubDate>Tue, 11 Nov 2025 18:57:08 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/http3%E7%9C%8B%E4%BC%BC%E6%97%A0%E5%A4%84%E4%B8%8D%E5%9C%A8%E5%AE%9E%E5%88%99%E9%9A%BE%E8%A7%85%E8%B8%AA%E5%BD%B1/</guid>
        <description>&lt;img src="https://httptoolkit.com/images/header-images/http-toolkit-assets/h-sign-opt-640.WEBP" alt="Featured image of post HTTP/3：看似无处不在，实则难觅踪影" /&gt;&lt;p&gt;HTTP/3 的研发至少可追溯至 2016 年，而其底层传输协议 QUIC 更是由 Google 在 2013 年率先提出。如今这两项技术均已确立国际标准：&lt;a class=&#34;link&#34; href=&#34;https://caniuse.com/http3&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;strong&gt;获得 95% 浏览器的支持&lt;/strong&gt;&lt;/a&gt;，**Cloudflare 处理的 HTTP 请求中已有 &lt;a class=&#34;link&#34; href=&#34;https://radar.cloudflare.com/adoption-and-usage&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;32% 采用该协议**&lt;/a&gt;，并且在 HTTP Archive 数据集中，有 &lt;strong&gt;&lt;a class=&#34;link&#34; href=&#34;https://almanac.httparchive.org/en/2024/http#discovering-http3-support&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;35% 的网站&lt;/a&gt;&lt;/strong&gt; 宣称支持HTTP/3 (通过 alt-svc 或 DNS）。&lt;/p&gt;
&lt;p&gt;我们不仅成功开发出全新一代 HTTP 协议，更已将超三分之一的网络流量迁移至该协议——这堪称里程碑式的进展。&lt;/p&gt;
&lt;p&gt;然而矛盾的是，包括 Node.js、Go、Rust、Python 和 Ruby 在内的主流编程语言，其标准库均未内置对 QUIC 或 HTTP/3 的支持。Curl 虽然近期&lt;a class=&#34;link&#34; href=&#34;https://curl.se/docs/http3.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;新增了相关功能&lt;/a&gt;，但仍标记为实验性质且在大多数发行版中默认禁用。某些语言虽有第三方实现库，但均处于实验阶段，且无法与核心网络 API 协同工作。更值得注意的是，尽管移动网络是 HTTP/3 的关键应用场景，Android 主流 HTTP 库 OkHttp &lt;a class=&#34;link&#34; href=&#34;https://github.com/square/okhttp/blob/59cbf64f6ba98e2c8f95bf9db41dc47ad2232f94/okhttp/src/commonJvmAndroid/kotlin/okhttp3/Protocol.kt#L86-L94&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;仍明确不支持该协议&lt;/a&gt;。Nginx 仅提供&lt;a class=&#34;link&#34; href=&#34;https://nginx.org/en/docs/quic.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;实验性模块&lt;/a&gt;且默认关闭，Apache 既无支持计划也未公布路线图，而 Kubernetes 最流行的反向代理 Ingress-Nginx 更是&lt;a class=&#34;link&#34; href=&#34;https://github.com/kubernetes/ingress-nginx/issues/4760&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;完全放弃了支持计划&lt;/a&gt;，将相关功能移交至尚未发布的新一代项目。&lt;/p&gt;
&lt;p&gt;事实上，目前几乎找不到能完整支持 HTTP/3 的流行开源工具——这项技术的推广部署仍处于萌芽阶段。&lt;/p&gt;
&lt;p&gt;这种矛盾现象背后究竟隐藏着什么？&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;本文假设读者已了解 HTTP/1.1、HTTP/2 与 HTTP/3 的核心差异。如需入门资料，curl 创始人 Daniel Stenberg 撰写的 &lt;a class=&#34;link&#34; href=&#34;https://http2-explained.haxx.se/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http2-explained&lt;/a&gt; 与 &lt;a class=&#34;link&#34; href=&#34;https://http3-explained.haxx.se/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http3-explained&lt;/a&gt; 是绝佳参考。&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;让我们回溯根本：为什么这很重要？如果浏览器和大型 CDN 已支持 HTTP/3，其他客户端或服务端实现是否还有必要跟进？&lt;/p&gt;
&lt;p&gt;有观点认为，&lt;a class=&#34;link&#34; href=&#34;https://byroot.github.io/ruby/performance/2025/02/24/http2-past-the-load-balancer.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;在负载均衡器之后使用 HTTP/2 意义有限&lt;/a&gt;。其核心论点是：H&lt;strong&gt;TTP/2 的多路复用主要解决延迟与&lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Head-of-line_blocking&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;队头阻塞 (Head-of-line blocking)&lt;/a&gt; 问题，但在延迟极低的内部网络中，通过长连接即可规避这些问题&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;这个论点同样适用于 HTTP/3：它对高延迟、多请求的 浏览器-CDN 场景有益，但对其他场景价值有限。但即使只考虑 HTTP/1.1 与 HTTP/2，多路复用优势的现实情况也更加复杂：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;响应延迟不仅来自网络传输：服务端处理缓慢同样会阻塞 TCP 连接&lt;/li&gt;
&lt;li&gt;负载均衡器常与后端服务异地部署（例如通过全球 CDN 提供服务时，动态请求仍需回源至独立后端）&lt;/li&gt;
&lt;li&gt;长连接 TCP 连接并不可靠：即使在数据中心内，网络故障也时有发生，“保持连接”只是理想状态。HTTP 协议本身也会强制中断连接（如响应体传输中途失败时）&lt;/li&gt;
&lt;li&gt;流量波动会导致 TCP 连接数失衡：要么长期维持冗余连接池，要么在峰值时建立新连接，面临慢启动、往返延迟与 TLS 握手开销&lt;/li&gt;
&lt;li&gt;非网站类流量（移动应用、API 服务、物联网设备）同样面临网络延迟与服务端阻塞问题，这些场景都能从 HTTP/2/3 中获益&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;除多路复用外，HTTP/2 还有更多跨场景优势：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;头部压缩（HTTP/2 的 &lt;a class=&#34;link&#34; href=&#34;https://blog.cloudflare.com/hpack-the-silent-killer-feature-of-http-2/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;HPACK&lt;/a&gt; 与 HTTP/3 的 &lt;a class=&#34;link&#34; href=&#34;https://datatracker.ietf.org/doc/rfc9204/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;QPACK&lt;/a&gt;）显著减少传输数据量，对内部长连接效果尤为明显&lt;/li&gt;
&lt;li&gt;双向流通信（仅 HTTP/2/3 支持）开启全新交互模式，gRPC 即基于此特性构建，类似 WebSocket 但完全兼容 HTTP 语义&lt;/li&gt;
&lt;li&gt;请求优先级控制允许服务端优化资源分配，这对负载均衡器与后端通信同样重要&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HTTP/3 更在以下方面实现突破：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过取消 TCP 严格包序，使单个流独立传输，避免流间阻塞&lt;/li&gt;
&lt;li&gt;结合 TLS 1.3 与 QUIC 实现 &lt;a class=&#34;link&#34; href=&#34;https://blog.cloudflare.com/even-faster-connection-establishment-with-quic-0-rtt-resumption/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;0RTT 握手&lt;/a&gt;，首次请求无需等待 TLS 握手完成&lt;/li&gt;
&lt;li&gt;降低传输开销与连接数，减少客户端能耗与服务端资源消耗&lt;/li&gt;
&lt;li&gt;支持&lt;a class=&#34;link&#34; href=&#34;https://pulse.internetsociety.org/blog/how-quic-helps-you-seamlessly-connect-to-different-networks&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;连接迁移&lt;/a&gt;，IP 变更时保持会话连续性，未来甚至支持多路径传输&lt;/li&gt;
&lt;li&gt;采用 &lt;a class=&#34;link&#34; href=&#34;https://research.google/pubs/bbr-congestion-based-congestion-control-2/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;BBR 拥塞控制&lt;/a&gt;等先进算法，提升网络适应能力&lt;/li&gt;
&lt;li&gt;为 &lt;a class=&#34;link&#34; href=&#34;https://github.com/w3c/webtransport/blob/main/explainer.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;WebTransport&lt;/a&gt; 提供基础，实现低延迟双向通信的同时解决 WebSocket 的队头阻塞等问题&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;实际测试数据同样佐证其价值。RequestMetric 的&lt;a class=&#34;link&#34; href=&#34;https://requestmetrics.com/web-performance/http3-is-fast/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;基准测试&lt;/a&gt;显示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://httptoolkit.com/images/posts/http-toolkit-assets/requestmetrics-http3-opt-1080.WEBP&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;各类网站在 HTTP/1.1、2、3 下的加载时间对比，显示 HTTP/3 显著提速&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;Fastly 也在实际环境中观测到首字节时间的大幅优化：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://httptoolkit.com/images/posts/http-toolkit-assets/fastly-http3-opt-1080.WEBP&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Fastly 实测 HTTP/3 降低首字节时间 18%&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;显然，这是一项&lt;strong&gt;具有实质价值&lt;/strong&gt;的技术。&lt;/p&gt;
&lt;p&gt;既然 HTTP/3 已完成标准化、获得广泛支持并经过实践检验，没理由不让所有开发者都能通过常用开发工具链享受这些技术红利。&lt;/p&gt;
&lt;h2 id=&#34;割裂的网络&#34;&gt;割裂的网络
&lt;/h2&gt;&lt;p&gt;现实却截然相反：尽管技术优势明显且网络流量占比显著，大多数开发者仍难以端到端部署 HTTP/3。这种现象折射出互联网长期存在的分层现状。如今的网络流量已分化为两种形态：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;超大规模流量&lt;/strong&gt;：主流浏览器与特定移动应用通过精心调优的客户端，与少数科技巨头的自有基础设施或大型 CDN 通信&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;长尾流量&lt;/strong&gt;：后端服务、中小型应用、物联网设备、学术研究等多样化场景，依赖开源生态与共享技术栈&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这两大阵营的核心差异包括：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;长尾流量规模更大： &lt;a class=&#34;link&#34; href=&#34;https://almanac.httparchive.org/en/2024/cdn#cdn-adoption&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;67%&lt;/a&gt; 的网页请求直连源站，Cloudflare 2024 年数据表明其 &lt;a class=&#34;link&#34; href=&#34;https://blog.cloudflare.com/application-security-report-2024-update/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;30% 流量来自自动化程序，60% 属于 API 调用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;长尾生态天然碎片化，主要依赖志愿维护的开源项目&lt;/li&gt;
&lt;li&gt;超大规模阵营由少数利益相关方主导，能快速协调标准制定与落地&lt;/li&gt;
&lt;li&gt;商业动机高度集中：性能毫秒级提升直接关联企业收益&lt;/li&gt;
&lt;li&gt;长尾完全依赖开源实现，而超大规模玩家拥有自研定制的实力与资源&lt;/li&gt;
&lt;li&gt;版本迭代速度差异巨大：长尾工具注重稳定性，超大规模阵营追求快速迭代&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这种分化并非善恶对立——从工程角度，HTTP/3 正是跨组织协作的卓越成果。但问题在于：当下一代网络技术由少数群体定义并优先服务自身需求时，大多数开发者只能通过购买 CDN 服务间接获取技术红利，这无疑限制了创新生态的健康发展。&lt;/p&gt;
&lt;h2 id=&#34;openssl-与-quic-的兼容困局&#34;&gt;OpenSSL 与 QUIC 的兼容困局
&lt;/h2&gt;&lt;p&gt;这种分化最具体的体现就是 OpenSSL 对 QUIC 的支持策略。作为最基础的 TLS 库，OpenSSL 的态度直接影响整个开源生态。事件脉络如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BoringSSL 2018 年即提供 QUIC API&lt;/li&gt;
&lt;li&gt;OpenSSL 长期缺失该功能，催生 QuicTLS 等兼容分支&lt;/li&gt;
&lt;li&gt;现有 HTTP/3 实现生态（Quiche、msh3、nghttp3 等）均基于 BoringSSL 或分支构建&lt;/li&gt;
&lt;li&gt;OpenSSL 3.2 起采用不兼容的实现方案，导致生态分裂&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;curl 的项目现状图清晰展现了这种割裂：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://httptoolkit.com/images/posts/http-toolkit-assets/http3-components-in-curl-opt-1080.WEBP&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;curl 支持的 HTTP/3 组件体系，现有实现均构建于 OpenSSL 替代方案之上&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;对大多数项目而言，放弃 OpenSSL 转向其他方案成本过高，这导致它们至今无法原生支持 QUIC。Node.js 曾&lt;a class=&#34;link&#34; href=&#34;https://github.com/nodejs/node/issues/57379&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;讨论切换方案&lt;/a&gt;，但考虑到系统兼容性、长期支持等现实因素，最终难以实施。&lt;/p&gt;
&lt;p&gt;这正是双层网络差异的典型体现：&lt;strong&gt;开源工具必须保持向后兼容，而超大规模玩家可以为了技术先进性承担更大变更成本&lt;/strong&gt;。&lt;/p&gt;
&lt;h2 id=&#34;未来走向&#34;&gt;未来走向
&lt;/h2&gt;&lt;p&gt;组织架构差异正在导致互联网技术栈的分裂。虽然长尾场景未必急需 HTTP/3，但若放任不管，可能导致：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;性能差距扩大：超大规模网站在移动网络环境下体验优势加剧&lt;/li&gt;
&lt;li&gt;工具链分化：前端框架等基础设施逐渐以 HTTP/3 为默认假设&lt;/li&gt;
&lt;li&gt;技术壁垒形成：缺乏 HTTP/3 支持可能成为被限流或验证的依据&lt;/li&gt;
&lt;li&gt;生态恶性循环：长尾需求逐渐被技术演进忽略&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所有这些都还有一段距离，而且是相当假设性的！我怀疑其中一些假设会在某种程度上发生，但可能性范围很广。不过值得注意的是，这不仅仅适用于 HTTP/3：少数 CDN 和网络客户端的这种集中和协调很容易在许多其他类型的技术改进中也以类似的方式发生。&lt;/p&gt;
&lt;p&gt;至少对于 HTTP/3 而言，我希望这里能有一个愉快的解决方案来及时改善这种分裂，尽管我不知道它是否会足够快以避免明显的后果。许多 QUIC 和 HTTP/3 的外部库和实验性实现会随着时间的推移而成熟，而且我认为最终 (我真的非常希望) OpenSSL QUIC API 的分裂将得到解决，从而为 许多基于 OpenSSL 的环境中的 QUIC 支持打开大门，要么通过适配器支持这两种方法，要么通过直接支持 OpenSSL 模型的新 HTTP/3 和 QUIC 堆栈。&lt;br&gt;
然而，所有这一切都不会在今天发生，因此不幸的是，如果您想在您的应用程序中端到端地使用 HTTP/3，您可能还需要经历一段时间的艰难时期。敬请关注。&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/zh-cn/p/http3%E7%9C%8B%E4%BC%BC%E6%97%A0%E5%A4%84%E4%B8%8D%E5%9C%A8%E5%AE%9E%E5%88%99%E9%9A%BE%E8%A7%85%E8%B8%AA%E5%BD%B1/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;本文长期链接&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;如果您觉得我的博客对你有帮助，请通过 &lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/index.xml&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RSS&lt;/a&gt;订阅我。&lt;/li&gt;
&lt;li&gt;或者在&lt;a class=&#34;link&#34; href=&#34;https://x.com/@piaopiaopig&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;X&lt;/a&gt;上关注我。&lt;/li&gt;
&lt;li&gt;如果您有&lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;账号，能给我个关注嘛？我的文章第一时间都会发布在Medium。&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        
    </channel>
</rss>
