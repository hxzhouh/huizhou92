<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Go on huizhou92&#39;s Blog</title>
        <link>https://huizhou92.com/zh-cn/tags/go/</link>
        <description>Recent content in Go on huizhou92&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Copyright Â© 2023 huizhou92</copyright>
        <lastBuildDate>Mon, 05 May 2025 16:30:26 +0800</lastBuildDate><atom:link href="https://huizhou92.com/zh-cn/tags/go/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Green Tea GC: Golang çš„ ZGCï¼Ÿ</title>
        <link>https://huizhou92.com/zh-cn/p/green-tea-gc-golang-%E7%9A%84-zgc/</link>
        <pubDate>Mon, 05 May 2025 16:30:26 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/green-tea-gc-golang-%E7%9A%84-zgc/</guid>
        <description>&lt;img src="https://images.hxzhouh.com/blog-images/2025/05/fb6313678681ee8e97a05ee521bd0e20.png" alt="Featured image of post Green Tea GC: Golang çš„ ZGCï¼Ÿ" /&gt;&lt;p&gt;è¿‘å¹´æ¥ï¼ŒGo è¯­è¨€çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰æœºåˆ¶è™½ç„¶ç»å†äº†å¤šä¸ªç‰ˆæœ¬ä¼˜åŒ–ï¼Œä½†å®ƒçš„æ€§èƒ½ç“¶é¢ˆï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘ä¸å¤§è§„æ¨¡å†…å­˜åœºæ™¯ä¸‹ï¼Œä¾ç„¶æ˜¯å¼€å‘è€…å…³æ³¨çš„é‡ç‚¹ã€‚æœ€è¿‘ï¼ŒGo å®˜æ–¹åœ¨ GitHub ä¸Šæå‡ºçš„ &lt;strong&gt;Green Tea GC&lt;/strong&gt;ï¼ˆ#73581ï¼‰å¼•å‘äº†çƒ­è®®ï¼šå®ƒèƒ½å¦è¿›ä¸€æ­¥è§£å†³ Go GC çš„è€—æ—¶é—®é¢˜ï¼Ÿæœ¬æ–‡å°†æ·±å…¥è§£æ Go GC çš„è®¾è®¡ã€ç¼ºç‚¹ã€å®æµ‹è¡¨ç°ï¼Œå¹¶å¸¦ä½ äº†è§£ Green Tea GC çš„æŠ€æœ¯çªç ´ã€‚&lt;/p&gt;
&lt;!-- more--&gt;
&lt;h2 id=&#34;-go-gc-çš„è®¾è®¡ä¸å®ç°&#34;&gt;ğŸ“¦ Go GC çš„è®¾è®¡ä¸å®ç°
&lt;/h2&gt;&lt;p&gt;è‡ª Go 1.5 èµ·ï¼ŒGo ä½¿ç”¨å¹¶å‘æ ‡è®°-æ¸…é™¤ï¼ˆconcurrent mark-sweepï¼‰ç®—æ³•ï¼Œç»“åˆâ€œä¸‰è‰²æ ‡è®°â€æ¨¡å‹ä¸ Yuasa å†™å±éšœã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼ŒGo GC ä¼šåœ¨åå°å¹¶å‘åœ°éå†å †å†…å­˜ï¼Œæ ‡è®°å¯è¾¾å¯¹è±¡ï¼Œå¹¶é€æ­¥æ¸…é™¤æœªè¢«å¼•ç”¨çš„å†…å­˜å—ã€‚æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­ï¼ŒGo è¿½æ±‚&lt;strong&gt;ä½å»¶è¿Ÿã€ä½åœé¡¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;âœ… å¹¶å‘æ ‡è®°ã€å¹¶å‘æ¸…é™¤&lt;br&gt;
âœ… ä¸ä¼šç§»åŠ¨å¯¹è±¡ï¼ˆå³ no compactionï¼‰&lt;br&gt;
âœ… æŒ‰ spanï¼ˆå†…å­˜å—ï¼‰åˆ†æ‰¹æ¸…æ‰«ï¼Œå‡å°‘å•æ¬¡ STWï¼ˆStop-the-Worldï¼‰æ—¶é•¿&lt;/p&gt;
&lt;p&gt;è¿™ç§è®¾è®¡çš„ç›´æ¥å¥½å¤„æ˜¯ï¼šåº”ç”¨å¤§éƒ¨åˆ†æ—¶é—´èƒ½ä¸ GC å¹¶è¡Œå·¥ä½œï¼Œæœ€å¤§åœé¡¿æ—¶é—´é€šå¸¸ä½äºæ¯«ç§’çº§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;-go-gc-çš„å·²çŸ¥é—®é¢˜&#34;&gt;ğŸš§ Go GC çš„å·²çŸ¥é—®é¢˜
&lt;/h2&gt;&lt;p&gt;è™½ç„¶ Go GC çš„å»¶è¿Ÿè¡¨ç°ä¼˜ç§€ï¼Œä½†å®ƒåœ¨è€—æ—¶å’Œæ‰©å±•æ€§ä¸Šä»æœ‰å‡ ä¸ªç¡¬ä¼¤ï¼Œå°¤å…¶ä½“ç°åœ¨ï¼š&lt;/p&gt;
&lt;p&gt;1ï¸âƒ£ &lt;strong&gt;å†…å­˜è®¿é—®ä½æ•ˆ&lt;/strong&gt;&lt;br&gt;
GC çš„æ ‡è®°é˜¶æ®µä¼šè·¨å¯¹è±¡è·³è·ƒï¼Œå¯¼è‡´ CPU é¢‘ç¹ cache missã€ç­‰å¾…å†…å­˜ï¼Œçº¦ 35% çš„ GC CPU å‘¨æœŸè¢«è€—åœ¨â€œç­‰å†…å­˜â€ã€‚è¿™åœ¨ NUMA æ¶æ„æˆ–å¤šæ ¸å¤§å†…å­˜æœºå™¨ä¸Šå°¤ä¸ºæ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;2ï¸âƒ£ &lt;strong&gt;ç¼ºä¹åˆ†ä»£æ”¶é›†&lt;/strong&gt;&lt;br&gt;
Go GC æ²¡æœ‰åˆ†ä»£æœºåˆ¶ï¼Œæ‰€æœ‰å¯¹è±¡ä¸€è§†åŒä»ï¼Œè¿™åœ¨é«˜åˆ†é…ç‡åœºæ™¯ä¸‹æ˜¾å¾—ç¬¨é‡ã€‚Pinterest å·¥ç¨‹å¸ˆæ›¾æŒ‡å‡ºï¼Œå†…å­˜å‹åŠ›ä¸€æ—¦å¢å¤§ï¼ŒGC å°±ä¼šæš´å¢ CPU æ¶ˆè€—ï¼Œå¼•å‘å»¶è¿Ÿæ¿€å¢ã€‚&lt;/p&gt;
&lt;p&gt;3ï¸âƒ£ &lt;strong&gt;é¢‘ç¹ GC å¸¦æ¥çš„ CPU å ç”¨&lt;/strong&gt;&lt;br&gt;
Twitch å·¥ç¨‹å›¢é˜Ÿæ›¾æŠ¥å‘Šï¼šå³ä¾¿åœ¨ä¸­å°å †å†…å­˜ä¸‹ï¼ˆ&amp;lt;450â€¯MiBï¼‰ï¼Œç³»ç»Ÿç¨³æ€ä¸‹æ¯ç§’ä¼šè§¦å‘ 8â€“10 æ¬¡ GCï¼Œæ¯åˆ†é’Ÿç´¯è®¡ 400â€“600 æ¬¡ï¼ŒGC å ç”¨çº¦ &lt;strong&gt;30% çš„ CPU æ—¶é—´&lt;/strong&gt;ã€‚è¿™ç›´æ¥æŒ¤å‹äº†ä¸šåŠ¡çº¿ç¨‹çš„æ‰§è¡Œç©ºé—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;-æ€§èƒ½æµ‹è¯•gc-å¯¹-go-ç¨‹åºçš„å½±å“&#34;&gt;ğŸ“Š æ€§èƒ½æµ‹è¯•ï¼šGC å¯¹ Go ç¨‹åºçš„å½±å“
&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå®é™…åŸºå‡†çš„å˜åŒ–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Go 1.3/1.4ï¼ˆå¹¶å‘ GC å‰ï¼‰&lt;/strong&gt;&lt;br&gt;
å¤§å †ï¼ˆ10GB+ï¼‰ä¸Šçš„ GC åœé¡¿ï¼šä»¥ç§’è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Go 1.5ï¼ˆå¹¶å‘ GC å¼•å…¥åï¼‰&lt;/strong&gt;&lt;br&gt;
ç›¸åŒæ¡ä»¶ä¸‹ï¼ŒGC åœé¡¿å‹ç¼©åˆ° &amp;lt;1msã€‚&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2025/05/8d6a9563ad431b76e34d31077cbcd82b.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Pasted image 20250504161704&#34;
	
	
&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Go 1.6â€“1.8&lt;/strong&gt;&lt;br&gt;
æœ€å¤§å † 200GBï¼ŒGC åœé¡¿æ§åˆ¶åœ¨ 20ms ä»¥ä¸‹ï¼Œç”šè‡³å¸¸æ€ 1msã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›è¿›æ­¥éå¸¸äº®çœ¼ï¼Œä½†æ³¨æ„ï¼š&lt;br&gt;
âœ… å»¶è¿Ÿæ§åˆ¶å¥½äº†&lt;br&gt;
âš ï¸ æ€»è€—æ—¶å’Œ CPU æ¶ˆè€—ä¾ç„¶æ˜¾è‘—ï¼Œç‰¹åˆ«æ˜¯é«˜è´Ÿè½½æˆ–é«˜åˆ†é…åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;-green-tea-gcå…¨æ–°ä¼˜åŒ–æ–¹æ¡ˆ&#34;&gt;ğŸŒ¿ Green Tea GCï¼šå…¨æ–°ä¼˜åŒ–æ–¹æ¡ˆ
&lt;/h2&gt;&lt;p&gt;é¢å¯¹è¿™äº›é—®é¢˜ï¼ŒGo å®˜æ–¹æå‡ºäº† Green Tea GCã€‚å®ƒçš„æ ¸å¿ƒä¼˜åŒ–ç‚¹æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä»å•å¯¹è±¡æ‰«æï¼Œå‡çº§ä¸ºæŒ‰ spanï¼ˆå†…å­˜å—ï¼‰æ‰¹é‡æ‰«æã€‚&lt;/strong&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°å¯¹è±¡ï¼ˆâ‰¤512Bï¼‰æ ‡è®°ç”±å•ä¸ªå¯¹è±¡ç²’åº¦æå‡ä¸º span ç²’åº¦ã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª span ä¸­ï¼Œåªæœ‰é¦–æ¬¡æ ‡è®°çš„å¯¹è±¡ä¼šå°†æ•´ä¸ª span æ¨å…¥æ‰«æé˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;GC æ‰«æé˜¶æ®µæ‰¹é‡å¤„ç†æ•´ä¸ª spanï¼Œæå¤§æå‡äº†å†…å­˜è®¿é—®å±€éƒ¨æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒGreen Tea æ”¹è¿›äº†å¹¶è¡Œé˜Ÿåˆ—ç®¡ç†ï¼Œé‡‡ç”¨ç±»ä¼¼ Go è°ƒåº¦å™¨çš„å·¥ä½œçªƒå–æœºåˆ¶ï¼Œè¿›ä¸€æ­¥æé«˜äº†å¤šæ ¸æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;-green-tea-gc-å®æµ‹è¡¨ç°&#34;&gt;âš¡ Green Tea GC å®æµ‹è¡¨ç°
&lt;/h2&gt;&lt;p&gt;ä»åˆæ­¥åŸºå‡†æ¥çœ‹ï¼ŒGreen Tea GC å¸¦æ¥äº†æœ‰é€‰æ‹©æ€§çš„æ€§èƒ½æå‡ï¼š&lt;/p&gt;
&lt;p&gt;âœ… &lt;strong&gt;Tile38 åŸºå‡†ï¼ˆé«˜æ‰‡å‡ºæ ‘ç»“æ„ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GC å¼€é”€é™ä½çº¦ 35%&lt;/li&gt;
&lt;li&gt;ååã€å»¶è¿Ÿã€å†…å­˜ä½¿ç”¨å…¨é¢ä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;âš  &lt;strong&gt;bleve-index åŸºå‡†ï¼ˆä½æ‰‡å‡ºã€é¢‘ç¹å˜å¼‚ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹è±¡åˆ†å¸ƒæ•£ä¹±ï¼Œå†…å­˜å±€éƒ¨æ€§å·®&lt;/li&gt;
&lt;li&gt;Green Tea ä¸å¸¸è§„ GC æ€§èƒ½ç›¸è¿‘ï¼Œæœ‰æ—¶ç•¥ä½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ€»ç»“ï¼šGreen Tea å¹¶éâ€œé“¶å¼¹â€ï¼Œä½†åœ¨å†…å­˜å±€éƒ¨æ€§è‰¯å¥½ã€å¤šæ ¸æ‰©å±•åœºæ™¯ä¸‹ï¼Œå®ƒå±•ç°äº†æ˜æ˜¾ä¼˜åŠ¿ï¼Œå¹¶ä¸ºæœªæ¥ SIMD åŠ é€Ÿç­‰ç¡¬ä»¶ä¼˜åŒ–å¥ å®šäº†åŸºç¡€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;-æ€»ç»“&#34;&gt;ğŸ æ€»ç»“
&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;æ¯”è¾ƒé¡¹&lt;/th&gt;
          &lt;th&gt;å½“å‰ Go GC&lt;/th&gt;
          &lt;th&gt;Green Tea GC&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;æ ‡è®°ç²’åº¦&lt;/td&gt;
          &lt;td&gt;å•å¯¹è±¡&lt;/td&gt;
          &lt;td&gt;spanï¼ˆæ‰¹é‡ï¼‰&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å†…å­˜å±€éƒ¨æ€§&lt;/td&gt;
          &lt;td&gt;å·®ï¼Œéšæœºè·³è·ƒ&lt;/td&gt;
          &lt;td&gt;é«˜ï¼ŒåŒ span å†…æ‰¹é‡&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;å¤šæ ¸æ‰©å±•æ€§&lt;/td&gt;
          &lt;td&gt;å—é™&lt;/td&gt;
          &lt;td&gt;æ”¹è¿›ï¼Œé‡‡ç”¨å·¥ä½œçªƒå–é˜Ÿåˆ—&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;æ€§èƒ½æå‡&lt;/td&gt;
          &lt;td&gt;å·²æ¥è¿‘ä½å»¶è¿Ÿä¸Šé™&lt;/td&gt;
          &lt;td&gt;æŸäº›åœºæ™¯ä¸‹ GC è€—æ—¶é™ 35%&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;åº”ç”¨é€‚ç”¨èŒƒå›´&lt;/td&gt;
          &lt;td&gt;æ™®é€šåœºæ™¯&lt;/td&gt;
          &lt;td&gt;å†…å­˜å±€éƒ¨æ€§å¥½ã€åˆ†é…å¯†é›†åœºæ™¯&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯¹äºè¿½æ±‚æé™æ€§èƒ½çš„å¼€å‘è€…ï¼ŒGreen Tea GC æä¾›äº†ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„æ–°æ–¹å‘ã€‚æƒ³è¦è¯•éªŒ Green Teaï¼Œå¯ä»¥åœ¨ Go 1.25+ å¼€å¯å®éªŒæ ‡å¿—ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;ğŸ“ &lt;strong&gt;å‚è€ƒèµ„æ–™&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/73581&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;GitHub Issue #73581&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://stackoverflow.com/questions/31684862/how-fast-is-the-go-1-5-gc-with-terabytes-of-ram&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://stackoverflow.com/questions/31684862/how-fast-is-the-go-1-5-gc-with-terabytes-of-ram&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/zh-cn/p/green-tea-gc-golang-%E7%9A%84-zgc/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æœ¬æ–‡é•¿æœŸé“¾æ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨è§‰å¾—æˆ‘çš„åšå®¢å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·é€šè¿‡ &lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/index.xml&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RSS&lt;/a&gt;è®¢é˜…æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–è€…åœ¨&lt;a class=&#34;link&#34; href=&#34;https://x.com/@piaopiaopig&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;X&lt;/a&gt;ä¸Šå…³æ³¨æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨æœ‰&lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;è´¦å·ï¼Œèƒ½ç»™æˆ‘ä¸ªå…³æ³¨å˜›ï¼Ÿæˆ‘çš„æ–‡ç« ç¬¬ä¸€æ—¶é—´éƒ½ä¼šå‘å¸ƒåœ¨Mediumã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>ã€è¯‘ã€‘ï¼šgRPCä¸‘é™‹çš„éƒ¨åˆ†</title>
        <link>https://huizhou92.com/zh-cn/p/%E8%AF%91grpc%E4%B8%91%E9%99%8B%E7%9A%84%E9%83%A8%E5%88%86/</link>
        <pubDate>Fri, 14 Mar 2025 09:59:10 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/%E8%AF%91grpc%E4%B8%91%E9%99%8B%E7%9A%84%E9%83%A8%E5%88%86/</guid>
        <description>&lt;p&gt;åŸæ–‡é“¾æ¥ï¼šhttps://kmcd.dev/posts/grpc-the-ugly-parts/&lt;br&gt;
è¿™ç¯‡æ–‡ç« æ˜¯&lt;a class=&#34;link&#34; href=&#34;https://kmcd.dev/series/grpc-the-good-and-the-bad/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gRPCï¼šå¥½ä¸å&lt;/a&gt;ç³»åˆ—çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;gRPCæ— ç–‘æ˜¯å¾®æœåŠ¡é¢†åŸŸä¸­çš„ä¸€æŠŠåˆ©å™¨ï¼Œå®ƒå¸¦æ¥äº†æ•ˆç‡å’Œæ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ï¼Œä½†gRPCä¹Ÿæœ‰å…¶ä¸‘é™‹çš„ä¸€é¢ã€‚ä½œä¸ºä¸€ä¸ªåœ¨gRPCä¸ŠèŠ±è´¹äº†å¤§é‡æ—¶é—´çš„äººï¼Œæˆ‘æƒ³æ­ç¤ºè¿™é¡¹æŠ€æœ¯çš„ä¸€äº›ä¸é‚£ä¹ˆç¾å¥½çš„æ–¹é¢ã€‚æˆ‘å·²ç»è®¨è®ºè¿‡gRPCçš„&lt;a class=&#34;link&#34; href=&#34;https://kmcd.dev/posts/grpc-the-good-parts&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¼˜ç‚¹&lt;/a&gt;å’Œ&lt;a class=&#34;link&#34; href=&#34;https://kmcd.dev/posts/grpc-the-bad-parts&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ç¼ºç‚¹&lt;/a&gt;ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥è°ˆè°ˆå®ƒçš„ä¸‘é™‹ä¹‹å¤„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»£ç ç”Ÿæˆ&#34;&gt;ä»£ç ç”Ÿæˆ
&lt;/h2&gt;&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä¸å¾—ä¸è¯´ä¸€ä¸‹ä»&lt;code&gt;protobuf&lt;/code&gt;ç”Ÿæˆçš„ä»£ç æœ‰å¤šä¹ˆä¸‘é™‹ã€‚è¿™äº›ä»£ç é€šå¸¸å¾ˆå†—é•¿ã€å¤æ‚ä¸”éš¾ä»¥é˜…è¯»ã€‚å°½ç®¡å®ƒå¹¶ä¸æ˜¯ä¸ºäº†æ‰‹åŠ¨ç¼–è¾‘è€Œè®¾è®¡çš„ï¼Œä½†è¿™ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå°¤å…¶æ˜¯åœ¨å°†gRPCé›†æˆåˆ°å¤§å‹é¡¹ç›®ä¸­æ—¶ã€‚æœ€è¿‘åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ï¼Œè¿™ç§æƒ…å†µå·²ç»æœ‰æ‰€æ”¹å–„ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€äº›ç²—ç³™çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¯­è¨€ç‰¹å®šçš„æ€ªç™–&#34;&gt;è¯­è¨€ç‰¹å®šçš„æ€ªç™–
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;protobuf&lt;/code&gt;å’Œ&lt;code&gt;gRPC&lt;/code&gt;çš„åˆå§‹å®ç°å¸¸å¸¸åç¦»è¯­è¨€ç‰¹å®šçš„è§„èŒƒï¼Œå°¤å…¶æ˜¯åœ¨HTTPå¤„ç†æ–¹é¢ã€‚è¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šæºäºå¼ºåˆ¶æ”¯æŒ&lt;code&gt;HTTP/2&lt;/code&gt;çš„å†³å®šï¼Œè¿™ä¸€å†³å®šåæ¥è¢«è¯æ˜é™åˆ¶äº†&lt;code&gt;gRPC&lt;/code&gt;åœ¨å‰ç«¯çš„åº”ç”¨ã€‚æˆ‘ä»¬ç°åœ¨ä»&lt;code&gt;gRPC-Web&lt;/code&gt;ä¸­äº†è§£åˆ°ï¼Œ&lt;code&gt;trailer&lt;/code&gt;å¹¶ä¸æ˜¯åƒgRPCè¿™æ ·çš„åè®®çš„ç¡¬æ€§è¦æ±‚ã€‚åœ¨è¿™ä¸€å†³å®šä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦æ”¹è¿›&lt;code&gt;protobuf&lt;/code&gt;å’Œ&lt;code&gt;gRPC&lt;/code&gt;çš„è¯­è¨€å®ç°ï¼Œä½¿å…¶æ›´ç¬¦åˆæ¯ç§è¯­è¨€çš„ä¹ æƒ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºGoè¯­è¨€æ¥è¯´ï¼Œé¿å…ä½¿ç”¨&lt;code&gt;net/http&lt;/code&gt;åŒ…æ˜¯ä¸€ä¸ªè‰°éš¾çš„å†³å®šï¼Œå› ä¸ºè¿™ä½¿å¾—åœ¨ä¸å…¶ä»–ç±»å‹çš„HTTP APIä¸€èµ·ä½¿ç”¨gRPCç«¯ç‚¹æ—¶å˜å¾—æ›´åŠ å›°éš¾ï¼Œå¹¶ä¸”éš¾ä»¥å¤ç”¨HTTPä¸­é—´ä»¶ã€‚ä»–ä»¬æœ€ç»ˆåœ¨grpc-goä¸­æ·»åŠ äº†ä¸€ä¸ª&lt;a class=&#34;link&#34; href=&#34;https://pkg.go.dev/google.golang.org/grpc#Server.ServeHTTP&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;ServeHTTP()&lt;/code&gt;&lt;/a&gt;æ¥å£ï¼Œä½œä¸ºä½¿ç”¨Goæ ‡å‡†åº“ä¸­çš„HTTPæœåŠ¡å™¨çš„ä¸€ç§å®éªŒæ€§æ–¹æ³•ï¼Œä½†ä½¿ç”¨è¿™ç§æ–¹æ³•ä¼šå¯¼è‡´&lt;a class=&#34;link&#34; href=&#34;https://kmcd.dev/posts/benchmarking-go-grpc/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æ˜¾è‘—çš„æ€§èƒ½æŸå¤±&lt;/a&gt;ã€‚ä¹Ÿè®¸ä»–ä»¬è¿™æ ·åšæ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä¸ªå°†gRPCä¸Goç”Ÿæ€ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†å‰²è£‚çš„æƒè¡¡ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ—¶ï¼Œè¯­è¨€ç‰¹å®šçš„æ€ªç™–å®é™…ä¸Šä¼šå½±å“ä½ å¦‚ä½•è®¾è®¡protobufç±»å‹ã€‚å¦‚æœä½ éµå¾ª&lt;a class=&#34;link&#34; href=&#34;https://buf.build/docs/best-practices/style-guide&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Buf&lt;/a&gt;çš„é£æ ¼å»ºè®®ï¼Œæšä¸¾çš„åç§°åº”è¯¥ä»¥æšä¸¾åçš„å¤§å†™è›‡å½¢ç‰ˆæœ¬ä½œä¸ºå‰ç¼€ï¼Œå°±åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FooBar&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;FOO_BAR_UNSPECIFIED&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;FOO_BAR_FIRST_VALUE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;FOO_BAR_SECOND_VALUE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™åœ¨&lt;a class=&#34;link&#34; href=&#34;https://buf.build/docs/lint/rules#enum_value_prefix&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;bufçš„lintè§„åˆ™æè¿°&lt;/a&gt;ä¸­æœ‰æ›´å¥½çš„è§£é‡Šï¼Œä½†è¿™ç§é£æ ¼æŒ‡å—ä¹‹æ‰€ä»¥å¦‚æ­¤ï¼Œæ˜¯å› ä¸ºC++çš„æšä¸¾ä½œç”¨åŸŸè§„åˆ™ï¼Œè¿™ä½¿å¾—åœ¨åŒä¸€åŒ…ä¸­æ— æ³•æœ‰ä¸¤ä¸ªå…·æœ‰ç›¸åŒæšä¸¾å€¼åç§°çš„æšä¸¾å€¼ã€‚è™½ç„¶è¿™ç§çº¦å®šæºäºC++çš„ä½œç”¨åŸŸè§„åˆ™ï¼Œä½†å®ƒå½±å“äº†ä½ åº”è¯¥å¦‚ä½•è®¾è®¡æ‰€æœ‰çš„protobufæ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆæšä¸¾å†…éƒ¨çš„ä½œç”¨åŸŸä¸è¶³ä»¥è®©C++ç¼–è¯‘å™¨ç”Ÿæˆå”¯ä¸€çš„åç§°ï¼Ÿä¸ºä»€ä¹ˆè¿™ç§ç¼ºé™·ä¼šå½±å“é£æ ¼æŒ‡å—ï¼Œå¹¶è¿›è€Œå½±å“æ‰€æœ‰ç›®æ ‡è¯­è¨€ï¼Ÿå¯¹æˆ‘æ¥è¯´ï¼Œè¿™æœ‰ç‚¹ä¸‘é™‹ï¼Œå› ä¸ºæŸäº›è¯­è¨€å®ç°çš„æ€ªç™–ä»¥ä¸ç›´è§‚çš„æ–¹å¼å†’äº†å‡ºæ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”Ÿæˆçš„ä»£ç ç”šè‡³ä¸å¤Ÿå¿«&#34;&gt;ç”Ÿæˆçš„ä»£ç ç”šè‡³ä¸å¤Ÿå¿«
&lt;/h3&gt;&lt;p&gt;ç”Ÿæˆä»£ç çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œä½ å¯ä»¥ç”Ÿæˆä¸€äº›æ­£å¸¸äººä¸ä¼šå†™çš„ä»£ç ï¼Œä»¥è·å¾—ä¸€äº›æ€§èƒ½ä¼˜åŒ–ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æŸ¥çœ‹ä¸€äº›ä»protobufç”Ÿæˆçš„ä»£ç ï¼Œä½ ä¼šå‘ç°å¤§é‡ä½¿ç”¨äº†è¿è¡Œæ—¶åå°„ã€‚ä¸ºä»€ä¹ˆï¼Ÿåœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œæˆ‘æ˜¯åœ¨è¯´ç”Ÿæˆçš„ä»£ç &lt;strong&gt;ä¸å¤Ÿä¸‘é™‹&lt;/strong&gt;ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚è¯·æ³¨æ„ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªéå¸¸Goç‰¹å®šçš„éƒ¨åˆ†ï¼Œå› ä¸ºæˆ‘å¤§éƒ¨åˆ†å…³äºprotobufçš„ç»éªŒéƒ½æ˜¯åœ¨Goä¸­ã€‚ç„¶è€Œï¼Œç›¸åŒçš„ç­–ç•¥å·²ç»åº”ç”¨äºå¤§å¤šæ•°è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªGoä¸­çš„è¶…çº§ç®€å•ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯protobufï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Hello&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™æ˜¯ç”±protocç”Ÿæˆçš„ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Hello&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;state&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;protoimpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MessageState&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;sizeCache&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;protoimpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SizeCache&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;unknownFields&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;protoimpl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;UnknownFields&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`protobuf:&amp;#34;bytes,1,opt,name=name,proto3&amp;#34; json:&amp;#34;name,omitempty&amp;#34;`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// With these methods, contents are stripped&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Reset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ProtoMessage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ProtoReflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;protoreflect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Message&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®é™…ä¸Šï¼Œå¹¶æ²¡æœ‰ä¸ºè¿™ä¸ªç±»å‹å®šä¹‰ä¸“é—¨çš„&lt;code&gt;Marshal()&lt;/code&gt;æˆ–&lt;code&gt;Unmarshal()&lt;/code&gt;å‡½æ•°ã€‚è¿™æ„å‘³ç€åºåˆ—åŒ–æ˜¯é€šè¿‡è¿è¡Œæ—¶åå°„æ¥å®ç°çš„ã€‚åå°„é€šå¸¸è¢«è®¤ä¸ºè¾ƒæ…¢ï¼Œå› ä¸ºå®ƒ&lt;strong&gt;ç¡®å®&lt;/strong&gt;è¾ƒæ…¢ã€‚æˆ‘è§‰å¾—å¥‡æ€ªçš„æ˜¯ï¼Œæ²¡æœ‰ä¸ºGoç”Ÿæˆä¼˜åŒ–çš„ã€ç±»å‹ç‰¹å®šçš„åºåˆ—åŒ–ä»£ç ã€‚è¯è™½å¦‚æ­¤ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ªåä¸º&lt;a class=&#34;link&#34; href=&#34;https://github.com/planetscale/vtprotobuf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;vtprotobuf&lt;/a&gt;çš„å•ç‹¬protocæ’ä»¶æ¥è·å¾—è¿™ä¸€ç‚¹ï¼Œè¯¥æ’ä»¶å°†ä¸ºæ¯ä¸ªprotobufç±»å‹ç”Ÿæˆä¸“é—¨çš„marshalå’Œunmarshalå‡½æ•°ã€‚å®ƒè¿˜å…è®¸ä½¿ç”¨ç±»å‹ç‰¹å®šçš„å†…å­˜æ± ï¼Œè¿™ä¹Ÿæœ‰åŠ©äºå‡å°‘åˆ†é…å¹¶æé«˜æ€§èƒ½ã€‚æ ¹æ®æˆ‘çš„&lt;a class=&#34;link&#34; href=&#34;https://kmcd.dev/posts/benchmarking-go-grpc/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æµ‹è¯•&lt;/a&gt;ï¼Œåªéœ€æ·»åŠ &lt;code&gt;vtprotobuf&lt;/code&gt;è€Œä¸åšä»»ä½•ä»£ç æ›´æ”¹ï¼Œå°±å¯ä»¥å°†æ€§èƒ½æé«˜2-4%ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯â€œå…è´¹â€çš„2-4%ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—å¾ˆå¥‡æ€ªï¼Œè¿™ç«Ÿç„¶ä¸æ˜¯æ ‡å‡†ç¼–è¯‘å™¨çš„ä¸€éƒ¨åˆ†ã€‚&lt;a class=&#34;link&#34; href=&#34;https://github.com/sudorandom/go-grpc-bench/blob/v0.0.1/gen/flex_vtproto.pb.go#L573&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä½ å¯èƒ½ä¸å–œæ¬¢å®ƒï¼Œä½†è¿™å°±æ˜¯å³°å€¼æ€§èƒ½çš„æ ·å­&lt;/a&gt;ã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸ªé¡¹ç›®éœ€è¦æ›´å¤šçš„å…³æ³¨å’Œæ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›é¡¹ç›®å£°ç§°åœ¨æ ‡å‡†protobufåº“çš„åŸºç¡€ä¸Šå–å¾—äº†æƒŠäººçš„æ€§èƒ½æå‡ã€‚ä»–ä»¬ç¡®å®é€šè¿‡åšå‡ºä¸€äº›æƒè¡¡æ¥å®ç°è¿™äº›æ€§èƒ½æå‡ï¼Œä½†å¾ˆå¤šæ—¶å€™ï¼Œé¢å¤–çš„å¤æ‚æ€§æ˜¯å€¼å¾—çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šè¯»åˆ°è¿™ä¸€éƒ¨åˆ†å¹¶æƒ³ï¼šâ€œå¥½å§ï¼Œè¿™ä¼šå¢åŠ ç”Ÿæˆçš„ä»£ç é‡ï¼Œå¢åŠ äºŒè¿›åˆ¶æ–‡ä»¶æˆ–åŒ…çš„å¤§å°ï¼Œåœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›è¿™æ ·ã€‚â€è¿™æ˜¯äº‹å®ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆprotobufæœ‰ä¸€ä¸ª&lt;code&gt;optimize_for&lt;/code&gt;é€‰é¡¹ï¼Œæ‰€ä»¥ä½ å¯ä»¥æ³¨é‡Šä»¥ä¸‹ä¹‹ä¸€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;option optimize_for = SPEED;&lt;/code&gt; - æ›´å†—é•¿ã€æ›´å¿«çš„ä»£ç &lt;/li&gt;
&lt;li&gt;&lt;code&gt;option optimize_for = CODE_SIZE;&lt;/code&gt; - æ›´å°çš„ä»£ç &lt;/li&gt;
&lt;li&gt;&lt;code&gt;option optimize_for = LITE_RUNTIME;&lt;/code&gt; - æ—¨åœ¨åœ¨è¾ƒå°çš„è¿è¡Œæ—¶ä¸Šè¿è¡Œï¼Œçœç•¥äº†æè¿°ç¬¦å’Œåå°„ç­‰åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯·å‚é˜…&lt;a class=&#34;link&#34; href=&#34;https://protobuf.dev/programming-guides/proto3/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹protobufæ–‡æ¡£&lt;/a&gt;ä¸­å…³äº&lt;code&gt;optimize_for&lt;/code&gt;çš„å®Œæ•´æè¿°ã€‚è™½ç„¶è¿™äº›é€‰é¡¹å­˜åœ¨ï¼Œä½†å®ƒä»¬å®é™…ä¸Šå¹¶æ²¡æœ‰ç”¨äºå¤§å¤šæ•°ç›®æ ‡è¯­è¨€ã€‚å°†æ¥ï¼Œæˆ‘å®Œå…¨å¸Œæœ›çœ‹åˆ°å¤§éƒ¨åˆ†&lt;code&gt;vtprotobuf&lt;/code&gt;è¢«æ•´åˆåˆ°Goçš„æ ‡å‡†protobufç¼–è¯‘å™¨ä¸­ï¼Œå¹¶åœ¨&lt;code&gt;optimize_for = SPEED&lt;/code&gt;æ—¶ä½¿ç”¨ã€‚å°†ç±»ä¼¼&lt;code&gt;vtprotobuf&lt;/code&gt;çš„ä¼˜åŒ–æ•´åˆåˆ°æ ‡å‡†protobufç¼–è¯‘å™¨ä¸­ï¼Œå¯ä»¥ä¸ºGoå¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼Œå…¶ä»–è¯­è¨€ä¹Ÿå¯èƒ½å­˜åœ¨ç±»ä¼¼çš„æœºä¼šã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¿…å¡«å­—æ®µ&#34;&gt;å¿…å¡«å­—æ®µ
&lt;/h2&gt;&lt;p&gt;Protobufçš„ç»´æŠ¤è€…åœ¨å¿…å¡«å­—æ®µæ–¹é¢å­¦åˆ°äº†ä¸€äº›è‰°éš¾çš„æ•™è®­ã€‚ä»–ä»¬è§‰å¾—è‡ªå·±çŠ¯äº†ä¸€ä¸ªä¸¥é‡çš„é”™è¯¯ï¼Œä»¥è‡³äºä»–ä»¬æ¨å‡ºäº†ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„protobufï¼Œå³proto3ï¼Œåªæ˜¯ä¸ºäº†ä»è§„èŒƒä¸­åˆ é™¤å¿…å¡«å­—æ®µã€‚ä¸ºä»€ä¹ˆï¼Ÿâ€œå¿…å¡«å­—æ®µæœ‰å®³â€å®£è¨€çš„ä½œè€…åœ¨&lt;a class=&#34;link&#34; href=&#34;https://news.ycombinator.com/item?id=18190005&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€ç¯‡å†—é•¿çš„Hacker Newsè¯„è®º&lt;/a&gt;ä¸­è°ˆåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä½†é‡è¦çš„æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç°å®ä¸–ç•Œçš„å®è·µä¹Ÿè¡¨æ˜ï¼Œè®¸å¤šæœ€åˆè¢«è®¤ä¸ºæ˜¯â€œå¿…å¡«â€çš„å­—æ®µéšç€æ—¶é—´çš„æ¨ç§»å¾€å¾€ä¼šå˜æˆå¯é€‰çš„ï¼Œå› æ­¤æœ‰äº†â€œå¿…å¡«å­—æ®µæœ‰å®³â€çš„å®£è¨€ã€‚åœ¨å®è·µä¸­ï¼Œä½ å¸Œæœ›å°†æ‰€æœ‰å­—æ®µå£°æ˜ä¸ºå¯é€‰çš„ï¼Œä»¥ä¾¿ä¸ºå˜åŒ–æä¾›æœ€å¤§çš„çµæ´»æ€§ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸€ç‚¹åœ¨&lt;a class=&#34;link&#34; href=&#34;https://protobuf.dev/programming-guides/dos-donts/#add-required&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å®˜æ–¹protobufé£æ ¼æŒ‡å—&lt;/a&gt;ä¸­å¾—åˆ°äº†å‘¼åº”ï¼Œä»–ä»¬å»ºè®®æ·»åŠ æ³¨é‡Šæ¥æŒ‡ç¤ºæŸä¸ªå­—æ®µæ˜¯å¿…å¡«çš„ã€‚å¦‚æœæˆ‘ä»¬è®¨è®ºçš„æ˜¯å°†æ¶ˆæ¯ä»Aä¼ é€’åˆ°Bï¼Œæˆ‘å®Œå…¨åŒæ„è¿™ç§æ€è·¯ã€‚ç„¶è€Œï¼Œä»…ä»…å› ä¸ºæŸäº›å­—æ®µè¢«è®¤ä¸ºæ˜¯â€œå¿…å¡«â€çš„ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–ï¼Œå¹¶ä¸æ„å‘³ç€å¿…å¡«å­—æ®µä¸å­˜åœ¨ã€‚ä»ç„¶éœ€è¦ä»£ç æ¥å¼ºåˆ¶æ‰§è¡Œè¿™ä¸€è¦æ±‚ï¼Œè€å®è¯´ï¼Œæˆ‘ä¸æƒ³ç¼–å†™è¿™äº›ä»£ç ã€‚å› æ­¤ï¼Œæˆ‘è®¤ä¸ºåœ¨ä¸ç¼–å†™å¤§é‡ç©ºæ£€æŸ¥çš„æƒ…å†µä¸‹å¤„ç†å¿…å¡«å­—æ®µçš„æœ€ä½³æ–¹æ³•æ˜¯ä½¿ç”¨&lt;a class=&#34;link&#34; href=&#34;https://github.com/bufbuild/protovalidate&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;protovalidate&lt;/a&gt;æˆ–ç±»ä¼¼çš„åº“ï¼Œè¿™äº›åº“å…·æœ‰protobufé€‰é¡¹ï¼Œå…è®¸ä½ æ³¨é‡Šå“ªäº›å­—æ®µæ˜¯å¿…å¡«çš„ã€‚ç„¶ååœ¨æœåŠ¡å™¨å’Œ/æˆ–å®¢æˆ·ç«¯ä¸Šæœ‰ä»£ç å¯ä»¥ä½¿ç”¨åº“æ¥å¼ºåˆ¶æ‰§è¡Œè¿™äº›è¦æ±‚ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™å…¼å…·äº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼šä½ ä»ç„¶å¯ä»¥ä»¥ä¸ä¼šå®Œå…¨ç ´åæ¶ˆæ¯å®Œæ•´æ€§çš„æ–¹å¼å£°æ˜å¿…å¡«å­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸å–œæ¬¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;User&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;age&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// required.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æˆ‘å–œæ¬¢è¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-protobuf&#34; data-lang=&#34;protobuf&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;User&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;age&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buf.validate.field&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;required&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æˆ‘æ˜¯&lt;a class=&#34;link&#34; href=&#34;https://github.com/bufbuild/protovalidate&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;protovalidate&lt;/a&gt;çš„å¿ å®ç²‰ä¸ï¼Œæˆ‘å·²ç»å¤šæ¬¡ä½¿ç”¨å®ƒå¹¶ä¸ºå…¶åšå‡ºäº†è´¡çŒ®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºprotobufå­—æ®µçš„&lt;a class=&#34;link&#34; href=&#34;https://protobuf.dev/programming-guides/proto3/#customoptions&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;è‡ªå®šä¹‰é€‰é¡¹&lt;/a&gt;æ˜¯protobufçš„ä¸€ä¸ªæœªè¢«å……åˆ†åˆ©ç”¨çš„è¶…èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éš¾ä»¥å…¥é—¨&#34;&gt;éš¾ä»¥å…¥é—¨
&lt;/h2&gt;&lt;p&gt;å°½ç®¡gRPCå…·æœ‰ä¸å¯å¦è®¤çš„ä¼˜åŠ¿ï¼Œä½†å…¶å­¦ä¹ æ›²çº¿å¯èƒ½å¾ˆé™¡å³­ã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œå¼€å§‹ä½¿ç”¨&lt;code&gt;protobuf&lt;/code&gt;ã€ç†è§£å·¥å…·é“¾ä»¥åŠè®¾ç½®å¿…è¦çš„åŸºç¡€è®¾æ–½å¯èƒ½ä¼šè®©äººæœ›è€Œç”Ÿç•ï¼Œè¿™ä½¿å¾—åˆå§‹é‡‡ç”¨çš„éšœç¢æ¯”ä½¿ç”¨æ›´ç®€å•çš„åŸºäºJSONçš„APIæ›´é«˜ã€‚ä¸ºä»€ä¹ˆå®ƒå¦‚æ­¤é™¡å³­ï¼Ÿå—¯ï¼Œå®ƒåœ¨å¤§å¤šæ•°è¯­è¨€ä¸­å¼•å…¥äº†éæƒ¯ç”¨çš„å·¥å…·é“¾ã€‚æœ‰ä¸€äº›è¯­è¨€æ”¯æŒçš„ä¾‹å­ä½¿å¾—protobufç”Ÿæˆå˜å¾—æ— ç¼ã€‚&lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/aspnet/core/grpc/basics&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Grpc.Tools&lt;/a&gt; for &lt;code&gt;.NET&lt;/code&gt;å°±æ˜¯ä¸€ä¸ªé—ªäº®çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•å°†protobufå·¥å…·é“¾æ›´ç´§å¯†åœ°é›†æˆåˆ°æ ‡å‡†è¯­è¨€å·¥å…·é“¾ä¸­ã€‚æˆ‘ä»¬éœ€è¦æ›´å¤šè¿™æ ·çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://kmcd.dev/posts/grpc-the-ugly-parts/learning-curve.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å½“è®¸å¤šä½¿ç”¨å’Œä¾èµ–protobufå’ŒgRPCçš„äººç§¯æä¸å¸Œæœ›gRPCæ‰©å±•åˆ°å‰ç«¯ï¼Œå¹¶è®¤ä¸ºæ¨åŠ¨è¿™ä¸€æ–¹å‘ä¼šå¯¼è‡´ä¸äº†è§£æƒ…å†µçš„äººä¾µå…¥åç«¯é¢†åŸŸæ—¶ï¼Œé™¡å³­çš„å­¦ä¹ æ›²çº¿å¹¶æ²¡æœ‰å¸®åŠ©ï¼Œä»–ä»¬è®¤ä¸ºåªæœ‰ä»–ä»¬è¶³å¤Ÿèªæ˜æ‰èƒ½åœ¨åç«¯å·¥ä½œã€‚è¿™æ˜¯ç²¾è‹±ä¸»ä¹‰çš„å®ˆé—¨è¡Œä¸ºï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§è¡Œä¸šæ™®éå­˜åœ¨ã€‚æˆ‘ç›¸ä¿¡gRPCåœ¨Webå‰ç«¯ä¸­ä¸åœ¨å¾®æœåŠ¡ä¸­ä¸€æ ·æœ‰å…¶åœ°ä½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘é€šè¿‡å¸®åŠ©å…¶ä»–äººä½¿ç”¨protobufå­¦åˆ°äº†å¾ˆå¤šã€‚ä½ å¯èƒ½ä¼šåœ¨&lt;a class=&#34;link&#34; href=&#34;https://buf.build/links/slack&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Bufçš„Slacké¢‘é“&lt;/a&gt;æˆ–ç›¸å…³è®¨è®ºä¸­çœ‹åˆ°æˆ‘ï¼Œå› ä¸ºæˆ‘ç¡®å®ä»ä¸­å—ç›ŠåŒªæµ…ã€‚è®¸å¤šæ–‡ç« çš„æƒ³æ³•ç›´æ¥æ¥è‡ªäºåœ¨é‚£é‡Œå›ç­”é—®é¢˜ã€‚å¦‚æœæˆ‘çœ‹åˆ°æŸä¸ªé—®é¢˜å‡ºç°çš„é¢‘ç‡è¶³å¤Ÿé«˜ï¼Œæˆ‘å¯èƒ½ä¼šå†™ä¸€ç¯‡æ–‡ç« æ¥è®¨è®ºå®ƒã€‚æˆ‘è®¤ä¸ºprotobufå’ŒgRPCç¤¾åŒºéœ€è¦æ›´å¤šè¿™ç§æ€åº¦ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ç›¸ä¿¡é™¡å³­çš„å­¦ä¹ æ›²çº¿ï¼ˆå¯ä»¥é€šè¿‡å·¥å…·é“¾æ¥ç¼“è§£ï¼‰ï¼ŒåŠ ä¸Šä¸€äº›åç«¯å¼€å‘è€…çš„æŠµåˆ¶ï¼ˆå¯ä»¥é€šè¿‡â€¦â€¦åŒç†å¿ƒæ¥ç¼“è§£ï¼Ÿï¼‰ï¼Œå·²ç»å‡ç¼“äº†å®ƒåœ¨Webå¼€å‘ä¸­çš„å¹¿æ³›é‡‡ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;grpcæœ‰å…¶å†å²&#34;&gt;gRPCæœ‰å…¶å†å²
&lt;/h2&gt;&lt;p&gt;gRPCæœ€åˆä¸“æ³¨äºå¾®æœåŠ¡ï¼Œå¹¶ä¸”ä¸HTTP/2çš„ç´§å¯†è”ç³»é˜»ç¢äº†å®ƒåœ¨Webå¼€å‘ä¸­çš„å¹¿æ³›é‡‡ç”¨ã€‚å³ä½¿æœ‰äº†&lt;a class=&#34;link&#34; href=&#34;https://grpc.io/blog/state-of-grpc-web/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gRPC-Webçš„å‡ºç°&lt;/a&gt;ï¼Œä»ç„¶æœ‰ä¸€ç§çœ‹æ³•è®¤ä¸ºå®ƒåœ¨å‰ç«¯ç”Ÿæ€ç³»ç»Ÿä¸­å¹¶ä¸æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚ä¸&lt;a class=&#34;link&#34; href=&#34;https://tanstack.com/query/latest&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;TanStack Query&lt;/a&gt;ç­‰æµè¡Œå‰ç«¯åº“ç¼ºä¹å¼ºå¤§çš„é›†æˆè¿›ä¸€æ­¥å·©å›ºäº†è¿™ç§çœ‹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://kmcd.dev/posts/grpc-the-ugly-parts/bad-blood.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘è®¤ä¸ºé€šè¿‡æ”¹è¿›å·¥å…·é“¾ï¼Œæœ‰çœŸæ­£çš„æœºä¼šè®©æ›´å¤šå‰ç«¯å¼€å‘è€…å¯¹gRPCæ„Ÿåˆ°å…´å¥‹ã€‚ç›®å‰ï¼Œæ•´ä¸ªè¡Œä¸šæ­£åœ¨å›´ç»•â€œå‰ç«¯â€å’Œâ€œåç«¯â€ä¹‹é—´çš„ç•Œé™è¿›è¡Œä¸€åœºå·¨å¤§çš„è®¨è®ºï¼Œæˆ‘è®¤ä¸ºæ— è®ºç»“æœå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°æ›´å¤šä½¿ç”¨gRPCçš„TypeScriptä»£ç ã€‚&lt;/p&gt;
&lt;h2 id=&#34;grpcä¸­çš„g&#34;&gt;gRPCä¸­çš„â€œgâ€
&lt;/h2&gt;&lt;p&gt;è™½ç„¶&lt;a class=&#34;link&#34; href=&#34;https://grpc.io/docs/what-is-grpc/faq/#what-does-grpc-stand-for&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;gRPCé¡¹ç›®å£°ç§°&lt;/a&gt; gRPCä¸­çš„â€œgâ€æ˜¯ä¸€ä¸ª&lt;a class=&#34;link&#34; href=&#34;https://en.wikipedia.org/wiki/Backronym&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åå‘ç¼©ç•¥è¯&lt;/a&gt;ï¼Œä»£è¡¨â€œgRPCâ€ï¼Œä½†å®ƒæœ€åˆä»£è¡¨Googleï¼Œå› ä¸ºæ˜¯Googleå¼€å‘å¹¶å‘å¸ƒäº†protobufå’ŒgRPCã€‚&lt;br&gt;
&lt;img src=&#34;https://kmcd.dev/posts/grpc-the-ugly-parts/google.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;google çš„å¢“ç¢‘&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å…³äºGoogleå¯¹gRPCå’Œprotobufçš„é•¿æœŸæ‰¿è¯ºï¼Œå§‹ç»ˆå­˜åœ¨ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚ä»–ä»¬ä¼šç»§ç»­æŠ•èµ„äºè¿™äº›å¼€æºé¡¹ç›®ï¼Œè¿˜æ˜¯ä¼šåœ¨ä¼˜å…ˆçº§å‘ç”Ÿå˜åŒ–æ—¶çªç„¶æ’¤èµ„ï¼Ÿè¯·è®°ä½ï¼ŒGoogle&lt;a class=&#34;link&#34; href=&#34;https://techcrunch.com/2024/05/01/google-lays-off-staff-from-flutter-dart-python-weeks-before-its-developer-conference/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æœ€è¿‘è£æ‰äº†Flutterã€Dartå’ŒPythonå›¢é˜Ÿçš„å¤§éƒ¨åˆ†æˆå‘˜&lt;/a&gt;ã€‚Protobufç¤¾åŒºæ­£åœ¨å‘å±•ï¼Œä½†å®ƒæ˜¯å¦è¶³å¤Ÿè‡ªç»™è‡ªè¶³ä»¥åº”å¯¹è¿™ç§æƒ…å†µï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;å®ƒå°šæœªå®Œæˆ&#34;&gt;å®ƒå°šæœªå®Œæˆ
&lt;/h2&gt;&lt;p&gt;å…¶ä»–äººè¯´gRPCä¸æˆç†Ÿï¼Œä¸æ˜¯å› ä¸ºå®ƒçš„å¹´é¾„ï¼Œè€Œæ˜¯å› ä¸ºå®ƒçš„ç”Ÿæ€ç³»ç»Ÿå‘å±•ç¨‹åº¦ã€‚æˆ‘å€¾å‘äºåŒæ„ï¼Œå› ä¸ºå®ƒç¼ºå°‘æˆ‘æœŸæœ›åœ¨ä¸€ä¸ªæˆç†Ÿç”Ÿæ€ç³»ç»Ÿä¸­çœ‹åˆ°çš„åŠŸèƒ½å’Œå·¥å…·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼ºå°‘åŒ…ç®¡ç†å™¨&#34;&gt;ç¼ºå°‘åŒ…ç®¡ç†å™¨
&lt;/h3&gt;&lt;p&gt;åœ¨æ²¡æœ‰ä¸“é—¨å·¥å…·çš„æƒ…å†µä¸‹ï¼Œè·¨å¤šä¸ªé¡¹ç›®æˆ–ä»“åº“å…±äº«protobufå®šä¹‰æ˜¯ä¸€ä¸ªæŒç»­çš„æŒ‘æˆ˜ã€‚è™½ç„¶åƒ&lt;a class=&#34;link&#34; href=&#34;https://bazel.build/reference/be/protocol-buffer&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Bazel&lt;/a&gt;ã€&lt;a class=&#34;link&#34; href=&#34;https://www.pantsbuild.org/2.21/docs/go/integrations/protobuf&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Pants&lt;/a&gt;å’Œ&lt;a class=&#34;link&#34; href=&#34;https://buf.build/product/bsr&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Bufçš„BSR&lt;/a&gt;è¿™æ ·çš„è§£å†³æ–¹æ¡ˆå­˜åœ¨ï¼Œä½†æˆ‘åœ¨â€œç°å®ä¸–ç•Œâ€ä¸­ä½¿ç”¨protobufçš„ç»éªŒâ€¦â€¦å‚å·®ä¸é½ã€‚æœ‰ä¸€äº›ç”±Googleå¼€å‘çš„å¼€æºé¡¹ç›®ï¼Œå®ƒä»¬ä½¿ç”¨bashè„šæœ¬æ‹¼å‡‘åœ¨ä¸€èµ·ï¼Œåœ¨æ‰‹åŠ¨è°ƒç”¨&lt;code&gt;protoc&lt;/code&gt;ä¹‹å‰ä¸‹è½½ä¾èµ–é¡¹ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªç¼–ç¨‹è¯­è¨€æ²¡æœ‰ç®¡ç†ä¾èµ–é¡¹çš„è§£å†³æ–¹æ¡ˆã€‚è¿™å¤ªç–¯ç‹‚äº†ã€‚æˆ‘è®¤ä¸º&lt;a class=&#34;link&#34; href=&#34;https://grpc.io/blog/bazel-rules-protobuf/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Bazel&lt;/a&gt;å’Œ&lt;a class=&#34;link&#34; href=&#34;https://buf.build/docs/ecosystem/cli-overview&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Bufå·¥å…·é“¾&lt;/a&gt;å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘åªæ˜¯æ„Ÿåˆ°æ²®ä¸§ï¼Œæˆ‘é‡åˆ°çš„æ¯ä¸ªä½¿ç”¨protobufçš„ä»“åº“éƒ½ä»¥æœ€å®šåˆ¶åŒ–çš„æ–¹å¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ç¤¾åŒºéœ€è¦å›¢ç»“èµ·æ¥æ”¹è¿›è¿™ä¸€ç‚¹ã€‚æœ‰ä¸€ä¸ªåä¸º&lt;a class=&#34;link&#34; href=&#34;https://github.com/helsing-ai/buffrs&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Buffrs&lt;/a&gt;çš„å¼€æºä»“åº“ä¼¼ä¹æ­£åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘è¿˜æ²¡æœ‰äº²è‡ªä½¿ç”¨è¿‡å®ƒï¼Œä½†åˆ°ç›®å‰ä¸ºæ­¢å®ƒçœ‹èµ·æ¥è¿˜ä¸é”™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://kmcd.dev/posts/grpc-the-ugly-parts/build.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å…³äºä¾èµ–é¡¹ï¼Œæˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://protobuf.dev/reference/protobuf/google.protobuf/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Googleçš„â€œä¼—æ‰€å‘¨çŸ¥çš„â€protobufç±»å‹&lt;/a&gt;äº«æœ‰è¢«å†…ç½®åˆ°protocä¸­çš„ç‰¹æƒã€‚è™½ç„¶è¿™äº›ç±»å‹éå¸¸æœ‰ç”¨ä¸”æ— ä»·ï¼Œä½†å®ƒä»¬çš„ç‰¹æƒä½¿å¾—å…¶ä»–æœ‰ç”¨çš„protobufç±»å‹åº“éš¾ä»¥å­˜åœ¨å’Œç¹è£ã€‚ä»…ä»…å°†è¿™äº›protobufå®šä¹‰å†…ç½®åˆ°protocï¼ˆå’Œå…¶ä»–å·¥å…·é“¾ä¸­ï¼‰æ˜¯å¯¹æ²¡æœ‰çœŸæ­£å’Œä¸€è‡´çš„ä¾èµ–ç®¡ç†æ•…äº‹çš„é€ƒé¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼–è¾‘å™¨æ”¯æŒ&#34;&gt;ç¼–è¾‘å™¨æ”¯æŒ
&lt;/h3&gt;&lt;p&gt;Protobufä»£ç ç”Ÿæˆçš„ç¼–è¾‘å™¨é›†æˆè¿˜æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ã€‚å¦‚æœç¼–è¾‘å™¨èƒ½å¤Ÿæ™ºèƒ½åœ°å°†ç”Ÿæˆçš„ä»£ç é“¾æ¥å›å…¶protobufæºï¼Œé‚£å°†éå¸¸æœ‰å¸®åŠ©ã€‚è¿™å°†æä¾›æ›´æ— ç¼çš„ä½“éªŒï¼Œä½†å·¥å…·é“¾è¿˜ä¸å¤Ÿæ™ºèƒ½ã€‚æ­¤å¤–ï¼Œæˆ‘è®¤ä¸ºæ¯ä¸ªäººéƒ½åº”è¯¥ä½¿ç”¨&lt;a class=&#34;link&#34; href=&#34;https://buf.build/docs/editor-integration&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Bufçš„ç¼–è¾‘å™¨æ”¯æŒ&lt;/a&gt;ã€‚å¦‚ä»Šï¼Œå¼€å‘è€…æœŸæœ›åœ¨ç¼–è¾‘å™¨ä¸­å†…ç½®linterå’Œè‡ªåŠ¨æ ¼å¼åŒ–å·¥å…·ã€‚è€Œå¯¹äºprotobufæ¥è¯´ï¼Œæœ‰&lt;a class=&#34;link&#34; href=&#34;https://buf.build/docs/lint/rules&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;éå¸¸çœŸå®çš„åŸå› &lt;/a&gt;éœ€è¦éµå¾ªlinterçš„å»ºè®®ã€‚&lt;/p&gt;
&lt;p&gt;åƒ&lt;a class=&#34;link&#34; href=&#34;https://trpc.io/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;tRPC&lt;/a&gt;è¿™æ ·çš„é¡¹ç›®å±•ç¤ºäº†ç´§å¯†é›†æˆå’Œæ„è§åŒ–è®¾è®¡é€‰æ‹©çš„å¥½å¤„â€”â€”è¿™æ˜¯protobufç”±äºå…¶æ€§è´¨æ— æ³•å®Œå…¨å¤åˆ¶çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»ç„¶å¸Œæœ›protobufç”Ÿæ€ç³»ç»Ÿèƒ½å¤Ÿå‘å±•ï¼Œæä¾›ç±»ä¼¼çš„ç®€åŒ–å¼€å‘è€…ä½“éªŒã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸‘é™‹çš„æ–‡æ¡£&#34;&gt;ä¸‘é™‹çš„æ–‡æ¡£
&lt;/h3&gt;&lt;p&gt;æˆ‘ä»æœªè§è¿‡ä»protobufç”Ÿæˆçš„æ–‡æ¡£ä¸æ˜¯è¶…çº§ä¸‘é™‹çš„ã€‚æˆ‘è®¤ä¸ºï¼Œç”±äºgRPCå†æ¥æ˜¯åç«¯æœåŠ¡ï¼Œåç«¯å¼€å‘è€…ä»æœªçœŸæ­£åŠªåŠ›ä½¿ç”¨protocæ’ä»¶ç”Ÿæˆæ¼‚äº®çš„æ–‡æ¡£è¾“å‡ºã€‚æˆ‘é€šè¿‡&lt;a class=&#34;link&#34; href=&#34;https://github.com/sudorandom/protoc-gen-connect-openapi&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;åˆ¶ä½œä¸€ä¸ªprotocæ’ä»¶&lt;/a&gt;è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œè¯¥æ’ä»¶å¯ä»¥ä»ç»™å®šçš„protobufæ–‡ä»¶ç”ŸæˆOpenAPIã€‚ç„¶åæˆ‘ä½¿ç”¨ä¼—å¤šæ¼‚äº®çš„å·¥å…·ä¹‹ä¸€æ¥æ˜¾ç¤ºOpenAPIè§„èŒƒã€‚è¿™è¿œæ¯”è®©æˆ‘è®¾è®¡ä¸€ä¸ªåƒæ ·çš„æ–‡æ¡£å®¹æ˜“å¾—å¤šã€‚ä»protobufç”ŸæˆOpenAPIçš„å¦ä¸€ä¸ªé™„å¸¦å¥½å¤„æ˜¯èƒ½å¤Ÿåˆ©ç”¨è¯¥ç”Ÿæ€ç³»ç»Ÿï¼Œå› ä¸ºå®ƒä¸ä»…ä»…æ˜¯æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªçœŸå®çš„ä¾‹å­ã€‚è¿™æ˜¯ä½¿ç”¨å°‘æ•°å‡ ä¸ªä»protobufç”Ÿæˆæ–‡æ¡£çš„å·¥å…·ä¹‹ä¸€ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://github.com/pseudomuto/protoc-gen-doc&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;protoc-gen-doc&lt;/a&gt;ç”Ÿæˆçš„æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://kmcd.dev/posts/grpc-the-ugly-parts/protoc-gen-doc.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;å°†å…¶ä¸ä¸€äº›OpenAPIå·¥å…·é“¾è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ˜¯ä½¿ç”¨&lt;a class=&#34;link&#34; href=&#34;https://github.com/stoplightio/elements&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Elements&lt;/a&gt;ç”Ÿæˆçš„ï¼Œä½†è¿˜æœ‰è®¸å¤šå…¶ä»–åŒæ ·ç²¾ç¾çš„æ›¿ä»£æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://kmcd.dev/posts/grpc-the-ugly-parts/elements.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;æŒ‡è´£å•ä¸ªæ’ä»¶å¹¶è¯´é»˜è®¤æ¨¡æ¿ä¸å¦‚OpenAPIæ›¿ä»£å“å¥½çœ‹æœ‰ç‚¹ä¸å…¬å¹³ï¼Œå› ä¸ºå®é™…ä¸Šä½ ç¡®å®åœ¨protoc-gen-docä¸­æœ‰æ›´å¤šçš„çµæ´»æ€§ã€‚å®ƒå…è®¸ä½ æŒ‡å®šè‡ªå·±çš„æ¨¡æ¿ï¼Œå› æ­¤å®ƒå¯ä»¥åƒä½ å¸Œæœ›çš„é‚£æ ·æ¼‚äº®ã€‚ç„¶è€Œï¼Œè¿™ç¡®å®ç¬¦åˆæˆ‘çš„è§‚ç‚¹ï¼šåœ¨RESTä¸–ç•Œä¸­ï¼Œå·¥å…·é“¾æ¯”gRPCæ›´å®Œå–„å’Œç²¾è‡´ã€‚è¿™æ˜¯ä¸€ä¸ªå¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œä½†æˆ‘ä»¬éœ€è¦è®©å‰ç«¯å¼€å‘è€…å’Œè®¾è®¡å¸ˆå¯¹gRPCæ„Ÿåˆ°å…´å¥‹ï¼Œæˆ–è€…åç«¯å·¥ç¨‹å¸ˆéœ€è¦å¼€å§‹ç£¨ç»ƒä»–ä»¬çš„è®¾è®¡æŠ€èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¿˜æƒ³æŒ‡å‡ºï¼ŒOpenAPI/Swaggeræ¥å£é€šå¸¸æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç›´æ¥ä»æ–‡æ¡£ç½‘ç«™æµ‹è¯•ç«¯ç‚¹ã€‚è¿™åœ¨gRPCä¸–ç•Œä¸­çš„ç­‰æ•ˆå·¥å…·ä¸­æ˜¯å®Œå…¨ç¼ºå¤±çš„ã€‚æ­¤å¤–ï¼Œä½¿ç”¨å¤§å¤šæ•°OpenAPIæ–‡æ¡£å·¥å…·ï¼Œä½ å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°å“ªäº›å­—æ®µæ˜¯å¿…å¡«çš„ï¼Œå¹¶ä¼šæ˜¾ç¤ºå…·æœ‰çº¦æŸçš„å­—æ®µã€‚å› æ­¤ï¼Œå®ƒä¸ä»…æ›´æ¼‚äº®ï¼Œè€Œä¸”åŠŸèƒ½ä¹Ÿæ›´å¼ºå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º
&lt;/h2&gt;&lt;p&gt;gRPCè™½ç„¶åœ¨è®¸å¤šæ–¹é¢æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä½†ä»ç„¶æœ‰æˆé•¿çš„ç©ºé—´ã€‚ç”Ÿæˆä»£ç çš„ä¸ç†æƒ³ä¹‹å¤„ï¼ŒåŠ ä¸Šä¾èµ–é¡¹ç®¡ç†å’Œprotobufæ¨¡å¼æ¼”å˜çš„æŒ‘æˆ˜ï¼Œå¯èƒ½ä¼šç»™å¼€å‘è€…å¸¦æ¥æ‘©æ“¦ã€‚ç¼ºä¹ç›´è§‚çš„ç¼–è¾‘å™¨é›†æˆä»¥åŠå†å²ä¸Šå¯¹åç«¯æœåŠ¡çš„å…³æ³¨ï¼Œä¹Ÿé˜»ç¢äº†å®ƒåœ¨Webå¼€å‘ä¸­çš„å¹¿æ³›é‡‡ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œæˆ‘è®¤ä¸ºgRPCçš„æœªæ¥æ˜¯å…‰æ˜çš„ï¼Œå¹¶ä¸”å¯ä»¥å˜å¾—ä¸é‚£ä¹ˆä¸‘é™‹ã€‚ç¤¾åŒºæ­£åœ¨ç§¯æåº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œå¼€å‘è¯¸å¦‚&lt;a class=&#34;link&#34; href=&#34;https://buf.build/product/cli&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;buf CLI&lt;/a&gt;ã€&lt;a class=&#34;link&#34; href=&#34;https://github.com/bufbuild/protovalidate&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;protovalidate&lt;/a&gt;å’Œ&lt;a class=&#34;link&#34; href=&#34;https://github.com/sudorandom/protoc-gen-connect-openapi&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;protoc-gen-connect-openapi&lt;/a&gt;ç­‰å·¥å…·æ¥å¼¥åˆå·®è·å¹¶å¢å¼ºå¼€å‘è€…ä½“éªŒã€‚éšç€gRPCçš„æˆç†Ÿå’Œ&lt;a class=&#34;link&#34; href=&#34;https://trends.google.com/trends/explore?date=all&amp;amp;q=%2Fm%2F04dzxdz,%2Fg%2F11cp5mklv8,RESTful&amp;amp;hl=en&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å…¶ç”Ÿæ€ç³»ç»Ÿçš„æ‰©å±•&lt;/a&gt;ï¼Œæˆ‘ä»¬å¯ä»¥æœŸå¾…æ”¹è¿›çš„å·¥å…·é“¾ã€æ›´å¥½çš„ç¼–è¾‘å™¨æ”¯æŒä»¥åŠæ›´é¡ºç•…åœ°èå…¥å‰ç«¯ä¸–ç•Œã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/zh-cn/p/%E8%AF%91grpc%E4%B8%91%E9%99%8B%E7%9A%84%E9%83%A8%E5%88%86/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æœ¬æ–‡é•¿æœŸé“¾æ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨è§‰å¾—æˆ‘çš„åšå®¢å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·é€šè¿‡ &lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/index.xml&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RSS&lt;/a&gt;è®¢é˜…æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–è€…åœ¨&lt;a class=&#34;link&#34; href=&#34;https://x.com/@piaopiaopig&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;X&lt;/a&gt;ä¸Šå…³æ³¨æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨æœ‰&lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;è´¦å·ï¼Œèƒ½ç»™æˆ‘ä¸ªå…³æ³¨å˜›ï¼Ÿæˆ‘çš„æ–‡ç« ç¬¬ä¸€æ—¶é—´éƒ½ä¼šå‘å¸ƒåœ¨Mediumã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>Go1.24: é™¤äº†æ ‡å‡†åº“ä¹‹å¤–ï¼Œæ‚¨ä¹Ÿè®¸åº”è¯¥æ›´åŠ å…³æ³¨ Go å·¥å…·çš„å˜åŒ–</title>
        <link>https://huizhou92.com/zh-cn/p/go124-%E9%99%A4%E4%BA%86%E6%A0%87%E5%87%86%E5%BA%93%E4%B9%8B%E5%A4%96%E6%82%A8%E4%B9%9F%E8%AE%B8%E5%BA%94%E8%AF%A5%E6%9B%B4%E5%8A%A0%E5%85%B3%E6%B3%A8-go-%E5%B7%A5%E5%85%B7%E7%9A%84%E5%8F%98%E5%8C%96/</link>
        <pubDate>Sun, 02 Feb 2025 12:00:49 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/go124-%E9%99%A4%E4%BA%86%E6%A0%87%E5%87%86%E5%BA%93%E4%B9%8B%E5%A4%96%E6%82%A8%E4%B9%9F%E8%AE%B8%E5%BA%94%E8%AF%A5%E6%9B%B4%E5%8A%A0%E5%85%B3%E6%B3%A8-go-%E5%B7%A5%E5%85%B7%E7%9A%84%E5%8F%98%E5%8C%96/</guid>
        <description>&lt;p&gt;Go 1.24 å¼•å…¥äº†è®¸å¤šå·¥å…·æ–¹é¢çš„é‡è¦æ›´æ–°ï¼Œè¿™äº›æ›´æ–°è®©å¼€å‘è€…åœ¨ç®¡ç†ä¾èµ–ã€è°ƒè¯•é—®é¢˜ä»¥åŠç¼–å†™æ›´é«˜è´¨é‡ä»£ç æ—¶å˜å¾—æ›´åŠ é«˜æ•ˆã€‚å°½ç®¡äººä»¬é€šå¸¸ä¼šå°†æ³¨æ„åŠ›é›†ä¸­åœ¨æ ‡å‡†åº“æˆ–è¯­è¨€ç‰¹æ€§ä¸Šçš„å˜åŒ–ï¼Œä½† Go å·¥å…·ç”Ÿæ€ç³»ç»Ÿçš„æ”¹è¿›åŒæ ·å€¼å¾—å…³æ³¨ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹æ¢è®¨ä¸¤ä¸ªå…³é”®é¢†åŸŸçš„æ”¹è¿›ï¼š&lt;strong&gt;go tool&lt;/strong&gt;å’Œ&lt;strong&gt;vet&lt;/strong&gt;å·¥å…·ï¼Œå¹¶é€šè¿‡å®é™…ç¤ºä¾‹å±•ç¤ºè¿™äº›æ›´æ–°å¦‚ä½•ä¼˜åŒ–ä½ çš„å·¥ä½œæµç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;go-å‘½ä»¤çš„å¢å¼ºåŠŸèƒ½&#34;&gt;&lt;strong&gt;Go å‘½ä»¤çš„å¢å¼ºåŠŸèƒ½&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Go 1.24 ä¸­ï¼Œ&lt;code&gt;go&lt;/code&gt; å‘½ä»¤è¿›è¡Œäº†å¤šé¡¹æ”¹è¿›ï¼Œä½¿å¾—ä¾èµ–ç®¡ç†å’Œå·¥å…·æ‰§è¡Œæ›´åŠ é«˜æ•ˆä¸”æ˜“äºä½¿ç”¨ã€‚å…¶ä¸­æœ€æ˜¾è‘—çš„å˜åŒ–ä¹‹ä¸€æ˜¯ &lt;code&gt;go.mod&lt;/code&gt; æ–‡ä»¶ä¸­æ–°å¢äº† &lt;code&gt;tool&lt;/code&gt; æŒ‡ä»¤ï¼Œå…è®¸ä½ ç›´æ¥è·Ÿè¸ªå¯æ‰§è¡Œå·¥å…·ä¾èµ–ï¼Œè€Œæ— éœ€ä¾èµ–è¯¸å¦‚ç©ºå¯¼å…¥ç­‰ä¸ç›´è§‚çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨-tool-æŒ‡ä»¤è·Ÿè¸ªå¯æ‰§è¡Œå·¥å…·ä¾èµ–&#34;&gt;&lt;strong&gt;ä½¿ç”¨ Tool æŒ‡ä»¤è·Ÿè¸ªå¯æ‰§è¡Œå·¥å…·ä¾èµ–&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¤§é‡ä½¿ç”¨&lt;a class=&#34;link&#34; href=&#34;https://github.com/vektra/mockery&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;mockery&lt;/code&gt;&lt;/a&gt;[1]ï¼ˆä¸€ä¸ªæµè¡Œçš„ Mock ä»£ç ç”Ÿæˆå™¨ï¼‰ï¼Œä½¿ç”¨æ–¹å¼æ˜¯é€šè¿‡brew å®‰è£…æˆ–è€…ç›´æ¥ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„exe æ‰§è¡Œæ–‡ä»¶ã€‚ä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸åŒå¼€å‘è€…ä½¿ç”¨çš„mockery ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œä¼šé€ æˆéé¢„æœŸçš„ä»£ç å†²çªã€‚åœ¨è¿‡å»ï¼Œå¦‚æœæ‚¨æƒ³å°†è¿™æ ·çš„å·¥å…·ä½œä¸ºé¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼ˆé€šå¸¸å‘½åä¸ºÂ &lt;code&gt;tools.go&lt;/code&gt;ï¼‰ï¼Œå¹¶é€šè¿‡ç©ºå¯¼å…¥æ¥å£°æ˜è¿™äº›å·¥å…·ã€‚æ¯”å¦‚ &lt;a class=&#34;link&#34; href=&#34;https://github.com/go-modules-by-example/index/blob/master/010_tools/README.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;go-modules-by-example&lt;/code&gt;&lt;/a&gt;[2] ä¸­çš„ &lt;code&gt;stringer&lt;/code&gt;&lt;br&gt;
è€Œåœ¨ Go 1.24 ä¸­ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ &lt;code&gt;go.mod&lt;/code&gt; æ–‡ä»¶ä¸­ä½¿ç”¨æ–°çš„ &lt;code&gt;tool&lt;/code&gt; æŒ‡ä»¤æ¥æ˜¾å¼å£°æ˜è¿™äº›ä¾èµ–ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;ä½¿ç”¨æ–°&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;tool&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;æŒ‡ä»¤å®‰è£…&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;mockery&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;gotip&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;get&lt;/span&gt;Â &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tool&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;github&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;vektra&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mockery&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.52.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™æ¡å‘½ä»¤ä¼šåœ¨ä½ çš„ &lt;code&gt;go.mod&lt;/code&gt; æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª &lt;code&gt;tool&lt;/code&gt; æŒ‡ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;module&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;your&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;com&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1.24&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;tool&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;github&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;vektra&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mockery&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v2&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;require&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;github&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;vektra&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;mockery&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v2&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v2&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.52.1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// indirect  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œä½ å¯ä»¥é€šè¿‡ &lt;code&gt;gotip install tool&lt;/code&gt; å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„å·¥å…·ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿è¡Œ &lt;code&gt;mockery&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gotipÂ toolÂ github.com/vektra/mockery/v2Â --allÂ Â --outputÂ ./mocks
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2025/02/7d09cc710493d907cc1e93dbd08ecce2.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;br&gt;
æˆ‘æœ¬åœ°å®‰è£…çš„mockeryæ˜¯2.32.3&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2025/02/165bf2d809cab69b80c903110ad70c5d.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;br&gt;
è¿™ç§æ–¹å¼æ¶ˆé™¤äº†å•ç‹¬ç®¡ç†å®‰è£…è¿‡ç¨‹æˆ–ç»´æŠ¤ä¸“é—¨æ–‡ä»¶çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¼“å­˜å¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠ é€Ÿè¿è¡Œ-692903&#34;&gt;ç¼“å­˜å¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠ é€Ÿè¿è¡Œ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/69290&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;#69290&lt;/a&gt;[3]
&lt;/h3&gt;&lt;p&gt;å¦ä¸€ä¸ªæ”¹è¿›æ˜¯ï¼Œé€šè¿‡è¯¸å¦‚ &lt;code&gt;go run&lt;/code&gt; æˆ–é€šè¿‡ &lt;code&gt;go tool&lt;/code&gt; æ‰§è¡Œçš„å‘½ä»¤ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç°åœ¨ä¼šè¢«ç¼“å­˜åˆ° Go çš„æ„å»ºç¼“å­˜ä¸­ï¼ˆGo 1.24 ä¹‹å‰ï¼Œcmd/go ä»…ç¼“å­˜ç¼–è¯‘åçš„åŒ…æ–‡ä»¶ï¼‰ã€‚è¿™ä¸€æ”¹å˜æ˜¾è‘—åŠ å¿«äº†é‡å¤æ‰§è¡Œçš„é€Ÿåº¦ã€‚ä½†æ˜¯è¿™æ ·ä¼šå¢åŠ ç¼“å­˜çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Go ä¼šè‡ªåŠ¨æ¸…ç†&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/2707d42966f8985a6663c93e943b9a44b9399fca/src/cmd/go/internal/cache/cache.go#L335&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;äº”å¤©å‰&lt;/a&gt;[4]çš„ç¼–è¯‘åçš„åŒ…æ–‡ä»¶çš„ç¼“å­˜ï¼Œ å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶çš„ç¼“å­˜ï¼Œè¿™ä¸ªæ•°å­—å¯èƒ½ä¼šæ˜¯ 2å¤©ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœä½ æ­£åœ¨å¼€å‘è¿‡ç¨‹ä¸­é¢‘ç¹ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·æˆ–è„šæœ¬ï¼Œè¿™ç§ç¼“å­˜æœºåˆ¶èƒ½å¤ŸèŠ‚çœå®è´µæ—¶é—´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;vet-å·¥å…·çš„å¢å¼ºåŠŸèƒ½&#34;&gt;&lt;strong&gt;Vet å·¥å…·çš„å¢å¼ºåŠŸèƒ½&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;Go çš„é™æ€åˆ†æå·¥å…· Vet åœ¨ 1.24 ä¸­æ–°å¢äº†ä¸€äº›åˆ†æå™¨ï¼Œå¹¶æ”¹è¿›äº†è¯Šæ–­èƒ½åŠ›ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´æ—©åœ°å‘ç°æ½œåœ¨é—®é¢˜å’Œå¸¸è§é”™è¯¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–°å¢-tests-åˆ†æå™¨&#34;&gt;&lt;strong&gt;æ–°å¢ Tests åˆ†æå™¨&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ä¸€ä¸ªäº®ç‚¹æ˜¯æ–°å¢äº† Tests åˆ†æå™¨ï¼Œå®ƒå¯ä»¥è¯†åˆ«æµ‹è¯•å£°æ˜ä¸­çš„é—®é¢˜ï¼Œä¾‹å¦‚åç§°æ ¼å¼é”™è¯¯ã€ä¸æ­£ç¡®çš„å‡½æ•°ç­¾åæˆ–æ–‡æ¡£åŒ–ä¸å­˜åœ¨æ ‡è¯†ç¬¦çš„é—®é¢˜ã€‚è¿™äº›é—®é¢˜å¯èƒ½å¯¼è‡´æµ‹è¯•æœªæŒ‰é¢„æœŸè¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å­˜åœ¨é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// é”™è¯¯çš„æµ‹è¯•å‡½æ•°ç­¾åï¼ˆç¼ºå°‘ *testing.T å‚æ•°ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;TestMyFunction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;This test will not run&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿è¡Œ &lt;code&gt;go vet ./...&lt;/code&gt; å°†ä¼šäº§ç”Ÿå¦‚ä¸‹è¯Šæ–­ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;blog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;go1&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.24&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tools&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;demo_test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;wrong&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;signature&lt;/span&gt;Â &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;TestMyFunction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;must&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;TestMyFunction&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;é€šè¿‡æå‰æ•è·æ­¤ç±»é”™è¯¯ï¼Œå¯ä»¥ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½èƒ½æ­£ç¡®è¿è¡Œï¼Œè€Œä¸ä¼šåœ¨ CI/CD æµç¨‹ä¸­å‡ºç°æ„å¤–é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ”¹è¿›-printf-åˆ†æå™¨&#34;&gt;&lt;strong&gt;æ”¹è¿› Printf åˆ†æå™¨&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;ç°æœ‰çš„ Printf åˆ†æå™¨ä¹Ÿå¾—åˆ°äº†å‡çº§ï¼Œå¯ä»¥æ£€æµ‹åˆ°éå¸¸é‡æ ¼å¼å­—ç¬¦ä¸²è¢«ä¼ é€’ä½†æ²¡æœ‰é™„åŠ å‚æ•°çš„é—®é¢˜â€”â€”è¿™é€šå¸¸ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯æˆ–æ„å¤–è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;Â &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt;Â &lt;span class=&#34;s&#34;&gt;&amp;#34;Hello %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;Â &lt;span class=&#34;c1&#34;&gt;// å¦‚æœ s åŒ…å«æ ¼å¼åŒ–å ä½ç¬¦ï¼Œå°†å¯¼è‡´è¿è¡Œæ—¶é—®é¢˜ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Go1.23 ç‰ˆæœ¬ä¸ä¼šå‡ºç°é”™è¯¯ï¼Œå€ŸåŠ© Go 1.24 æ”¹è¿›åçš„ Vet å·¥å…·è¯Šæ–­èƒ½åŠ›ï¼Œä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;âœ&lt;/span&gt;Â Â &lt;span class=&#34;nx&#34;&gt;tools&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;git&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;âœ—&lt;/span&gt;Â &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;vet&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/...&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;âœ&lt;/span&gt;Â Â &lt;span class=&#34;nx&#34;&gt;tools&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;git&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;Â &lt;span class=&#34;err&#34;&gt;âœ—&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;gotip&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;vet&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/...&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;blog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;go1&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.24&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tools&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;Â &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;blog&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;go1&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.24&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tools&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;demo_test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;non&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;constant&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;format&lt;/span&gt;Â &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;call&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;to&lt;/span&gt;Â &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Printf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¦ä¿®å¤æ­¤é—®é¢˜ï¼Œåªéœ€å°† &lt;code&gt;fmt.Printf(s)&lt;/code&gt; æ›¿æ¢ä¸ºä¸éœ€è¦æ ¼å¼åŒ–å‚æ•°æ—¶æ›´åˆé€‚çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š&lt;code&gt;fmt.Print(s)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;Go1.24 ä¸­è¿˜å¯¹ä»¥ä¸‹å·¥å…·è¿›è¡Œäº†ä¿®æ”¹æˆ–è€…å¢å¼º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Â Go buildæ”¯æŒç”Ÿæˆä¼ªç‰ˆæœ¬å· &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/50603&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;#50603&lt;/a&gt;[5]&lt;/li&gt;
&lt;li&gt;é»˜è®¤ä½¿èƒ½GOCACHEPROGä»¥æ”¯æŒå¤–éƒ¨ç¼“å­˜ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/64876&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;#64876&lt;/a&gt;[6]&lt;/li&gt;
&lt;li&gt;go å·¥å…·é“¾æ”¯æŒHTTPæ‰©å±•è®¤è¯ï¼šGOAUTH&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/26232&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;#26232&lt;/a&gt;[7]&lt;/li&gt;
&lt;li&gt;go buildæ”¯æŒ-json &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/62067&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;#62067&lt;/a&gt;[8]&lt;/li&gt;
&lt;li&gt;&amp;hellip;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Go 1.24 ä¸­å¯¹å·¥å…·ç”Ÿæ€ç³»ç»Ÿçš„æ›´æ–°è¡¨æ˜ï¼Œå³ä½¿æ˜¯çœ‹ä¼¼å¾®å°ä½†å®ç”¨æ€§çš„å˜åŒ–ï¼Œä¹Ÿèƒ½æå¤§åœ°æå‡å¼€å‘è€…ç”Ÿäº§åŠ›å’Œä»£ç è´¨é‡ã€‚é€šè¿‡ tool æŒ‡ä»¤ç›´æ¥è·Ÿè¸ªå¯æ‰§è¡Œå·¥å…·ä¾èµ–ï¼Œç®€åŒ–äº†ä¾èµ–ç®¡ç†å¹¶å‡å°‘äº†æ ·æ¿ä»£ç ã€‚è€Œ vet å·¥å…·å¢å¼ºåçš„è¯Šæ–­èƒ½åŠ›ï¼Œåˆ™å¸®åŠ©å¼€å‘è€…æ›´æ—©åœ°å‘ç°æ½œåœ¨ Bug å’Œå¸¸è§é”™è¯¯ï¼Œä»è€Œé¿å…åç»­é˜¶æ®µçš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;éšç€ Go çš„ä¸æ–­å‘å±•ï¼Œå¯†åˆ‡å…³æ³¨è¿™äº›å·¥å…·æ–¹é¢çš„æ”¹è¿›ï¼Œå¯ä»¥ç¡®ä¿ä½ ä¸ä»…å……åˆ†åˆ©ç”¨æ ‡å‡†åº“å’Œè¯­è¨€ç‰¹æ€§ï¼Œè¿˜èƒ½æœ€å¤§é™åº¦åœ°æé«˜å¼€å‘æ•ˆç‡ä¸ä»£ç å¯é æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼•ç”¨é“¾æ¥&#34;&gt;å¼•ç”¨é“¾æ¥
&lt;/h2&gt;&lt;p&gt;[1]mockery: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/vektra/mockery&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/vektra/mockery&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;[2]go-modules-by-example: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/go-modules-by-example/index/blob/master/010_tools/README.md&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/go-modules-by-example/index/blob/master/010_tools/README.md&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;[3]#69290: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/69290&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/golang/go/issues/69290&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;[4]trimLimit: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/2707d42966f8985a6663c93e943b9a44b9399fca/src/cmd/go/internal/cache/cache.go#L335&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/golang/go/blob/2707d42966f8985a6663c93e943b9a44b9399fca/src/cmd/go/internal/cache/cache.go#L335&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;[5]#50603: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/50603&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/golang/go/issues/50603&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;[6]#64876: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/64876&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/golang/go/issues/64876&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;[7]#26232: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/26232&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/golang/go/issues/26232&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;[8]#62067: &lt;em&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/62067&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/golang/go/issues/62067&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/zh-cn/p/go124-%E9%99%A4%E4%BA%86%E6%A0%87%E5%87%86%E5%BA%93%E4%B9%8B%E5%A4%96%E6%82%A8%E4%B9%9F%E8%AE%B8%E5%BA%94%E8%AF%A5%E6%9B%B4%E5%8A%A0%E5%85%B3%E6%B3%A8-go-%E5%B7%A5%E5%85%B7%E7%9A%84%E5%8F%98%E5%8C%96/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æœ¬æ–‡é•¿æœŸé“¾æ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨è§‰å¾—æˆ‘çš„åšå®¢å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·é€šè¿‡ &lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/index.xml&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RSS&lt;/a&gt;è®¢é˜…æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–è€…åœ¨&lt;a class=&#34;link&#34; href=&#34;https://x.com/@piaopiaopig&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;X&lt;/a&gt;ä¸Šå…³æ³¨æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨æœ‰&lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;è´¦å·ï¼Œèƒ½ç»™æˆ‘ä¸ªå…³æ³¨å˜›ï¼Ÿæˆ‘çš„æ–‡ç« ç¬¬ä¸€æ—¶é—´éƒ½ä¼šå‘å¸ƒåœ¨Mediumã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>go1.24: æ–°çš„æ ‡å‡†åº“ weak</title>
        <link>https://huizhou92.com/zh-cn/p/go1.24-%E6%96%B0%E7%9A%84%E6%A0%87%E5%87%86%E5%BA%93-weak/</link>
        <pubDate>Sat, 14 Dec 2024 19:40:46 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/go1.24-%E6%96%B0%E7%9A%84%E6%A0%87%E5%87%86%E5%BA%93-weak/</guid>
        <description>&lt;img src="https://images.hxzhouh.com/blog-images/2024/12/edbf334955e117265be0194bba455ee3.png" alt="Featured image of post go1.24: æ–°çš„æ ‡å‡†åº“ weak" /&gt;&lt;h3 id=&#34;weak-æ˜¯ä»€ä¹ˆ&#34;&gt;Weak æ˜¯ä»€ä¹ˆï¼Ÿ
&lt;/h3&gt;&lt;p&gt;Golang åœ¨1.24 ä¸­å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„&lt;code&gt;std-lib&lt;/code&gt; weakã€‚ å¯ä»¥ä¸º&lt;code&gt;*T&lt;/code&gt; åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„å¼•ç”¨ï¼Œä½†æ˜¯ä¸ä¼šé˜»æ­¢ &lt;code&gt;*T&lt;/code&gt; è¢«GC å›æ”¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Package weak provides ways to safely reference memory weakly, that is, without preventing its reclamation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;è·Ÿ &lt;code&gt;OS.ROOT &lt;/code&gt;ä¸€æ ·ï¼Œ weak ä¹Ÿæ˜¯ä¸€ä¸ªåœ¨å…¶ä»–è¯­è¨€ä¸­å­˜åœ¨å¾ˆä¹…çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Java&lt;/code&gt; çš„ &lt;code&gt;WeakReference&lt;/code&gt; å’Œ &lt;code&gt;SoftReference&lt;/code&gt; æ˜¯ç»å…¸å®ç°ï¼Œä¸»è¦ç”¨äºç¼“å­˜å’Œå¯¹è±¡æ± ã€‚å®ƒä»¬èƒ½å¤Ÿåœ¨ JVM æ£€æµ‹åˆ°å†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨å›æ”¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Python&lt;/code&gt; æä¾›äº† &lt;code&gt;weakref&lt;/code&gt; æ¨¡å—ï¼Œå…è®¸åˆ›å»ºå¼±å¼•ç”¨å¯¹è±¡ï¼Œå¸¸ç”¨äºé˜²æ­¢å¾ªç¯å¼•ç”¨é—®é¢˜æˆ–ç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c++&lt;/code&gt; åœ¨ &lt;code&gt;std::shared_ptr&lt;/code&gt; ä¸­å¼•å…¥äº† &lt;code&gt;std::weak_ptr&lt;/code&gt;ï¼Œç”¨äºè§£å†³å…±äº«æŒ‡é’ˆçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Rust&lt;/code&gt; æä¾› &lt;code&gt;Rc&lt;/code&gt; å’Œ &lt;code&gt;Arc&lt;/code&gt; çš„å¼±å¼•ç”¨ç‰ˆæœ¬ &lt;code&gt;Weak&lt;/code&gt;ï¼Œä¹Ÿç”¨äºé¿å…å¾ªç¯å¼•ç”¨å¹¶æå‡å†…å­˜ç®¡ç†çš„çµæ´»æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;weak çš„å®šä¹‰å¾ˆç®€å•ï¼Œä¸€ä¸ª&lt;code&gt;Make&lt;/code&gt; æ–¹æ³•è¿˜æœ‰ä¸€ä¸ª&lt;code&gt;Value&lt;/code&gt; æ–¹æ³•ã€‚&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/12/6bd1951326d504266e1694b6b5f61f47.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;â€œIllustration of hashtriemap structure, showcasing an efficient data storage and retrieval mechanism as a sync.Map alternative in Go programming.â€&#34;
	
	
&gt;&lt;br&gt;
é€šè¿‡&lt;code&gt;weak.Make&lt;/code&gt; åˆ›å»ºä¸€ä¸ª&lt;code&gt;weak.Pointer&lt;/code&gt; ,å¦‚æœ &lt;code&gt;T&lt;/code&gt; æ²¡æœ‰è¢«å›æ”¶çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;code&gt;weak.Pointer.Value&lt;/code&gt; è·å–&lt;code&gt;T&lt;/code&gt;çš„åœ°å€ã€‚ å¦åˆ™å°±ä¼šè¿”å› &lt;code&gt;nil&lt;/code&gt;ï¼Œå¾ˆç®€å•ã€‚&lt;br&gt;
æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥å®è·µä¸€ä¸‹ weakã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;originalObject&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Hello, World!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AddCleanup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;originalObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;originalObject clean at: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Unix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;weakPtr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;weak&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;originalObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;originalObject:addr %x&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;originalObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sprintf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;weakPtr addr:%x,size:%d&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;weakPtr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;weakPtr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Millisecond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;weakPtr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Contains&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;First GC :value: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;first gc. Weak reference value is nil&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;runtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;GC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Millisecond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;weakPtr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Second GC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Second GC: Weak reference value is nil&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://gist.github.com/hxzhouh/abd6be9ed8860e506643031bb2d446ce&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gist.github.com/hxzhouh/abd6be9ed8860e506643031bb2d446ce&lt;/a&gt;&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/abd6be9ed8860e506643031bb2d446ce.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;p&gt;è¿è¡Œç»“æœ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;âœ  weak git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;main&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; âœ— gotip version 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;go version devel go1.24-18b5435 Sun Dec &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 21:41:28 &lt;span class=&#34;m&#34;&gt;2024&lt;/span&gt; -0800 darwin/arm64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;âœ  weak git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;main&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; âœ— gotip run main.go              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;originalObject:addr &lt;span class=&#34;m&#34;&gt;14000010050&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;weakPtr addr:&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;1400000e0d0&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,size:8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;First GC :value:  Hello, World!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;originalObject clean at:  &lt;span class=&#34;m&#34;&gt;1734340907&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Second GC: Weak reference value is nil
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;string&lt;/code&gt; å˜é‡ &lt;code&gt;originalObject&lt;/code&gt; ,ç„¶åä½¿ç”¨&lt;code&gt;weak.Make&lt;/code&gt; åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;weak.Pointer&lt;/code&gt;  &lt;code&gt;weakPtr&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ç¬¬ä¸€æ¬¡GC çš„æ—¶å€™ï¼Œå› ä¸º&lt;code&gt;originalObject&lt;/code&gt; åœ¨åé¢è¿˜æœ‰ä½¿ç”¨ï¼Œæ‰€ä»¥ &lt;code&gt;weakPtr.Value&lt;/code&gt; è¿”å›äº† &lt;code&gt;originalObject&lt;/code&gt; çš„åœ°å€ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ç¬¬äºŒæ¬¡GC çš„æ—¶å€™ï¼Œ&lt;code&gt;originalObject&lt;/code&gt; æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå®ƒè¢«GCå›æ”¶äº†ï¼Œ æ‰€ä»¥ &lt;code&gt;weakPtr.Value&lt;/code&gt; è¿”å›äº†&lt;code&gt;nil&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;runtime.AddCleanup&lt;/code&gt; ä¹Ÿæ˜¯&lt;code&gt;go 1.24&lt;/code&gt;  æ–°å¢çš„åŠŸèƒ½ï¼Œå®ƒçš„åŠŸèƒ½ç±»ä¼¼ &lt;code&gt;runtime.SetFinalizer&lt;/code&gt;,ä¹Ÿæ˜¯åœ¨ å¯¹è±¡å‘—åƒåœ¾å›æ”¶çš„æ—¶å€™ç”¨äºæ‰§è¡Œä¸€æ®µä»£ç ã€‚æˆ‘åé¢å¯èƒ½ä¼šè¯¦ç»†ä»‹ç»å®ƒ&lt;br&gt;
é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;weak.Make&lt;/code&gt; é€šè¿‡åˆ›å»ºä¸€ä¸ªä¸­é—´åœ°å€(&lt;code&gt;weak.Printer&lt;/code&gt;)å°†çœŸå®åœ°å€éšè—èµ·æ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;weak.Printer&lt;/code&gt; ä¸ä¼šå½±å“ çœŸå®åœ°å€çš„åƒåœ¾å›æ”¶ï¼Œå¦‚æœçœŸå®åœ°å€è¢«åƒåœ¾å›æ”¶äº†ï¼Œ&lt;code&gt;weak.Printer.Value&lt;/code&gt; å°†ä¼šè¿”å›&lt;code&gt;nil&lt;/code&gt;ã€‚ç”±äºä¸çŸ¥é“çœŸå®åœ°å€ä»€ä¹ˆæ—¶å€™ä¼šè¢«å›æ”¶ï¼Œæ‰€ä»¥éœ€è¦ä»”ç»†æ£€æŸ¥&lt;code&gt;weak.Printer.Value&lt;/code&gt; çš„è¿”å›å€¼ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;weak-æœ‰ä»€ä¹ˆä½œç”¨&#34;&gt;Weak æœ‰ä»€ä¹ˆä½œç”¨
&lt;/h3&gt;&lt;h4 id=&#34;canonicalization-maps&#34;&gt;Canonicalization Maps
&lt;/h4&gt;&lt;p&gt;ç›¸ä¿¡æ‚¨è¿˜è®°å¾—åœ¨&lt;code&gt;go 1.23&lt;/code&gt; ä¸­æ·»åŠ çš„ &lt;code&gt;unique&lt;/code&gt; å®ƒå¯ä»¥å°†å¤šä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼ˆ8ä¸ªå­—èŠ‚ï¼‰æ¥è¡¨ç¤ºï¼Œè¾¾åˆ°èŠ‚çº¦å†…å­˜çš„ç›®çš„ , &lt;code&gt;weak&lt;/code&gt; ä¹Ÿèƒ½å®ç°ç±»ä¼¼çš„æ•ˆæœ.(å®é™…ä¸Š &lt;code&gt;go 1.24&lt;/code&gt; ä¸­&lt;code&gt;unique&lt;/code&gt; å·²ç»ä½¿ç”¨ weak é‡æ„äº†)&lt;/p&gt;
&lt;h4 id=&#34;å®ç°ä¸€ä¸ªå›ºå®šå¤§å°çš„ç¼“å­˜&#34;&gt;å®ç°ä¸€ä¸ªå›ºå®šå¤§å°çš„ç¼“å­˜
&lt;/h4&gt;&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨&lt;code&gt;weak&lt;/code&gt;+ &lt;code&gt;list.List &lt;/code&gt;å®ç° å›ºå®šå¤§å°ç¼“å­˜çš„ä¾‹å­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;WeakCache&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;weak&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Element&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Use weak references to store values  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;mu&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Mutex&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Storage&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Storage is a fixed-length cache based on doubly linked tables and weaktype Storage struct {  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Maximum size of the cache  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;     &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;List&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Set&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WeakCache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// If the element already exists, update the value and move it to the head of the chain table  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;exists&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elemValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elemValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;elemValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Value&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CacheItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MoveToFront&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;elemWeak&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;weak&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elemValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elemWeak&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;removeElement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// remove the oldest unused element if capacity is full  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;capacity&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;evict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Add new element  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;storage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;PushFront&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;CacheItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;elemWeak&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;weak&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;elem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;elemWeak&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®Œæ•´çš„ä»£ç è¯·å‚è€ƒï¼š &lt;a class=&#34;link&#34; href=&#34;https://gist.github.com/hxzhouh/1945d4a1e5a6567f084628d60b63f125&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gist.github.com/hxzhouh/1945d4a1e5a6567f084628d60b63f125&lt;/a&gt;&lt;br&gt;
æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„&lt;code&gt;list&lt;/code&gt; ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ª&lt;code&gt;Map&lt;/code&gt;è®°å½•&lt;code&gt;key&lt;/code&gt;åœ¨&lt;code&gt;list&lt;/code&gt; ä¸­çš„ä½ç½®ï¼Œ&lt;code&gt;value&lt;/code&gt; æ˜¯ä¸€ä¸ªæŒ‡å‘  &lt;code&gt;list.Element&lt;/code&gt;  çš„&lt;code&gt;weak.Pointer&lt;/code&gt;. å¦‚æœ key å­˜åœ¨äºlist ä¸Šï¼Œé‚£ä¹ˆ &lt;code&gt;Map[key].Value&lt;/code&gt; ä¼šè¿”å› list çš„åœ°å€ã€‚ å†ç»™cache æ·»åŠ æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­list çš„å¤§å°ï¼Œå¦‚æœå·²ç»listå·²ç»æ»¡äº†çš„è¯ï¼Œå°±æŠŠé˜Ÿå°¾çš„æ•°æ®æ·˜æ±°ã€‚&lt;code&gt;Map[key].Value&lt;/code&gt;è¿”å›nilã€‚&lt;br&gt;
è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½æ„å»ºä¸€ä¸ªé«˜æ•ˆ+å›ºå®šå¤§å°çš„&lt;code&gt;cache&lt;/code&gt;ç³»ç»Ÿã€‚  &lt;code&gt;weak&lt;/code&gt; +  &lt;code&gt;æ— é”é˜Ÿåˆ—&lt;/code&gt; å¯ä»¥æ„å»ºå‡ºæ›´åŠ é«˜æ•ˆçš„æ•°æ®ç»“æ„ã€‚&lt;br&gt;
å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œ&lt;code&gt;weak&lt;/code&gt; åœ¨ç‰¹å®šåœºåˆä¸‹è¿˜æ˜¯æŒºæœ‰ç”¨å¤„çš„ã€‚ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä¼šåœ¨é¡¹ç›®ä¸­ç§¯æä½¿ç”¨&lt;code&gt;weak&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ›´å¤šå…³äº weak çš„èµ„æ–™&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://tip.golang.org/doc/go1.24#weak&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://tip.golang.org/doc/go1.24#weak&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/67552&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://github.com/golang/go/issues/67552&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
        </item>
        <item>
        <title>Go é«˜æ€§èƒ½ç¼–ç¨‹ EP9: ä¸¤ä¸ªæœ‰ç”¨çš„ Golang æ— é”ç¼–ç¨‹æŠ€å·§</title>
        <link>https://huizhou92.com/zh-cn/p/go-%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%96%E7%A8%8B-ep9-%E4%B8%A4%E4%B8%AA%E6%9C%89%E7%94%A8%E7%9A%84-golang-%E6%97%A0%E9%94%81%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/</link>
        <pubDate>Sat, 19 Oct 2024 12:03:18 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/go-%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%96%E7%A8%8B-ep9-%E4%B8%A4%E4%B8%AA%E6%9C%89%E7%94%A8%E7%9A%84-golang-%E6%97%A0%E9%94%81%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/</guid>
        <description>&lt;p&gt;å¯¹äºæ— é”ç¼–ç¨‹æ¥è®²ï¼Œæ— é”åªæ˜¯ä¸€ä¸ªè¡¨è±¡ï¼Œç¼–ç¨‹è€…è®¾æ³•ç»„ç»‡ data+processingï¼Œé‡ç‚¹åœ¨äºå¦‚ä½•æ¶ˆé™¤ &lt;code&gt;dataracing&lt;/code&gt;ã€‚è€Œæ¶ˆé™¤ &lt;code&gt;dataracing&lt;/code&gt; è€Œè¨€ï¼Œä¼ ç»Ÿçš„å¹¶å‘ç¼–ç¨‹é€»è¾‘æ˜¯é‡‡ç”¨å…³é”®åŒºã€æ’ä»–æ€§é”ã€è¯»å†™é”ç­‰æ–¹å¼æ¥ä¿æŠ¤ data ä¸ä¼šå› ä¸º processing è€Œå¯¼è‡´é”™è¯¯è¯»æˆ–é”™è¯¯å†™ï¼Œé‚£ä¹ˆå¯¹äºæ— é”ç¼–ç¨‹æ¥è¯´ï¼Œåˆ™æ˜¯é€šè¿‡æ¶ˆé™¤ data çš„å…±äº«æ€§ï¼Œæˆ–è€…æ¶ˆé™¤å¹¶å‘æ“ä½œ data ç­‰æ–¹å¼æ¥è§£å†³é—®é¢˜ã€‚&lt;br&gt;
æ‰€ä»¥æœ€å…¸å‹çš„æ— é”ç¼–ç¨‹æŠ€æ³•åŒ…å«ä¸¤ä¸ªæŠ€å·§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;structure&lt;/li&gt;
&lt;li&gt;bumper loop&lt;br&gt;
å…¶ä»–çš„æ–¹æ³•éƒ½æ˜¯ç›¸ä¼¼æ€è·¯çš„å…·ä½“è¡ç”Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œçš„â€œå…¶ä»–çš„æ–¹æ³•â€ï¼Œæ˜¯æŒ‡å®Œå…¨ä¸ä½¿ç”¨é”å®šæˆ– CAS çš„ç®—æ³•è®¾è®¡æ–¹æ¡ˆã€‚æœ¬æ–‡ä¸­è®¨è®ºçš„æ˜¯å¦‚ä½•è®¾è®¡æ•°æ®ç»“æ„åŠå…¶å¤„ç†å™¨ï¼ˆç®—æ³•ï¼‰æ¥é˜²æ­¢åŠ é”ï¼Œç”šè‡³äºè¿ CAS ä¹Ÿå»é™¤ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;è‡³äºåœ¨å…±äº«çš„&lt;code&gt;data&lt;/code&gt;ä¸Šå¼ºè¡Œæ¶ˆé™¤ç«äº‰è¯»å†™é—®é¢˜çš„å…¶ä»–æ— é”æ–¹æ¡ˆï¼Œä¾‹å¦‚&lt;code&gt;RingBuffer&lt;/code&gt;ä¹‹ç±»çš„å·¥å…·ç±»åº“ï¼Œåˆ™æ˜¯å®Œå…¨ä¾èµ–äºå…·ä½“çš„ &lt;code&gt;data&lt;/code&gt; å®ä½“å¹¶åœ¨å…·ä½“çš„ CPU ä¸Šè¿›è¡Œè®¾è®¡ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸€ç§å¾ˆå—é™çš„æ–¹æ³•ï¼Œä¸å…·å¤‡é«˜å±‚æ¬¡æŠ½è±¡å±‚é¢çš„é€šç”¨æ€§ã€‚å°½ç®¡å…¶å…·ä½“çš„è®¾è®¡æ€è·¯æœ‰è¿¹å¯å¾ªï¼Œä½†å´ä¸æ˜¯æœ€ä½³çš„é€‰æ‹©ï¼šä¸€ä¸ªä¼˜ç§€çš„  &lt;code&gt;RingBuffer&lt;/code&gt;ï¼Œå®ƒçš„è‡´å‘½ä¹‹å¤„å°±åœ¨äºåœ¨å•æ ¸å¿ƒçš„CPUä¸Šï¼Œæˆ–è€…å•é¢— vCPU çš„ vHost ä¸Šå¯èƒ½æ˜¯æ— æ³•é™çº§å·¥ä½œçš„ï¼Œæˆ–è€…å³ä½¿èƒ½å·¥ä½œä¹Ÿæ˜¯ä½æ•ˆçš„æˆ–è€…é«˜æ¶ˆè´¹çš„ã€‚æ‰€ä»¥æœ¬æ–‡è®¨è®ºçš„æ˜¯æ›´é€šç”¨çš„ï¼Œåœ¨ä»»ä½•é«˜çº§è¯­è¨€ï¼ˆæ— è®ºå…¶çº¿ç¨‹ã€åç¨‹æ”¯æŒåº¦å¦‚ä½•ï¼‰äºä»»ä½• Targets ä¸Šéƒ½å¯ä»¥é€šè¡Œçš„æ— é”ç¼–ç¨‹æŠ€æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;structure-copy&#34;&gt;Structure copy
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Structure copy&lt;/code&gt;æ˜¯ä¸€ç§ç»å…¸çš„æ— é”ç¼–ç¨‹æŠ€å·§ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³åœ¨äºå°†æ˜“å˜æ•°æ®äº¤ç»™ä¸€ä¸ª structure ç®¡ç†ï¼Œé€šå¸¸å¯èƒ½èµ·åä¸º Entryï¼Œç„¶ååœ¨è¿™ä¸ª structure ä¸Šå±•å¼€æ•°æ®å¤„ç†è¿‡ç¨‹ã€‚å¦‚æ­¤ï¼Œç”±äºæ•°æ®å¤„ç†è¿‡ç¨‹åªä¼šæ“ä½œå…¶æ‰€å…³è”åˆ°çš„ &lt;code&gt;structure&lt;/code&gt;ï¼Œå› æ­¤è¿™ä¸€ç»„æ•°æ®æœ¬èº«å°±æ˜¯éå…±äº«çš„ï¼Œä¹Ÿå°±ä¸éœ€è¦è€ƒè™‘ &lt;code&gt;dataracing&lt;/code&gt; çš„æ½œåœ¨å¯èƒ½æ€§çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Worker&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;closed&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int32&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// avoid duplicated release rsrc in Close()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;entries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Entry&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Entry&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;Count&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;any&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Worker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;New&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Entry&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Entry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;entries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;entries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;e&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Entry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;c1&#34;&gt;// processing e.data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å‡è®¾åˆå§‹åŒ–æ•°æ® &lt;code&gt;data []any&lt;/code&gt; è¢«æä¾›ç»™ Workerï¼ŒåŸºäºæ­¤äº§ç”Ÿä¸€ä¸ª &lt;code&gt;Entry&lt;/code&gt;ï¼Œç„¶åé€šè¿‡ &lt;code&gt;Entry.Run&lt;/code&gt; æ¥å¤„ç†åˆå§‹åŒ–æ•°æ®ï¼Œäº§ç”Ÿç»“æœï¼Œé‚£ä¹ˆä¸Šé¢çš„ç¤ºä¾‹ä»£ç å°±é¿å…äº†æ•°æ®åŒ…ï¼ˆCountï¼ŒDataï¼‰çš„å…±äº«é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªæ•°æ®åŒ…æ˜¯æ’ä»–æ€§ç‹¬ç«‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ—¶å€™æˆ‘ä»¬çš„æ•°æ®åŒ…å¾ˆéš¾æ‹†è§£ï¼Œæ­¤æ—¶å¯ä»¥ä»¥è¡ç”ŸæŠ€æ³•æ¥å®ç°æ‹†è§£ã€‚å…·ä½“çš„æ€è·¯æ˜¯è®¾æ³•è¿›è¡Œåˆ†æ²»ã€‚å³æ•°æ®åŒ…å¯ä»¥æŒ‰ç…§æ¨è¿›ç¨‹åº¦é‡æ–°è®¾è®¡ä¸º step1ï¼Œstep2ï¼Œç­‰ç­‰ï¼Œæ¯ä¸€æ­¥éª¤ä¸­çš„å°æ•°æ®åŒ…çš„è®¡ç®—ç»“æœä¾æ¬¡æäº¤ç»™ä¸‹ä¸€æ­¥éª¤ã€‚åˆæˆ–è€…æ•°æ®åŒ…å¯ä»¥æ‹†è§£ä¸ºè‹¥å¹²ä¸ªå°è®¡é¡¹ç›®ï¼Œæœ€åå°†å¤šä¸ªå°è®¡ç»“æœåˆå¹¶è®¡ç®—ï¼ˆMap-Reduce?ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºé‡‡å–å“ªç§æ‹†è§£æ€è·¯ï¼Œæ€»çš„æ€è·¯ä¸å˜ï¼Œå³å•ä¸ª processing æ‰€æ“ä½œçš„ data æ˜¯æ’ä»–æ€§ç‹¬ç«‹çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä»è€Œä»æ ¹æœ¬ä¸Šå»é™¤å…±äº«åŠ é”è§£é”çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜
&lt;/h4&gt;&lt;p&gt;é—®é¢˜åœ¨äºå¤ªå¤šçš„å°å—å†…å­˜ï¼ˆEntry structï¼‰å¯èƒ½æ˜¯ä¸å¥½çš„ã€‚ä¸€æ–¹é¢å®ƒå¯èƒ½å¸¦æ¥é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼ˆå¦‚æœæ­£åœ¨å¤„ç†ä¸€ä¸ªå·¨å¤§çš„é“¾è¡¨ã€æ•°ç»„ä¹‹ç±»ï¼Œä½ ä¸å¤ªå¯èƒ½æ€»æ˜¯åˆ¶é€ å®ƒä»¬çš„å‰¯æœ¬ï¼‰ï¼Œå¦ä¸€æ–¹é¢ï¼Œå¤ªå¤šé¢‘ç¹çš„å°å—å†…å­˜çš„åˆ†å‘å’Œææ„ä¹Ÿä¼šäº§ç”Ÿéš¾ä»¥æ¥å—çš„å¼€é”€ã€‚æœ‰æ—¶å€™ï¼Œå¼ºåˆ¶è¿™æ ·çš„å°å—å†…å­˜åœ¨æ ˆä¸Šåˆ†é…ï¼ˆå¦‚æœè¯­è¨€æˆ–è€…ç¼–è¯‘å™¨æ”¯æŒï¼‰æ˜¯è§£å†³åä¸€é—®é¢˜çš„è‰¯è¯ã€‚ä¸è¿‡æ›´å¤šçš„æƒ…å†µä¸‹ã€æˆ–è®¸è¿™çš„ç¡®å°±æ˜¯ä¸å¯è¡Œçš„ã€‚&lt;br&gt;
å½“ç„¶ï¼Œå¸¦æœ‰ GC çš„è¯­è¨€è¿™æ–¹é¢çš„å‹åŠ›ä¼šå°ä¸€ç‚¹ã€‚  å…¶æ¬¡ï¼Œä½¿ç”¨ä¸€ä¸ª&lt;code&gt;sync.Pool&lt;/code&gt;ä¹Ÿå¯ä»¥å‡è½»å°å†…å­˜é¢‘ç¹åˆ†é…çš„å‹åŠ›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åº”ç”¨&#34;&gt;åº”ç”¨
&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Logger&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// for structured logging  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Handler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;interface&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	 &lt;span class=&#34;nf&#34;&gt;Handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;l&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Debug&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LevelDebug&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;l&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Logger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;level&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;ã€‚ã€‚ã€‚ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewRecord&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;err&#34;&gt;ã€‚ã€‚ã€‚ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Handler&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;slog&lt;/code&gt; ä¸­ï¼Œæ¯æ¡æ—¥å¿—éƒ½ä¼šè¢«åŒ…è£…æˆä¸€ä¸ª&lt;code&gt;NewRecord&lt;/code&gt; ï¼Œé¿å…äº†æ•°æ®ç«äº‰ã€‚&lt;br&gt;
Entry æ¨¡å¼å¯ä»¥è¯´æ˜¯åˆ°å¤„éƒ½æœ‰åœ¨ç”¨ï¼Œç”¨é€”ä¹Ÿä¸ä¸€å®šé™äºä¸ºäº†æ— é”ã€‚ç„¶è€Œå‡¡æ˜¯è¿ç”¨åˆ°è¯¥æ¨¡å¼çš„åœ°æ–¹ï¼Œè‡ªåŠ¨è·å¾—äº†æ— é”çš„æ”¶ç›Šï¼Œè¿™å…¶å®æ˜¯å¾ˆåˆ’ç®—çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;bumper-loop&#34;&gt;Bumper Loop
&lt;/h2&gt;&lt;p&gt;Bumper Loopæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bumper Loop æœ€ç»å…¸çš„ä¾‹å­æ˜¯Redis, Redis ä½¿ç”¨å¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡å¤„ç†ä¸Šä½¿ç”¨å•çº¿ç¨‹ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¹¶è¡Œäº‹ä»¶å¼ºè¡Œåºåˆ—åŒ–ï¼Œç„¶åå†ä¸€ä¸€åˆ†å‘ç»™å…·ä½“å¤„ç†ç¨‹åºã€‚äºæ˜¯å¯¹äºè¿™äº›å…·ä½“å¤„ç†ç¨‹åºæ¥è®²ï¼Œå…±äº«æ•°æ®æ€»æ˜¯æ’ä»–æ€§çš„ï¼šå› ä¸ºæ‰€æœ‰å¤„ç†ç¨‹åºåœ¨åŒä¸€æ—¶é—´ä¸‹åªä¼šè¿è¡Œä¸€ä¸ªã€‚å¦‚æœå…·ä½“å¤„ç†ç¨‹åºæ€»æ˜¯é£å¿«åœ°å®Œæˆï¼Œæ²¡æœ‰é˜»å¡çš„å¿§è™‘ï¼Œé‚£ä¹ˆ&lt;code&gt;Bumper Loop&lt;/code&gt;æ¨¡å¼å°†ä¼šæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ¶ˆè´¹æ¨¡å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;w&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Worker&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;runLoop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ev&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:=&amp;lt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileWatcherCh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;onFileChanged&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ev&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¯¹äºä½é¢‘äº‹ä»¶çš„åˆ†å‘å’Œç®€åŒ–å¹¶åœ¨æ­¤åŒæ—¶å»é™¤åŠ é”éœ€æ±‚ã€æå‡æ€§èƒ½æ¥è¯´ï¼Œå¾ªç¯æ³µæ¨¡å¼æ˜¯ä¸€æ—¶ä¹‹é€‰ã€‚åœ¨è¯¸å¦‚ TCP/IP æœåŠ¡å™¨çš„&lt;code&gt; incoming data&lt;/code&gt; å¤„ç†ä¸Šé€šå¸¸&lt;code&gt;Bumper Loop&lt;/code&gt; æ˜¯æœ€ä½³é€‰æ‹©ï¼š&lt;/p&gt;
&lt;p&gt;å¯¹æ–°è¿›è¿æ¥è¯·æ±‚é‡‡å– Entry æ¨¡å¼åˆ¶ä½œä¸€ä¸ªç‹¬ç«‹çš„å¤„ç†å™¨ connectionProcessorï¼Œè¯¥å¤„ç†å™¨ä¸­ä»¥å¾ªç¯æ³µæ¨¡å¼æ¥å—è¾“å…¥æ•°æ®ï¼Œè¯†åˆ«è¾“å…¥æ•°æ®çš„æ¨¡å¼ä¸ºè§„çº¦å‘½ä»¤ï¼Œç„¶ååˆ†å‘ç»™å…·ä½“çš„è§„çº¦å‘½ä»¤å¤„ç†å™¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é—®é¢˜-1&#34;&gt;é—®é¢˜
&lt;/h4&gt;&lt;p&gt;&lt;code&gt;Bumper Loop &lt;/code&gt;çš„é—®é¢˜åœ¨äºï¼Œä¸€ä¸ªé˜»å¡ä¼šç ´åæ•´ä¸ªå¾ªç¯ï¼Œä¸€ä¸ªè¿‡æ…¢çš„å¤„ç†ä¼šå¸¦æ¥ä¸å¯çŸ¥çš„ä¸‹ä¸€äº‹ä»¶çš„å¤„ç†å»¶è¿Ÿï¼Œé«˜é¢‘ç‡çš„äº‹ä»¶ä¼šåœ¨åˆ†å‘ç‚¹ä¸Šé˜»å¡ã€å †ç§¯ï¼Œç”šè‡³æ˜¯ä¸¢å¤±ã€‚å°½ç®¡ Bumper Loop ä¼¼ä¹å¾ˆæ˜æ˜¾åœ°æœ‰ä¸²è¡ŒåŒ–çš„æ•ˆç‡åŠ£åŠ¿ï¼Œä½†å®ƒä»è¢«å¹¿æ³›åœ°ç”¨äº TCP/IP server/client ç¼–ç¨‹ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;structure-copy-ä¸-bumper-loop-ç»“åˆ&#34;&gt;Structure Copy ä¸ Bumper Loop ç»“åˆ
&lt;/h3&gt;&lt;p&gt;Bumper Loop çš„é—®é¢˜ä¹‹ä¸€æ˜¯ä¸å¤ªé€‚åˆé«˜é¢‘äº‹ä»¶åœºæ™¯ï¼Œä¸€èˆ¬æ¥è¯´äº‹ä»¶é¢‘ç‡åœ¨80msä»¥ä¸Šæ—¶æ‰æ¯”è¾ƒå¥½ç”¨ã€‚è¿™ç§å°ºåº¦çš„éšå–»æ˜¯è¯´å•æ¬¡äº‹ä»¶å¤„ç†å¹³å‡è€—æ—¶åº”è¯¥å°äº 80msã€‚&lt;br&gt;
åœ¨ä¸é‚£ä¹ˆä¸¥æ ¼çš„åœºæ™¯ä¸­ï¼ˆä¾‹å¦‚éé‡‘èé«˜é¢‘äº¤æ˜“ï¼‰ï¼Œæœ‰æ—¶å€™å¯ä»¥åœ¨è€—æ—¶çš„äº‹ä»¶å¤„ç†å™¨ä¸­å¯åŠ¨ä¸€ä¸ª &lt;code&gt;gorountine&lt;/code&gt; å»å¼‚æ­¥åœ°æ…¢æ…¢å¤„ç†ï¼Œè€Œä¸»ä½“çš„ bumpper loop åˆ™ç»§ç»­å»åˆ†å‘åç»§äº‹ä»¶ã€‚è¿™æ—¶å€™å¼‚æ­¥ go routine åˆå¯ä»¥ç”¨åˆ° Entry æ¨¡å¼ï¼Œé€‚å½“åœ°å¤åˆ¶å°‘è®¸çŠ¶æ€ä»¥ä¾¿è§£è€¦ç«æ€æ¡ä»¶ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title> SwissTable ä¼šæˆä¸º Golang std mapå˜›ï¼Ÿ</title>
        <link>https://huizhou92.com/zh-cn/p/swisstable-%E4%BC%9A%E6%88%90%E4%B8%BA-golang-std-map%E5%98%9B/</link>
        <pubDate>Mon, 30 Sep 2024 11:25:51 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/swisstable-%E4%BC%9A%E6%88%90%E4%B8%BA-golang-std-map%E5%98%9B/</guid>
        <description>&lt;img src="https://images.hxzhouh.com/blog-images/2024/09/f08c74aea8485d51d461d18494df416e.png" alt="Featured image of post  SwissTable ä¼šæˆä¸º Golang std mapå˜›ï¼Ÿ" /&gt;&lt;p&gt;2022å¹´ï¼Œå­—èŠ‚è·³åŠ¨ç»™&lt;code&gt;Golang&lt;/code&gt;æäº†&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/issues/54766&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;issue&lt;/a&gt;å»ºè®®æŠŠmapçš„åº•å±‚å®ç°æ”¹æˆSwissTableçš„ã€‚2023å¹´ï¼Œdoltå†™äº†ä¸€ç¯‡åšå®¢&lt;a class=&#34;link&#34; href=&#34;https://www.dolthub.com/blog/2023-03-28-swiss-map/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;SwissMap: A smaller, faster Golang Hash Table&lt;/a&gt; åˆ†äº«ä»–ä»¬ è®¾è®¡äº†ä¸€ä¸ªåŸºäºSwissTable çš„ Map ,å¼•èµ·äº†å¹¿æ³›çš„å…³æ³¨ã€‚ç›®å‰ Go æ ¸å¿ƒå›¢é˜Ÿå·²ç»å¼€å§‹é‡æ–°å®¡è§†  &lt;code&gt;swisstable&lt;/code&gt; è®¾è®¡ï¼Œåœ¨&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/6a730e1ef0b7f312fe01815086a2eb5a25739f2d/src/runtime/map_swiss.go#L7&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;runtime&lt;/code&gt;&lt;/a&gt;ä¸­ä¹Ÿæ·»åŠ äº†éƒ¨åˆ†ä»£ç ï¼Œè¶ç€å‡æœŸï¼Œåˆšå¥½æœ‰æ—¶é—´æ·±å…¥äº†è§£ä¸€ä¸‹åŸç†ï¼Œè·Ÿ&lt;code&gt;runtime map&lt;/code&gt; ç›¸æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒå¯èƒ½ä¼šæˆä¸º&lt;code&gt;map&lt;/code&gt;çš„æ ‡å‡†å®ç°ã€‚&lt;/p&gt;
&lt;!-- more--&gt;
&lt;blockquote&gt;
&lt;p&gt;This article was first published in the Medium MPP plan. If you are a Medium user, please follow me on &lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;. Thank you very much.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä¸ä¼šå®Œå…¨è§£é‡Š&lt;code&gt;hashtable&lt;/code&gt;æˆ–è€…&lt;code&gt;swisstable&lt;/code&gt;çš„åŸç†ã€‚æ‚¨éœ€è¦å¯¹&lt;code&gt;hashtable&lt;/code&gt; æœ‰ä¸€å®šçš„äº†è§£ã€‚&lt;/p&gt;
&lt;p&gt;å“ˆå¸Œè¡¨æä¾›äº†ä¸€ä¸ª&lt;code&gt;key&lt;/code&gt;åˆ°å¯¹åº”&lt;code&gt;value&lt;/code&gt;çš„æ˜ å°„ï¼Œé€šè¿‡ä¸€ä¸ª&lt;code&gt;hashå‡½æ•°&lt;/code&gt;æŠŠ&lt;code&gt;key&lt;/code&gt;è½¬æ¢æˆæŸä¸ªâ€œä½ç½®â€œï¼Œä»è¿™ä¸ªä½ç½®ä¸Šå¯ä»¥ç›´æ¥æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„valueï¼Œ&lt;/p&gt;
&lt;h2 id=&#34;ä¼ ç»Ÿ-hashtable&#34;&gt;ä¼ ç»Ÿ &lt;code&gt;hashtable&lt;/code&gt;
&lt;/h2&gt;&lt;p&gt;å“ˆå¸Œè¡¨æä¾›äº†ä¸€ä¸ª&lt;code&gt;key&lt;/code&gt;åˆ°å¯¹åº”valueçš„æ˜ å°„ï¼Œé€šè¿‡ä¸€ä¸ª&lt;code&gt;hashå‡½æ•°&lt;/code&gt;æŠŠkeyè½¬æ¢æˆæŸä¸ªâ€œä½ç½®â€œï¼Œä»è¿™ä¸ªä½ç½®ä¸Šå¯ä»¥ç›´æ¥æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„valueã€‚ä¸è¿‡ï¼Œå³ä½¿&lt;code&gt;hashå‡½æ•°&lt;/code&gt;å†å®Œç¾ï¼ŒæŠŠæ— é™çš„&lt;code&gt;key&lt;/code&gt;æ˜ å°„åˆ°ä¸€ä¸ªæœ‰é™å¤§å°çš„å†…å­˜ç©ºé—´å†…ä¹Ÿè¿˜æ˜¯ä¸å¯é¿å…å¾—ä¼šäº§ç”Ÿå†²çªï¼šä¸¤ä¸ªä¸åŒçš„&lt;code&gt;key&lt;/code&gt;ä¼šè¢«æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®ã€‚  ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¼ ç»Ÿçš„&lt;code&gt;hashtable&lt;/code&gt;æœ‰å¥½å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæœ€å¸¸è§çš„è§£å†³å†²çªçš„åŠæ³•æœ‰â€œé“¾è¡¨æ³•â€å’Œâ€œçº¿æ€§æ¢æµ‹æ³•â€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;é“¾è¡¨æ³•&#34;&gt;é“¾è¡¨æ³•
&lt;/h3&gt;&lt;p&gt;é“¾è¡¨æ³•æ˜¯æœ€å¸¸è§çš„ï¼Œå®ƒçš„ä¸­å¿ƒæ€æƒ³åœ¨äºå¦‚æœkeyæ˜ å°„åˆ°äº†ç›¸åŒçš„ä½ç½®ï¼Œé‚£ä¹ˆå°±æŠŠè¿™äº›keyå’Œvalueå­˜åœ¨ä¸€å¼ é“¾è¡¨é‡Œã€‚æŸ¥æ‰¾çš„æ—¶å€™å…ˆç”¨hashå‡½æ•°è®¡ç®—å¾—åˆ°ä½ç½®ï¼Œç„¶åå†ä»å­˜æ”¾åœ¨è¯¥ä½ç½®ä¸Šçš„é“¾è¡¨é‡Œä¸€ä¸ªä¸ªéå†æ‰¾åˆ°keyç›¸ç­‰çš„æ¡ç›®ã€‚å®ƒçš„ç»“æ„ç±»ä¼¼è¿™æ ·ï¼š&lt;br&gt;
figure 1: æ‹‰é“¾æ³•å®ç° &lt;code&gt;hashtable&lt;/code&gt;&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/09/096dbea584499aaf3f2adb6111a89b0e.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Pasted image 20240929145217&#34;
	
	
&gt;&lt;br&gt;
é“¾è¡¨æ³•å®ç°å¾ˆç®€å•ï¼Œæ²¡é‚£ä¹ˆå¤šè¾¹ç•Œæ¡ä»¶è¦è€ƒè™‘,æ’å…¥æ•°æ®å’Œåˆ é™¤æ•°æ®å¾ˆå¿«ï¼Œæ’å…¥ç”¨é“¾è¡¨çš„å¤´æ’æ³•ï¼Œåˆ é™¤åªéœ€è¦ç§»åŠ¨éƒ¨åˆ†èŠ‚ç‚¹çš„nextæŒ‡é’ˆã€‚æ­¤å¤–ï¼Œé“¾è¡¨æ³•èƒ½é‡‡å–æ‰©å®¹ä¹‹å¤–çš„æ‰‹æ®µé˜»æ­¢æŸ¥è¯¢æ€§èƒ½é€€åŒ–ï¼Œæ¯”å¦‚æŠŠè¿‡é•¿é“¾è¡¨è½¬æ¢æˆæœç´¢æ ‘ç­‰ã€‚é“¾è¡¨æ³•çš„ç¼ºç‚¹æ˜¯æœ¬èº«å¯¹ç¼“å­˜ä¸å¤Ÿå‹å¥½ï¼Œå†²çªè¾ƒå¤šçš„æ—¶å€™ç¼“å­˜å‘½ä¸­ç‡è¾ƒä½ä»è€Œå½±å“æ€§èƒ½ã€‚ä¸åŒçš„&lt;code&gt;slot&lt;/code&gt;ä¹‹é—´æ•°æ®åœ¨å†…å­˜é‡Œçš„è·¨åº¦è¾ƒå¤§ï¼Œæ•°æ®ç»“æ„æ•´ä½“çš„ç©ºé—´å±€éƒ¨æ€§è¾ƒå·®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;çº¿æ€§æ¢æµ‹æ³•&#34;&gt;çº¿æ€§æ¢æµ‹æ³•
&lt;/h3&gt;&lt;p&gt;çº¿æ€§æ¢æµ‹æ˜¯å¦ä¸€ç§å¸¸è§çš„å“ˆå¸Œè¡¨å†²çªè§£å†³æ–¹æ³•ã€‚å®ƒè§£å†³å†²çªçš„æ–¹å¼äºé“¾è¡¨æ³•ä¸åŒï¼Œåœ¨é‡åˆ°hashå†²çªçš„æ—¶å€™ï¼Œå®ƒä¼šä»å†²çªçš„ä½ç½®å¼€å§‹å‘åä¸€ä¸ªä¸ªæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºä½ï¼Œæˆ–è€…æ²¡æ‰¾åˆ°ç„¶åç´¢å¼•å›åˆ°äº†å†²çªå‘ç”Ÿçš„ä½ç½®ï¼Œè¿™æ—¶ä¼šè¿›è¡Œæ‰©å®¹ç„¶åå†é‡æ–°æ‰§è¡Œä¸Šè¿°æ’å…¥æµç¨‹ã€‚&lt;br&gt;
Figure 2 ï¼šçº¿æ€§æ¢æµ‹æ³•æ·»åŠ æ•°æ® åŠ¨ç”»æ¼”ç¤º&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/09/bfb5cfbb7f611f0fed2f4d58c0eceaf4.gif&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;çº¿æ€§æ¢ æµ‹æ³•åŠ¨ç”»æ¼”ç¤º&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œé¦–å…ˆé€šè¿‡hashå‡½æ•°è®¡ç®—å¾—åˆ°å…ƒç´ åº”è¯¥åœ¨çš„ä½ç½®ï¼Œç„¶åä»è¿™ä¸ªä½ç½®å¼€å§‹ä¸€ä¸ªä¸ªæ¯”è¾ƒkeyæ˜¯å¦ç›¸ç­‰ï¼Œé‡åˆ°è¢«åˆ é™¤çš„å…ƒç´ å°±è·³è¿‡ï¼Œé‡åˆ°ç©ºçš„slotå°±åœæ­¢æœç´¢ï¼Œè¿™è¡¨ç¤ºå…ƒç´ ä¸åœ¨è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­ã€‚æ‰€ä»¥åˆ é™¤å…ƒç´ çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯æ ‡è®°åˆ é™¤ã€‚&lt;br&gt;
Figure 3: çº¿æ€§æ¢æµ‹æ³•æŸ¥æ‰¾æ•°æ®æ¼”ç¤º&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/09/f0052b66a4e66fb5e9558c4e48601bd7.gif&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;çº¿æ€§æ¢æµ‹æ³•æŸ¥æ‰¾æ¼”ç¤º&#34;
	
	
&gt;&lt;br&gt;
çº¿æ€§æ¢æµ‹æ³• çš„æ—¶é—´å¤æ‚åº¦è·Ÿé“¾è¡¨æ³•å·®ä¸å¤šï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯å¯¹ç¼“å­˜å‹å¥½ï¼Œç°åœ¨å¯ä»¥ç”¨æ•°ç»„ä¹‹ç±»çš„ç´§å¯†æ•°æ®ç»“æ„å®ç°ã€‚åŒæ—¶ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®ç°å¤æ‚ï¼Œä¸€ä¸ª&lt;code&gt;slot&lt;/code&gt;æœ‰å…ƒç´ ã€ç©ºã€è¢«åˆ é™¤è¿™ä¸‰ç§çŠ¶æ€&lt;/li&gt;
&lt;li&gt;hashå†²çªæ˜¯è¿é”å¼çš„ï¼Œä¸€å¤„å†²çªå¯èƒ½ä¼šè¿ç»­å½±å“å¤šå¤„ï¼Œæœ€ç»ˆå¯¼è‡´æ’å…¥åŒæ ·çš„æ•°æ®ï¼Œå®ƒæ‰©å®¹çš„æ¬¡æ•°ä¼šæ¯”é“¾è¡¨æ³•æ›´å¤šï¼Œæœ€ç»ˆå¯èƒ½ä¼šç”¨æ‰æ›´å¤šçš„å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;å› ä¸ºå†²çªä¼šé€ æˆåç»­æ’å…¥å’Œåˆ é™¤çš„è¿é”ååº”ï¼Œæ‰€ä»¥æŸ¥æ‰¾è¿‡ç¨‹é€€åŒ–åˆ°&lt;code&gt;O(n)&lt;/code&gt;çš„æ¦‚ç‡æ›´å¤§ï¼Œè€Œä¸”æ²¡æ³•åƒé“¾è¡¨æ³•é‚£æ ·æŠŠæœ‰å¤§é‡å†²çªçš„åœ°æ–¹è½¬æ¢æˆæœç´¢æ ‘ä¹‹ç±»çš„ç»“æ„ã€‚&lt;br&gt;
å› ä¸ºåˆ é™¤å…ƒç´ éº»çƒ¦ï¼ŒåŠ ä¸Šå†²çªä¼šæœ‰è¿é”å½±å“ï¼Œæ‰€ä»¥å¾ˆå¤šåº“å®ç°çš„&lt;code&gt;hashtable&lt;/code&gt;éƒ½æ˜¯ç”¨çš„é“¾è¡¨æ³•ã€‚ä¸è¿‡å³ä½¿æœ‰è¿™ä¹ˆå¤šç¼ºç‚¹ï¼Œå…‰ç¼“å­˜å‹å¥½å’Œå†…å­˜åˆ©ç”¨ç‡é«˜åœ¨ç°ä»£è®¡ç®—æœºä¸Šå°±æ˜¯éå¸¸å¤§çš„æ€§èƒ½ä¼˜åŠ¿äº†ï¼Œæ‰€ä»¥åƒ&lt;code&gt;golang&lt;/code&gt;å’Œ&lt;code&gt;python&lt;/code&gt;éƒ½ä¼šä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•çš„è¿‘ä¼¼å˜ç§æ¥å®ç°å“ˆå¸Œè¡¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;go-hashmap-å¦‚ä½•å­˜å‚¨æ•°æ®&#34;&gt;Go Hashmap å¦‚ä½•å­˜å‚¨æ•°æ®
&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬é¦–å…ˆæ¥å›å¿†ä¸€ä¸‹&lt;code&gt; Go Map&lt;/code&gt; æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ã€‚&lt;br&gt;
figure 4: go map ç¤ºæ„å›¾&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/09/02e000848c6f7972b40e08647618d409.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Pasted image 20240927142057&#34;
	
	
&gt;&lt;br&gt;
å¿«é€Ÿæ€»ç»“ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Go &lt;code&gt;map&lt;/code&gt; åº•å±‚é€šè¿‡å“ˆå¸Œå‡½æ•°å°† key æ˜ å°„åˆ°å¤šä¸ª &lt;code&gt;bucket&lt;/code&gt;ä¸­ã€‚æ¯ä¸ª &lt;code&gt;bucket&lt;/code&gt; å…·æœ‰å›ºå®šæ•°é‡çš„é”®å€¼å¯¹&lt;code&gt;slot&lt;/code&gt;ï¼Œç”¨äºå­˜å‚¨ key å’Œå¯¹åº”çš„ valueã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ª &lt;code&gt;bucket&lt;/code&gt; èƒ½å­˜å‚¨ 8ä¸ªé”®å€¼å¯¹ã€‚å½“å†²çªå‘ç”Ÿæ—¶ï¼ˆå³å¤šä¸ª key è¢«æ˜ å°„åˆ°åŒä¸€ä¸ª &lt;code&gt;bucket&lt;/code&gt;ï¼‰ï¼Œè¿™äº› key å’Œ value ä¼šåœ¨åŒä¸€ä¸ª &lt;code&gt;bucket&lt;/code&gt; å†…å­˜å‚¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;map&lt;/code&gt; é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼Œå¹¶æ ¹æ®å“ˆå¸Œå€¼æ‰¾åˆ°å¯¹åº”çš„ &lt;code&gt;bucket&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæŸä¸ª &lt;code&gt;bucket&lt;/code&gt; è¢«å¡«æ»¡ï¼ˆ8 ä¸ª&lt;code&gt;slot&lt;/code&gt;å·²ç”¨å®Œï¼‰ï¼Œä¼šç”Ÿæˆä¸€ä¸ª &lt;code&gt;overflow bucket&lt;/code&gt;ï¼Œç»§ç»­å­˜å‚¨æ–°çš„é”®å€¼å¯¹ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥æ‰¾æ—¶æ•°æ®æ—¶ï¼Œé¦–å…ˆè®¡ç®—è¦æŸ¥æ‰¾çš„ key çš„å“ˆå¸Œå€¼ï¼Œç„¶åç¡®å®šè¯¥å“ˆå¸Œå€¼æ˜ å°„åˆ°çš„ &lt;code&gt;bucket&lt;/code&gt;ã€‚Go ä¼šæ£€æŸ¥æ¯ä¸ª&lt;code&gt;slot&lt;/code&gt;ï¼Œå¦‚æœ &lt;code&gt;bucket&lt;/code&gt; ä¸­å­˜åœ¨&lt;code&gt;overflow bucket&lt;/code&gt;ï¼Œä¼šé¡ºåºæ£€æŸ¥&lt;code&gt;overflow bucket&lt;/code&gt;ä¸­çš„ keyã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;swisstableä¸€ç§é«˜æ•ˆçš„-hashtable-å®ç°æ–¹å¼&#34;&gt;SwissTableï¼Œä¸€ç§é«˜æ•ˆçš„ &lt;code&gt;hashtable&lt;/code&gt; å®ç°æ–¹å¼
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;SwissTable&lt;/code&gt; æ˜¯ä¸€ç§åŸºäºæ”¹è¿›çš„çº¿æ€§æ¢æµ‹æ³•çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æ”¹è¿›å“ˆå¸Œè¡¨çš„ç»“æ„å’Œå…ƒæ•°æ®å­˜å‚¨ï¼Œä¼˜åŒ–äº†æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ã€‚SwissTable é‡‡ç”¨äº†ä¸€ç§æ–°çš„å…ƒæ•°æ®æ§åˆ¶æœºåˆ¶ï¼Œå¤§å¹…å‡å°‘äº†ä¸å¿…è¦çš„é”®æ¯”è¾ƒæ“ä½œï¼ŒåŒæ—¶åˆ©ç”¨ SIMD æŒ‡ä»¤æå‡ååé‡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å›é¡¾äº†ä¸€ä¸‹ä¸¤ç§å¸¸è§çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå®ƒä»¬è¦ä¹ˆæµªè´¹å†…å­˜ä¸”å¯¹ç¼“å­˜ä¸å‹å¥½ï¼›è¦ä¹ˆå‘ç”Ÿå†²çªåä¼šæ›´å®¹æ˜“å¯¼è‡´æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œæ€§èƒ½ä¸‹é™ã€‚è¿™è¿˜æ˜¯åœ¨æœ‰â€œå®Œç¾å“ˆå¸Œå‡½æ•°â€çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ç”¨äº†ä¸ªä¸é‚£ä¹ˆå¥½çš„å“ˆå¸Œå‡½æ•°ï¼Œé‚£ä¼šå¯¼è‡´keyå†²çªçš„æ¦‚ç‡å¤§å¤§ä¸Šå‡ï¼Œæ€§èƒ½é—®é¢˜ä¼šæ›´åŠ æ˜æ˜¾ï¼Œæœ€åçš„æƒ…å†µä¸‹æ€§èƒ½ç”šè‡³ä¼šä¸å¦‚åœ¨æ•°ç»„é‡Œè¿›è¡Œçº¿æ€§æœç´¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸šç•Œå¼€å§‹å¯»æ‰¾ä¸€ç§æ—¢å¯¹ç¼“å­˜å‹å¥½åˆä¸ä¼šè®©æŸ¥æ‰¾æ€§èƒ½é€€åŒ–çš„å¤ªå‰å®³çš„å“ˆå¸Œè¡¨ç®—æ³•ã€‚å¤§å¤šæ•°äººçš„ç ”ç©¶æ–¹å‘æ˜¯å¼€å‘æ›´å¥½çš„å“ˆå¸Œå‡½æ•°ï¼Œåœ¨è®©å“ˆå¸Œå‡½æ•°ä¸æ–­æ¥è¿‘â€œå®Œç¾å“ˆå¸Œå‡½æ•°â€çš„å“è´¨çš„åŒæ—¶ç”¨å„ç§æ‰‹æ®µä¼˜åŒ–è®¡ç®—æ€§èƒ½ï¼›å¦å¤–ä¸€äº›äººåœ¨æ”¹è¿›å“ˆå¸Œè¡¨æœ¬èº«çš„ç»“æ„åŠ›æ±‚åœ¨ç¼“å­˜å‹å¥½ã€æ€§èƒ½å’Œå†…å­˜ç”¨é‡ä¸Šæ‰¾åˆ°å¹³è¡¡ã€‚&lt;a class=&#34;link&#34; href=&#34;https://abseil.io/about/design/swisstables&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;swisstable&lt;/code&gt;&lt;/a&gt;å°±å±äºåè€…ã€‚&lt;br&gt;
&lt;code&gt;swisstable&lt;/code&gt;çš„æ—¶é—´å¤æ‚åº¦å’Œçº¿æ€§æ¢æµ‹æ³•çš„å·®ä¸å¤šï¼Œç©ºé—´å¤æ‚åº¦ä»‹äºé“¾è¡¨æ³•å’Œçº¿æ€§æ¢æµ‹ä¹‹é—´ã€‚  &lt;code&gt;swisstable&lt;/code&gt;çš„å®ç°æœ‰å¾ˆå¤šï¼Œæˆ‘ä¸»è¦åŸºäº&lt;a class=&#34;link&#34; href=&#34;https://github.com/dolthub/swiss/tree/main&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;dolthub/swiss&lt;/a&gt;è¿™ä¸ªå®ç°è¿›è¡Œç®€è¦çš„ä»‹ç»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;swisstable-çš„åŸºæœ¬ç»“æ„&#34;&gt;SwissTable çš„åŸºæœ¬ç»“æ„
&lt;/h3&gt;&lt;p&gt;è™½ç„¶åå­—å˜äº†ï¼Œå®é™…ä¸Š&lt;code&gt;swisstable&lt;/code&gt;ä¾ç„¶æ˜¯&lt;code&gt;hashtable&lt;/code&gt;ï¼Œè€Œä¸”ä½¿ç”¨æ”¹è¿›çš„çº¿æ€§æ¢æµ‹æ³•æ¥è§£å†³hashå†²çªã€‚  æ‰€ä»¥å¤§å®¶åº”è¯¥èƒ½æƒ³è±¡åˆ°ï¼Œswisstableçš„åº•å±‚åº”è¯¥ä¹Ÿæ˜¯ä¸ªç±»ä¼¼æ•°ç»„çš„ç»“æ„ã€‚æœ‰äº†è¿™æ ·å¤§è‡´çš„æ¨¡ç³Šå°è±¡å°±å¯ä»¥äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹&lt;a class=&#34;link&#34; href=&#34;https://github.com/dolthub/swiss/blob/f4b2babd2bc1cf0a2d66bab4e579ca35b6202338/map.go#L27&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;swisstable&lt;/a&gt;çš„ç»“æ„äº†:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;K&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;comparable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;V&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ctrl&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;group&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;hash&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;maphash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Hasher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;resident&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;//currently occupied slots in the hash map &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;dead&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;//A tombstone indicates a slot that was previously occupied but has been deleted &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;limit&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// This field represents the maximum number of elements that can be added to the hash map before it needs to be resized. It is calculated based on the load factor and the number of groups.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// metadata is the h2 metadata array for a group.  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// find operations first probe the controls bytes  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// to filter candidates before matching keys  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groupSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int8&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// group is a group of 16 key-value pairstype group[K comparable, V any] struct {  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groupSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;K&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groupSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;V&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;åœ¨&lt;code&gt;swisstable&lt;/code&gt; çš„å®ç°ä¸­ï¼Œctrl æ˜¯ä¸€ä¸ª &lt;code&gt;[]metadata&lt;/code&gt; ï¼Œ&lt;code&gt;[]metadata&lt;/code&gt; è·Ÿ&lt;code&gt; []group[K, V]&lt;/code&gt; æ•°é‡å¯¹åº” ã€‚æ¯ä¸ª&lt;code&gt;group&lt;/code&gt;æœ‰8ä¸ª&lt;code&gt;slot&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;hashä¼šè¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼š&lt;code&gt;57bits&lt;/code&gt;é•¿åº¦çš„ä¸ºH1ï¼Œç”¨äºç¡®å®šä»å“ªä¸ª&lt;code&gt;groups&lt;/code&gt;å¼€å§‹æ¢æµ‹ï¼Œå‰©ä¸‹çš„&lt;code&gt;7bits&lt;/code&gt;å«åšH2ï¼Œåˆšå¥½æ”¾åœ¨&lt;code&gt;metadata&lt;/code&gt;ä¸­ï¼Œ è¢«ç”¨ä½œæ˜¯å½“å‰keyçš„å“ˆå¸Œç‰¹å¾å€¼ï¼Œç”¨äºåé¢çš„æŸ¥æ‰¾å’Œè¿‡æ»¤ã€‚&lt;br&gt;
&lt;code&gt;swisstable&lt;/code&gt;æ¯”ä¼ ç»Ÿå“ˆå¸Œè¡¨æ›´å¿«çš„ç§˜è¯€å°±åœ¨äºè¿™äº›è¢«å«åš&lt;code&gt;ctrl&lt;/code&gt;çš„&lt;code&gt;metadata&lt;/code&gt;ã€‚æ§åˆ¶ä¿¡æ¯ä¸»è¦æ˜¯ä¸‹é¢è¿™å‡ ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;slotæ˜¯å¦ä¸ºç©º: &lt;code&gt;0b10000000&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;sloté‡Œçš„å…ƒç´ æ˜¯å¦å·²ç»è¢«åˆ é™¤: &lt;code&gt;0b11111110&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;sloté‡Œå­˜çš„é”®å€¼å¯¹çš„keyçš„å“ˆå¸Œç‰¹å¾ï¼ˆH2ï¼‰&lt;code&gt;0bh2&lt;/code&gt;&lt;br&gt;
å¯¹äºç©ºã€åˆ é™¤è¿™å‡ ç§ç‰¹æ®ŠçŠ¶æ€ï¼Œå¯¹åº”çš„å€¼éƒ½æ˜¯ç‰¹æ„è®¾ç½®çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨åé¢çš„åŒ¹é…ä¸­ä½¿ç”¨&lt;code&gt;SIMD&lt;/code&gt;æŒ‡ä»¤ï¼Œè·å¾—æœ€é«˜çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤éƒ½æ˜¯åŸºäºè¿™äº›&lt;code&gt;ctrl&lt;/code&gt;çš„ï¼Œå®ƒä»¬éå¸¸å°ï¼Œå¯ä»¥å°½é‡å¤šçš„è¢«æ”¾å…¥CPUçš„é«˜é€Ÿç¼“å­˜ï¼ŒåŒæ—¶åˆåŒ…å«äº†è¶³å¤Ÿçš„ä¿¡æ¯ä»¥æ»¡è¶³å“ˆå¸Œè¡¨çš„å¢åˆ æ”¹æŸ¥ã€‚è€Œslotå°±åªç”¨æ¥å­˜æ•°æ®ï¼Œ&lt;code&gt;ctrl&lt;/code&gt;å’Œ&lt;code&gt;slot&lt;/code&gt;ä¸€ä¸€å¯¹åº”ï¼Œæ§åˆ¶ä¿¡æ¯åœ¨&lt;code&gt;ctrl&lt;/code&gt;é‡Œçš„ç´¢å¼•å°±æ˜¯å¯¹åº”çš„æ•°æ®åœ¨sloté‡Œçš„ç´¢å¼•ï¼Œä¸‹é¢ä»¥æ·»åŠ æ•°æ®ä¸ºä¾‹ï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤ éƒ½å·®ä¸å¤šã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ·»åŠ æ•°æ®&#34;&gt;æ·»åŠ æ•°æ®
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;swisstable&lt;/code&gt; æ·»åŠ æ•°æ®çš„è¿‡ç¨‹åˆ†æˆå‡ ä¸ªæ­¥éª¤ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è®¡ç®—å“ˆå¸Œå€¼å¹¶åˆ†å‰²ä¸º &lt;code&gt;h1&lt;/code&gt; å’Œ &lt;code&gt;h2&lt;/code&gt; , æ ¹æ® &lt;code&gt;h1&lt;/code&gt; ç¡®å®šå¼€å§‹æ¢æµ‹çš„&lt;code&gt;groups&lt;/code&gt; ,&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;metaMatchH2&lt;/code&gt; æ£€æŸ¥å½“å‰ç»„ä¸­çš„ &lt;code&gt;metadata&lt;/code&gt; æ˜¯å¦æœ‰åŒ¹é…çš„&lt;code&gt; h2&lt;/code&gt;ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ &lt;code&gt;h2&lt;/code&gt;ï¼Œåˆ™è¿›ä¸€æ­¥æ£€æŸ¥å¯¹åº”æ§½ä½ä¸­çš„é”®æ˜¯å¦ä¸ç›®æ ‡é”®ç›¸åŒã€‚å¦‚æœç›¸åŒï¼Œåˆ™æ›´æ–°å€¼å¹¶è¿”å›ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é”®ï¼Œä½¿ç”¨ &lt;code&gt;metaMatchEmpty&lt;/code&gt; æ£€æŸ¥å½“å‰ç»„ä¸­æ˜¯å¦æœ‰ç©ºé—²&lt;code&gt;slot&lt;/code&gt;ã€‚å¦‚æœæœ‰&lt;code&gt;slot&lt;/code&gt;ï¼Œåˆ™æ’å…¥æ–°çš„é”®å€¼å¯¹ï¼Œå¹¶æ›´æ–° &lt;code&gt;metadata&lt;/code&gt; å’Œ &lt;code&gt;resident&lt;/code&gt; è®¡æ•°ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå½“å‰ç»„æ²¡æœ‰ç©ºé—²æ§½ä½ï¼Œè¿›è¡Œçº¿æ€§æ¢æµ‹ï¼Œæ£€æŸ¥ä¸‹ä¸€ä¸ª&lt;code&gt;groups&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Put&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resident&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;limit&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;rehash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nextSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;hi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;splitHash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;probeStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;hi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// inlined find loop  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;matches&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;metaMatchH2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctrl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;lo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;matches&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;nextMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// update  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;             &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;c1&#34;&gt;// |key| is not in group |g|,  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;c1&#34;&gt;// stop probing if we see an empty slot       matches = metaMatchEmpty(&amp;amp;m.ctrl[g])  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;matches&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// insert  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;nextMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;matches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ctrl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;lo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;resident&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// linear probing  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;metaMatchH2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bitset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// https://graphics.stanford.edu/~seander/bithacks.html##ValueInWord  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hasZeroByte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;castUint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;^&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;loBits&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;nextMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bitset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrailingZeros64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;^(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// clear bit |s|  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// div by 8  &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è™½ç„¶ï¼Œæ­¥éª¤å¾ˆå°‘ï¼Œä½†æ˜¯é‡Œé¢ä½¿ç”¨äº†æ¯”è¾ƒå¤æ‚çš„ä½è¿ç®—ï¼ŒæŒ‰ç…§æ­£å¸¸çš„æµç¨‹ï¼Œéœ€è¦æŠŠ&lt;code&gt;h2&lt;/code&gt; è·Ÿæ‰€æœ‰çš„ å¯¹æ¯”ï¼Œç›´åˆ°æ‰¾åˆ°æˆ‘ä»¬è¦çš„ç›®æ ‡ã€‚&lt;code&gt;swisstable&lt;/code&gt; ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆå·§å¦™çš„æ–¹å¼æ¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆå°†&lt;code&gt;h2 * 0x0101010101010101&lt;/code&gt;  å¾—åˆ°ä¸€ä¸ªuint64ï¼Œè¿™æ ·å°±èƒ½ä¸€æ¬¡æ€§å¯¹æ¯” 8ä¸ª &lt;code&gt;ctrl&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç„¶åè·Ÿ&lt;code&gt;meta&lt;/code&gt; åš xor è¿è¡Œã€‚ å¦‚æœ &lt;code&gt;h2&lt;/code&gt; å­˜åœ¨äº &lt;code&gt;metadata&lt;/code&gt; ä¸­ã€‚é‚£ä¹ˆå¯¹åº”çš„bit å°±æ˜¯&lt;code&gt;0b00000000&lt;/code&gt; ï¼Œ &lt;code&gt;metaMatchH2&lt;/code&gt; çš„ä½œç”¨ï¼Œå¯ä»¥ç”¨ ä¸‹é¢çš„å•å…ƒæµ‹è¯•ç†è§£ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nextMatch&lt;/code&gt;  ç”¨äºç¡®å®š key åœ¨groupä¸­çš„çš„å…·ä½“ä½ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;TestMetaMatchH2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;metaData&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metadata&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;metaData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x7f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x7f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x7f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// Imitate ctrl&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;metaData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x7f&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;metaUint64&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;castUint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;h2Pattern&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;loBits&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;xorResult&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;metaUint64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;^&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;h2Pattern&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;metaUint64: %b\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;xorResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hasZeroByte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;xorResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;r: %b\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nextMatch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;output&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// metaUint64: 00000000 11111110 11111110 11111110 0000000 01111111 01111111 00000000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// r: 10000000 00000000 00000000 00000000 10000000 00000000 00000000 10000000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;swisstable-çš„ä¼˜åŠ¿&#34;&gt;SwissTable çš„ä¼˜åŠ¿
&lt;/h3&gt;&lt;p&gt;çœ‹å®ŒSwissTableçš„å®ç°ï¼Œå¯ä»¥æ€»ç»“ä¸ºä¸‹é¢å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹&lt;code&gt;hashtable&lt;/code&gt;çš„æ“ä½œä»&lt;code&gt;slot&lt;/code&gt;è½¬ç§»åˆ°äº†&lt;code&gt;ctrl&lt;/code&gt;ä¸Šï¼Œ&lt;code&gt;ctrl&lt;/code&gt;æ›´å°æ›´å®¹æ˜“è¢«å¡«å…¥CPUçš„é«˜é€Ÿç¼“å­˜ï¼Œå› æ­¤æ¯”ç›´æ¥åœ¨&lt;code&gt;slot&lt;/code&gt;ä¸Šæ“ä½œæ›´å¿«ï¼Œå³ä½¿éœ€è¦å¤šä»˜å‡ºä¸€æ¬¡ä»&lt;code&gt;ctrl&lt;/code&gt;å¾—åˆ°ç´¢å¼•åå†å»æŸ¥æ‰¾&lt;code&gt;slot&lt;/code&gt;çš„ä»£ä»·ã€‚&lt;/li&gt;
&lt;li&gt;è®°å½•å“ˆå¸Œç‰¹å¾å€¼ï¼Œå‡å°‘äº†æ— æ„ä¹‰çš„keyç­‰å€¼æ¯”è¾ƒï¼Œè¿™æ˜¯çº¿æ€§æ¢æµ‹æ³•æ€§èƒ½ä¸‹é™çš„ä¸»è¦å…ƒå‡¶ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹&lt;code&gt;slot&lt;/code&gt;çš„æŸ¥æ‰¾å’Œæ“ä½œæ˜¯é€šè¿‡&lt;code&gt;ctrl&lt;/code&gt;æ‰¹é‡è¿›è¡Œçš„ï¼Œå•ä½æ—¶é—´å†…ååé‡æœ‰æ˜¾è‘—æå‡ã€‚&lt;/li&gt;
&lt;li&gt;æ ‡å¿—ä½çš„å€¼å’Œæ•´ä¸ªæ•°æ®ç»“æ„çš„å†…å­˜å¸ƒå±€éƒ½ä¸º&lt;code&gt;SIMD&lt;/code&gt;è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥æ€§èƒ½ä¼˜åŠ¿ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹&lt;code&gt;slot&lt;/code&gt;ä¹Ÿæœ‰ä¼˜åŒ–ï¼Œæ¯”å¦‚å¯¹å¤ªå¤§çš„æ•°æ®ä¼šå‹ç¼©å­˜å‚¨ä»¥æé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚&lt;br&gt;
&lt;code&gt;swisstable&lt;/code&gt; è§£å†³äº†ç©ºé—´å±€éƒ¨æ€§é—®é¢˜çš„åŸºç¡€ä¸Šï¼Œè¿˜åˆ©ç”¨äº†ç°ä»£CPUçš„ç‰¹æ€§æ‰¹é‡æ“ä½œå…ƒç´ ï¼Œæ‰€ä»¥æ€§èƒ½ä¼šæœ‰é£è·ƒèˆ¬çš„æå‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€ååœ¨æˆ‘æœ¬åœ°&lt;code&gt;macbook m1&lt;/code&gt; ï¼ˆä¸æ”¯æŒSIMDï¼‰ä¸Šè·‘benchmarkï¼Œç»“æœå¦‚ä¸‹ï¼Œåœ¨å¤§mapåœºæ™¯ä¸‹ï¼Œ&lt;code&gt;swisstable&lt;/code&gt; æ€§èƒ½æœ‰æ¯”è¾ƒæ˜æ˜¾çš„æå‡ã€‚&lt;br&gt;
Figure 5:  &lt;code&gt;swisstable&lt;/code&gt; å®˜æ–¹benchmark&lt;br&gt;
&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/09/a59e237341d6076ed79395bd1d1b5f90.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Pasted image 20240930110905&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“
&lt;/h2&gt;&lt;p&gt;ç›®å‰go å®˜æ–¹è¿˜æ²¡æœ‰&lt;code&gt;swisstable&lt;/code&gt; çš„å®ç°ï¼Œ ä½†æ˜¯å…³äºå®ƒçš„è®¨è®ºä¸€ç›´å†ç»§ç»­ï¼Œç›®å‰ç¤¾åŒºä¹Ÿæœ‰å‡ ç§å®ç°ã€‚æ¯”å¦‚&lt;a class=&#34;link&#34; href=&#34;https://github.com/mhmtszr/concurrent-swiss-map&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;concurrent-swiss-map&lt;/a&gt; ï¼Œ&lt;a class=&#34;link&#34; href=&#34;https://github.com/dolthub/swiss&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;swiss&lt;/a&gt; ç­‰ã€‚&lt;br&gt;
ä¸è¿‡å®ç°éƒ½ä¸æ˜¯ç‰¹åˆ«å®Œç¾ï¼Œæ¯”å¦‚åœ¨å°map åœºæ™¯ä¸‹&lt;code&gt;swisstable&lt;/code&gt; çš„æ€§èƒ½ç”šè‡³æ¯”ä¸ä¸Š &lt;code&gt;runtime_map&lt;/code&gt; ç­‰ã€‚ä½†æ˜¯&lt;code&gt;swisstable&lt;/code&gt; è¡¨ç°å‡ºæ¥çš„æ½œåŠ›å·²ç»åœ¨å…¶ä»–è¯­è¨€ä¸Šçš„è¡¨ç°ï¼Œè¯´æ˜å®ƒå€¼å¾—æˆ‘ä»¬æœŸå¾…ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;dolthub &lt;a class=&#34;link&#34; href=&#34;https://www.dolthub.com/blog/2023-03-28-swiss-map/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.dolthub.com/blog/2023-03-28-swiss-map/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;swisstable åŸç† &lt;a class=&#34;link&#34; href=&#34;https://abseil.io/about/design/swisstables&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://abseil.io/about/design/swisstables&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é¦–æ¬¡æå‡º&lt;code&gt;swisstable&lt;/code&gt;çš„cppconæ¼”è®²ï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.youtube.com/watch?v=ncHmEUmJZf4&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.youtube.com/watch?v=ncHmEUmJZf4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹&lt;code&gt;swisstable&lt;/code&gt;ç®—æ³•çš„ä¸€äº›æ”¹è¿›ï¼š&lt;a class=&#34;link&#34; href=&#34;https://www.youtube.com/watch?v=JZE3_0qvrMg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.youtube.com/watch?v=JZE3_0qvrMg&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½è¿ç®—åŸç†:  &lt;a class=&#34;link&#34; href=&#34;http://graphics.stanford.edu/~seander/bithacks.html##ValueInWord&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://graphics.stanford.edu/~seander/bithacks.html##ValueInWord&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;hash å‡½æ•°å¯¹æ¯”ï¼š &lt;a class=&#34;link&#34; href=&#34;https://aras-p.info/blog/2016/08/09/More-Hash-Function-Tests/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://aras-p.info/blog/2016/08/09/More-Hash-Function-Tests/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦å¤–ä¸€ç¯‡ä½è¿ç®—åŸç†çš„æ–‡ç«  &lt;a class=&#34;link&#34; href=&#34;https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>å¸¸è§é™é€Ÿç®—æ³•çš„åˆ†æä¸å®ç°</title>
        <link>https://huizhou92.com/zh-cn/p/%E5%B8%B8%E8%A7%81%E9%99%90%E9%80%9F%E7%AE%97%E6%B3%95%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/</link>
        <pubDate>Wed, 25 Sep 2024 09:34:59 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/%E5%B8%B8%E8%A7%81%E9%99%90%E9%80%9F%E7%AE%97%E6%B3%95%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/</guid>
        <description>&lt;img src="https://images.hxzhouh.com/blog-images/2024/09/f146e1aedafc425732135df81c5cd244.png" alt="Featured image of post å¸¸è§é™é€Ÿç®—æ³•çš„åˆ†æä¸å®ç°" /&gt;&lt;p&gt;åœ¨è½¯ä»¶æ¶æ„ä¸­ï¼Œé™æµæ˜¯ä¸€ç§æ§åˆ¶èµ„æºä½¿ç”¨å’Œä¿æŠ¤ç³»ç»Ÿå®‰å…¨çš„é‡è¦æœºåˆ¶ã€‚å®ƒé€šè¿‡é™åˆ¶åœ¨ä¸€å®šæ—¶é—´å†…å¯ä»¥å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œæ¥é˜²æ­¢ç³»ç»Ÿè¿‡è½½ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ä»èƒ½ä¿æŒç¨³å®šè¿è¡Œã€‚&lt;br&gt;
æœ¬æ–‡çš„ç›®æ ‡æ˜¯åˆ†æå’Œå®ç°å‡ ç§å¸¸è§çš„é™æµç®—æ³•ï¼Œä»¥åŠåˆ†æä»–ä»¬ä¼˜ç¼ºç‚¹ã€‚æœ€åæˆ‘ä»¬æ¢è®¨ä¸€ä¸‹çœŸå®ä¸šåŠ¡ä»£ç ä¸­çš„ä¸€äº›é™æµè®¾è®¡ã€‚&lt;/p&gt;
&lt;!-- more--&gt;
&lt;blockquote&gt;
&lt;p&gt;This article was first published in the Medium MPP plan. If you are a Medium user, please follow me on &lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;. Thank you very much.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬é€šè¿‡æ€§èƒ½æµ‹è¯•å¾—å‡ºæˆ‘ä»¬çš„ç³»ç»Ÿæœ€å¤§çš„è´Ÿè½½ä¸º10TPSã€‚&lt;/p&gt;
&lt;h2 id=&#34;æµé‡è®¡æ•°å™¨æ¨¡å¼&#34;&gt;æµé‡è®¡æ•°å™¨æ¨¡å¼
&lt;/h2&gt;&lt;p&gt;æœ€ç®€å•çš„åšæ³•ï¼Œæˆ‘ä»¬åšä¸€ä¸ªè®¡æ—¶å™¨ï¼Œæ¯ç§’æœ€å¤šå…è®¸10ä¸ªè¯·æ±‚é€šè¿‡ï¼Œè¶…è¿‡è¿™ä¸ªæ•°é‡çš„æµé‡å°±æ‹’ç»ã€‚&lt;br&gt;
Code1 ï¼š windows limit  &lt;a class=&#34;link&#34; href=&#34;https://go.dev/play/p/o9GpZGJ8N7i&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;run it&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://gist.github.com/hxzhouh/51020e18622c2e38ebf21cd6a9dc5cc6&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gist.github.com/hxzhouh/51020e18622c2e38ebf21cd6a9dc5cc6&lt;/a&gt;&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/51020e18622c2e38ebf21cd6a9dc5cc6.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™ä¸ªåšæ³•æ˜¯æœ‰é—®é¢˜çš„ï¼Œå‡è®¾æˆ‘ä»¬2ç§’å†…æ”¶åˆ°äº†éƒ½æ”¶åˆ°äº†10TPSè¯·æ±‚ï¼Œä½†æ˜¯æ˜¯åœ¨ 0.9s ä¸ 1.1s æ”¶åˆ°çš„ï¼Œè¿™æ ·è™½ç„¶æ¯ä¸ªå‘¨æœŸçš„æµé‡éƒ½ä¸è¶…è¿‡10 TPSè¯·æ±‚çš„é˜ˆå€¼ï¼Œä½†æ˜¯ç³»ç»Ÿç¡®å®æ›¾ç»åœ¨1så†…å‘ç”Ÿäº†è¶…è¿‡é˜ˆå€¼çš„20TPSè¯·æ±‚ã€‚&lt;br&gt;
æµé‡è®¡æ•°å™¨çš„ç¼ºé™·æ ¹æºåœ¨äºå®ƒåªæ˜¯é’ˆå¯¹æ—¶é—´ç‚¹è¿›è¡Œç¦»æ•£çš„ç»Ÿè®¡ï¼Œä¸ºäº†å¼¥è¡¥è¯¥ç¼ºé™·ï¼Œä¸€ç§åä¸ºâ€œæ»‘åŠ¨æ—¶é—´çª—â€çš„é™æµæ¨¡å¼è¢«è®¾è®¡å‡ºæ¥ï¼Œå®ƒå¯ä»¥å®ç°å¹³æ»‘çš„åŸºäºæ—¶é—´ç‰‡æ®µç»Ÿè®¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ»‘åŠ¨çª—å£æœºåˆ¶&#34;&gt;æ»‘åŠ¨çª—å£æœºåˆ¶
&lt;/h2&gt;&lt;p&gt;æ»‘åŠ¨çª—å£ç®—æ³•(Sliding Window Algorithm)åœ¨è®¡ç®—æœºç§‘å­¦çš„å¾ˆå¤šé¢†åŸŸä¸­éƒ½æœ‰æˆåŠŸçš„åº”ç”¨ï¼Œè­¬å¦‚TCPåè®®çš„é˜»å¡æ§åˆ¶(Congestion Control)ä½¿ç”¨åˆ°æ»‘åŠ¨çª—å£ç®—æ³•&lt;/p&gt;
&lt;p&gt;æ»‘åŠ¨çª—å£ç®—æ³•é€šè¿‡å°†æ—¶é—´åˆ†ä¸ºå¤šä¸ªå°çš„æ—¶é—´æ®µï¼Œæ¯ä¸ªæ—¶é—´æ®µå†…ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨ã€‚å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå®ƒä¼šè¢«åˆ†é…åˆ°å½“å‰æ—¶é—´æ‰€åœ¨çš„å°æ—¶é—´æ®µï¼Œå¹¶æ£€æŸ¥è¯¥æ—¶é—´æ®µçš„è®¡æ•°å™¨æ˜¯å¦å·²è¾¾åˆ°é™åˆ¶ã€‚å¦‚æœæœªè¾¾åˆ°ï¼Œåˆ™å…è®¸è¯·æ±‚å¹¶å¢åŠ è®¡æ•°ï¼›å¦‚æœå·²è¾¾åˆ°ï¼Œåˆ™æ‹’ç»è¯·æ±‚ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ—§çš„æ—¶é—´æ®µä¼šæ·¡å‡ºçª—å£ï¼Œæ–°çš„æ—¶é—´æ®µä¼šåŠ å…¥ã€‚&lt;br&gt;
code2: sliding_windows &lt;a class=&#34;link&#34; href=&#34;https://go.dev/play/p/kc-MacnzPTh&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;try it&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://gist.github.com/hxzhouh/c5c79ea4b80ea5a026052471de07107f&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gist.github.com/hxzhouh/c5c79ea4b80ea5a026052471de07107f&lt;/a&gt;&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/c5c79ea4b80ea5a026052471de07107f.js&#34;&gt;&lt;/script&gt;
&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/c5c79ea4b80ea5a026052471de07107f.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;p&gt;æ»‘åŠ¨çª—å£ç®—æ³•å…¶å®å°±æ˜¯æŠŠæµé‡è®¡æ•°å™¨ç®—æ³•çš„æ—¶é—´çª—å£åˆ’åˆ†å°ä¸€ç‚¹ï¼Œæä¾›æ›´ç»†è‡´çš„æµé‡æ§åˆ¶ï¼Œå¹¶ä¸èƒ½å®Œå…¨è§£å†³ç¬æ—¶å¤§æµé‡ã€‚ä¹Ÿå¾ˆéš¾åœ¨æ›´ç»†ç²’åº¦ä¸Šå¯¹æµé‡æ›²çº¿è¿›è¡Œæ•´å½¢ï¼Œèµ·ä¸åˆ°å‰Šå³°å¡«è°·çš„ä½œç”¨ã€‚ä¸‹é¢ç»§ç»­ä»‹ç»ä¸¤ç§é€‚ç”¨äºé˜»å¡å¼é™æµçš„é™æµæ¨¡å¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ¼æ¡¶ç®—æ³•&#34;&gt;æ¼æ¡¶ç®—æ³•
&lt;/h2&gt;&lt;p&gt;æ¼æ¡¶ç®—æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå›ºå®šå®¹é‡çš„é˜Ÿåˆ—æ¥æ¨¡æ‹Ÿæ¡¶ï¼Œä»¥æ’å®šé€Ÿç‡ä»æ¡¶ä¸­å–å‡ºè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæ— è®ºè¯·æ±‚åˆ°è¾¾çš„é¢‘ç‡å¦‚ä½•ï¼Œéƒ½ä¿è¯è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦è¢«å¤„ç†ï¼Œä»è€Œå¹³æ»‘æµé‡å¹¶é˜²æ­¢æµé‡çªå¢ã€‚&lt;br&gt;
Code3:  leakBucket &lt;a class=&#34;link&#34; href=&#34;https://go.dev/play/p/dbIFj2vCqFU&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;try it&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://gist.github.com/hxzhouh/ba78993644ce58958127f64fc0976c55&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gist.github.com/hxzhouh/ba78993644ce58958127f64fc0976c55&lt;/a&gt;&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/ba78993644ce58958127f64fc0976c55.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;p&gt;æ¼æ¡¶ç®—æ³•é€‚ç”¨äºéœ€è¦å¼ºåˆ¶æ‰§è¡Œå›ºå®šé€Ÿç‡å¤„ç†çš„åœºæ™¯ï¼Œå¦‚ç½‘ç»œæµé‡æ§åˆ¶ã€APIè¯·æ±‚é™åˆ¶ç­‰ã€‚é€šè¿‡æ§åˆ¶ä»¤ç‰Œçš„æ·»åŠ é€Ÿç‡ï¼Œæ¼æ¡¶ç®—æ³•èƒ½å¤Ÿæœ‰æ•ˆåœ°é¿å…ç³»ç»Ÿå› ç¬æ—¶æµé‡é«˜å³°è€Œè¿‡è½½ã€‚æ¼æ¡¶å®ç°èµ·æ¥å¾ˆå®¹æ˜“ï¼Œéš¾ç‚¹åœ¨äºå¦‚ä½•ç¡®å®šæ¼æ¡¶çš„ä¸¤ä¸ªå‚æ•°ï¼šæ¡¶çš„å¤§å°å’Œæ°´çš„æµå‡ºé€Ÿç‡ã€‚å¦‚æœæ¡¶è®¾ç½®å¾—å¤ªå¤§ï¼Œé‚£æœåŠ¡ä¾ç„¶å¯èƒ½é­é‡æµé‡è¿‡å¤§çš„å†²å‡»ï¼Œä¸èƒ½å®Œå…¨å‘æŒ¥é™æµçš„ä½œç”¨ï¼›å¦‚æœè®¾ç½®å¾—å¤ªå°ï¼Œé‚£å¾ˆå¯èƒ½è¯¯æ€æ‰ä¸€éƒ¨åˆ†æ­£å¸¸çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»¤ç‰Œæ¡¶ç®—æ³•&#34;&gt;ä»¤ç‰Œæ¡¶ç®—æ³•
&lt;/h2&gt;&lt;p&gt;ä»¤ç‰Œæ¡¶ç®—æ³•è·Ÿæ¼æ¡¶ç®—æ³•æƒ³æ³•ï¼Œæ›´åƒç°å®ç”Ÿæ´»ä¸­çš„æ’é˜Ÿç®—æ³•ï¼Œç³»ç»Ÿä»¥å›ºå®šçš„é€Ÿç‡æ”¾å·ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å–å·ï¼Œç„¶åå†è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚ å‡è®¾æˆ‘ä»¬è¦é™åˆ¶ç³»ç»Ÿåœ¨Xç§’å†…æœ€å¤§è¯·æ±‚æ¬¡æ•°ä¸è¶…è¿‡Yï¼Œé‚£å°±æ¯é—´éš”X/Yæ—¶é—´å¾€æ¡¶ä¸­æ”¾ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æœ‰è¯·æ±‚è¿›æ¥æ—¶ï¼Œé¦–å…ˆè¦ä»æ¡¶ä¸­å–å¾—ä¸€ä¸ªå‡†å…¥çš„ä»¤ç‰Œï¼Œç„¶åæ‰èƒ½è¿›å…¥ç³»ç»Ÿè¿›è¡Œå¤„ç†ã€‚å¦‚æœè·å–ä¸åˆ°ä»¤ç‰Œå°±è¿”å›è¯·æ±‚å¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;Code 4 ï¼štoken_limit   &lt;a class=&#34;link&#34; href=&#34;https://go.dev/play/p/-JAqGoz2xK-&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;try it &lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://gist.github.com/hxzhouh/0c172824334aeea5ef101bd682fef59e&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gist.github.com/hxzhouh/0c172824334aeea5ef101bd682fef59e&lt;/a&gt;&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/0c172824334aeea5ef101bd682fef59e.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;p&gt;ä»¤ç‰Œæ¡¶ç®—æ³•é€‚ç”¨äº&lt;strong&gt;éœ€è¦å¤„ç†çªå‘æµé‡çš„åœºæ™¯&lt;/strong&gt;ï¼Œå¦‚ç½‘ç»œé€šä¿¡ã€APIè°ƒç”¨ç­‰ã€‚é€šè¿‡æ§åˆ¶ä»¤ç‰Œçš„å¡«å……é€Ÿç‡å’Œæ¡¶çš„å®¹é‡ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿæœ‰æ•ˆåœ°å¹³è¡¡æµé‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ï¼ŒåŒæ—¶ å¦‚æœç³»ç»Ÿèµ„æºå¯Œè£•çš„æƒ…å†µä¸‹ï¼Œå…è®¸åœ¨çŸ­æœŸå†…å¤„ç†æ›´å¤šçš„è¯·æ±‚ã€‚è·Ÿæ¼æ¡¶ç®—æ³•ç±»ä¼¼ï¼Œä»¤ç‰Œç”Ÿæˆçš„é€Ÿåº¦ï¼Œä¹Ÿæ˜¯éœ€è¦é‡ç‚¹è€ƒè™‘çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®é™…ä¸šåŠ¡ä¸­çš„é™æµç®—æ³•&#34;&gt;å®é™…ä¸šåŠ¡ä¸­çš„é™æµç®—æ³•
&lt;/h2&gt;&lt;h3 id=&#34;åˆ†å¸ƒå¼é™æµç®—æ³•&#34;&gt;åˆ†å¸ƒå¼é™æµç®—æ³•
&lt;/h3&gt;&lt;p&gt;ä¸Šé¢ä»‹ç»çš„å››ä¸ªé™æµç®—æ³•ï¼ŒçŠ¶æ€éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå•æœºé™æµç®—æ³•ï¼Œå¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œå®ƒä»¬å°±æœ€å¤šåªèƒ½åº”ç”¨äºé›†ç¾¤æœ€å…¥å£å¤„çš„ç½‘å…³ä¸Šï¼Œå¯¹æ•´ä¸ªæœåŠ¡é›†ç¾¤è¿›è¡Œæµé‡æ§åˆ¶ï¼Œæ— æ³•ç»†ç²’åº¦åœ°ç®¡ç†æµé‡åœ¨å†…éƒ¨å¾®æœåŠ¡èŠ‚ç‚¹ä¸­çš„æµè½¬æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ååŒé™æµï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†çŠ¶æ€ä¿å­˜åœ¨é›†ç¾¤ä¸­å…±äº«ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Redis å®ç°åˆ†å¸ƒå¼ ä»¤ç‰Œæ¡¶ç®—æ³•çš„å®ç°ã€‚å®é™…ä¸Šï¼Œæˆ‘åœ¨ä¸šåŠ¡ä¸­ä½¿ç”¨æ›´å¤šçš„æ˜¯è¿™ç§æ–¹å¼ã€‚&lt;/p&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/9aee69a3b24c38aa20274b726a596e2d.js&#34;&gt;&lt;/script&gt;

&lt;h3 id=&#34;ä¼˜å…ˆçº§&#34;&gt;ä¼˜å…ˆçº§
&lt;/h3&gt;&lt;p&gt;æœåŠ¡å™¨èµ„æºæ˜¯å®è´µçš„ï¼Œå†èµ„æºç´§å¼ çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ›´åŠ å¸Œæœ›å®è´µçš„èµ„æºç”¨äºæœåŠ¡æˆ‘ä»¬çš„vipå®¢æˆ·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ç§åŸºäºâ€œè´§å¸åŒ–é¢åº¦â€çš„åˆ†å¸ƒå¼é™æµæ–¹æ¡ˆã€‚ä¸åŒäºä¼ ç»Ÿä»¤ç‰Œæ¡¶ç®—æ³•ä¸­çš„â€œå‡†å…¥/æ‹’ç»â€äºŒå…ƒåˆ¤å®šæ–¹å¼ï¼Œè¿™é‡Œçš„â€œè´§å¸é¢åº¦â€æ˜¯ä¸€ç§æ›´çµæ´»çš„é™æµæ–¹å¼ã€‚ç”¨æˆ·åœ¨è®¿é—®é›†ç¾¤ä¸­çš„æœåŠ¡æ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šæ¶ˆè€—ä¸€å®šçš„é¢åº¦ï¼Œç±»ä¼¼äºæ¶ˆè€—èµ„æºçš„â€œè´§å¸â€ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®ç”¨æˆ·çš„ç­‰çº§åˆ†é…ä¸åŒçš„é¢åº¦ã€‚VIPç”¨æˆ·å¯èƒ½æ‹¥æœ‰æ›´é«˜çš„é¢åº¦ï¼Œæ™®é€šç”¨æˆ·åˆ™æœ‰ä¸€å®šçš„é¢åº¦é™åˆ¶ã€‚å½“é¢åº¦è€—å°½åï¼Œç”¨æˆ·éœ€è¦é‡æ–°å‘â€œä»¤ç‰Œæ¡¶â€ç”³è¯·é¢åº¦ï¼Œæ‰èƒ½ç»§ç»­è®¿é—®ã€‚&lt;br&gt;
code 5:  quota &lt;a class=&#34;link&#34; href=&#34;https://go.dev/play/p/MxKsxKRx9L_J&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;try it&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://gist.github.com/hxzhouh/dc06a2947f4d436bdce9743d65b6c9e6&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://gist.github.com/hxzhouh/dc06a2947f4d436bdce9743d65b6c9e6&lt;/a&gt;&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/dc06a2947f4d436bdce9743d65b6c9e6.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º
&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†å‡ ç§å¸¸è§çš„é™æµç®—æ³•ï¼ŒåŒ…æ‹¬æµé‡è®¡æ•°å™¨ã€æ»‘åŠ¨çª—å£ã€æ¼æ¡¶ã€ä»¤ç‰Œæ¡¶ç­‰ï¼Œå¹¶åˆ†æäº†å®ƒä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨æ•ˆæœã€‚æµé‡è®¡æ•°å™¨ç®—æ³•ç®€å•æ˜“ç”¨ï¼Œä½†æ— æ³•åº”å¯¹ç¬æ—¶é«˜å³°æµé‡ï¼Œæ»‘åŠ¨çª—å£ç®—æ³•åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº†è¿™ä¸€ç¼ºé™·ã€‚æ¼æ¡¶ç®—æ³•é€šè¿‡å›ºå®šé€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œé€‚åˆéœ€è¦å¹³æ»‘æµé‡çš„åœºæ™¯ï¼Œè€Œä»¤ç‰Œæ¡¶ç®—æ³•åˆ™èƒ½å¤Ÿçµæ´»å¤„ç†çªå‘æµé‡ï¼Œå¹¶å…è®¸ç³»ç»Ÿåœ¨çŸ­æ—¶é—´å†…æ¥æ”¶æ›´å¤šè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œå°¤å…¶æ˜¯å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œåˆ†å¸ƒå¼é™æµæ˜¯éå¸¸é‡è¦çš„ã€‚é€šè¿‡ Redis ç­‰ä¸­é—´ä»¶çš„ååŒï¼Œåˆ†å¸ƒå¼ä»¤ç‰Œæ¡¶ç®—æ³•èƒ½æœ‰æ•ˆç®¡ç†å¤šä¸ªèŠ‚ç‚¹çš„æµé‡ã€‚æ­¤å¤–ï¼ŒåŸºäºä¼˜å…ˆçº§çš„â€œè´§å¸åŒ–é¢åº¦â€æ–¹æ¡ˆä¸ºé™æµè®¾è®¡æä¾›äº†æ›´å¤šçµæ´»æ€§ï¼Œæœ‰åŠ©äºæå‡ VIP å®¢æˆ·ä½“éªŒã€‚é™æµæœºåˆ¶ä¸ä»…èƒ½å¤Ÿä¿æŠ¤ç³»ç»Ÿå…å—è¿‡è½½ï¼Œè¿˜èƒ½æå‡ç³»ç»Ÿçš„æ•´ä½“ç¨³å®šæ€§ä¸æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£
&lt;/h2&gt;&lt;p&gt;[1] &lt;a class=&#34;link&#34; href=&#34;https://icyfenix.cn/distribution/traffic-management/traffic-control.html#%E9%99%90%E6%B5%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;é™æµè®¾è®¡æ¨¡å¼&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/zh-cn/p/%E5%B8%B8%E8%A7%81%E9%99%90%E9%80%9F%E7%AE%97%E6%B3%95%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;æœ¬æ–‡é•¿æœŸè¿æ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨è§‰å¾—æˆ‘çš„åšå®¢å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·é€šè¿‡ &lt;a class=&#34;link&#34; href=&#34;https://huizhou92.com/index.xml&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;RSS&lt;/a&gt;è®¢é˜…æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;æˆ–è€…åœ¨&lt;a class=&#34;link&#34; href=&#34;https://x.com/@piaopiaopig&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;X&lt;/a&gt;ä¸Šå…³æ³¨æˆ‘ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨æœ‰&lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;è´¦å·ï¼Œèƒ½ç»™æˆ‘ä¸ªå…³æ³¨å˜›ï¼Ÿæˆ‘çš„æ–‡ç« ç¬¬ä¸€æ—¶é—´éƒ½ä¼šå‘å¸ƒåœ¨Mediumã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>Go ææ¡ˆ: JSON v2 æ¥äº†</title>
        <link>https://huizhou92.com/zh-cn/p/go-%E6%8F%90%E6%A1%88-json-v2-%E6%9D%A5%E4%BA%86/</link>
        <pubDate>Sun, 15 Sep 2024 10:05:57 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/go-%E6%8F%90%E6%A1%88-json-v2-%E6%9D%A5%E4%BA%86/</guid>
        <description>&lt;img src="https://images.hxzhouh.com/blog-images/2024/09/5cfcc61c5e45994e3e35ceb82bfa6bc8.png" alt="Featured image of post Go ææ¡ˆ: JSON v2 æ¥äº†" /&gt;&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;JSON&lt;/code&gt;æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼ŒGo è¯­è¨€çš„ &lt;code&gt;encoding/json&lt;/code&gt; åŒ…è‡ªè¯ç”Ÿä»¥æ¥å·²æœ‰åå¹´ä¹‹ä¹…ï¼Œå®ƒå‡­å€Ÿå…¶çµæ´»çš„ç‰¹æ€§èµ¢å¾—äº†å¼€å‘è€…çš„é’çã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ç»“æ„ä½“æ ‡ç­¾è‡ªå®šä¹‰å­—æ®µçš„ JSON è¡¨ç°å½¢å¼ï¼Œä¹Ÿå¯ä»¥è®© Go ç±»å‹è‡ªå®šä¹‰å…¶åœ¨ JSON ä¸­çš„è¡¨ç°å½¢å¼ã€‚ç„¶è€Œï¼Œéšç€ Go è¯­è¨€å’Œ JSON æ ‡å‡†çš„å‘å±•ï¼Œä¸€äº›åŠŸèƒ½ä¸Šçš„ç¼ºå¤±å’Œæ€§èƒ½ä¸Šçš„é™åˆ¶é€æ¸æš´éœ²å‡ºæ¥ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠŸèƒ½ç¼ºå¤±&lt;/strong&gt;ï¼šæ¯”å¦‚ï¼Œä¸èƒ½æŒ‡å®šÂ &lt;code&gt;time.Time&lt;/code&gt;Â ç±»å‹çš„è‡ªå®šä¹‰æ ¼å¼åŒ–ï¼Œä¸èƒ½åœ¨åºåˆ—åŒ–æ—¶çœç•¥ç‰¹å®šçš„ Go å€¼ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;API ç¼ºé™·&lt;/strong&gt;ï¼šæ¯”å¦‚ï¼Œæ²¡æœ‰ç®€å•çš„æ–¹æ³•æ¥æ­£ç¡®åœ°ä»Â &lt;code&gt;io.Reader&lt;/code&gt;Â ä¸­ååºåˆ—åŒ– JSONã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½é™åˆ¶&lt;/strong&gt;ï¼šæ ‡å‡†&lt;code&gt;json&lt;/code&gt;åŒ…çš„æ€§èƒ½è¡¨ç°å¹¶ä¸å°½å¦‚äººæ„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¡Œä¸ºç¼ºé™·&lt;/strong&gt;ï¼šæ¯”å¦‚ï¼Œå¯¹ JSON è¯­æ³•çš„é”™è¯¯å¤„ç†ä¸å¤Ÿä¸¥æ ¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿçš„ååºåˆ—åŒ–ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å°±åƒ&lt;a class=&#34;link&#34; href=&#34;&#34; &gt;&lt;code&gt;math/v2&lt;/code&gt;&lt;/a&gt;ä¸€æ ·çš„ï¼ŒGo å®˜æ–¹æå‡º&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/discussions/63397&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;encoding/json/v2&lt;/code&gt;&lt;/a&gt; æ¥è§£å†³ä¸Šé¢çš„é‚£äº›é—®é¢˜ï¼Œæœ¬æ–‡ä¸»è¦ç›®æ ‡æ˜¯åˆ†æenable/jsonä¸­ å…³äºç©ºå€¼çš„ä¸€äº›é—®é¢˜ã€‚ä»¥åŠå®ƒåœ¨ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/discussions/63397&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;encoding/json/v2&lt;/code&gt;&lt;/a&gt;ä¸­æ˜¯å¦‚ä½•è¢«è§£å†³çš„ã€‚æœ¬æ–‡ä¸æ¶‰åŠ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/discussions/63397&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;encoding/json/v2&lt;/code&gt;&lt;/a&gt; ä¸­å…¶ä»–çš„ä¿®æ”¹&lt;/p&gt;
&lt;!-- more--&gt;
&lt;blockquote&gt;
&lt;p&gt;This article was first published in the Medium MPP plan. If you are a Medium user, please follow me on &lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;. Thank you very much.&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;omitempty&#34;&gt;Omitempty
&lt;/h2&gt;&lt;p&gt;åœ¨&lt;a class=&#34;link&#34; href=&#34;https://pkg.go.dev/encoding/json&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;encoding/json&lt;/code&gt;&lt;/a&gt;åŒ…ä¸­ï¼Œæœ‰è¿™æ ·å…³äº&lt;code&gt;omitempty&lt;/code&gt;çš„æè¿°:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The &amp;ldquo;omitempty&amp;rdquo; option specifies that the field should be omitted from the encoding if the field has an empty value, defined as false, 0, a nil pointer, a nil interface value, and any empty array, slice, map, or string.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œè¿™ç§é¢„å®šä¹‰çš„â€ç©ºâ€å€¼åˆ¤æ–­é€»è¾‘å¹¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰å®é™…åœºæ™¯çš„éœ€æ±‚ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;         &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;           &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;id,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;CreateTime&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;create_time,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;TagList&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Tag&lt;/span&gt;           &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;tag_list,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;          &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;name,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Score&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt;         &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;score,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Category&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;Category&lt;/span&gt;        &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;category,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;LikePost&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;like,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Tag&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;id&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;name&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Category&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;id&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;  &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;name&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Post&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¾“å‡ºç»“æœä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;create_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0001-01-01T00:00:00Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;category&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è™½ç„¶&lt;code&gt;Post&lt;/code&gt; å„ä¸ªå­—æ®µéƒ½æ·»åŠ äº†&lt;code&gt;omitempty&lt;/code&gt; ã€‚ä½†æ˜¯ç»“æœå¹¶ä¸åƒæˆ‘ä»¬é¢„æœŸä¸€æ ·ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;omitempty&lt;/code&gt; ä¸èƒ½å¤„ç†ç©º &lt;code&gt;struct&lt;/code&gt; ï¼Œæ¯”å¦‚  &lt;code&gt;Post.Category&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;omitempty&lt;/code&gt; å¤„ç†&lt;code&gt;time.Time&lt;/code&gt; çš„æ–¹å¼ä¸æ˜¯ æˆ‘ä»¬ç†è§£çš„&lt;code&gt;UTC =0&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;1970-01-01 00:00:00&lt;/code&gt; ,è€Œæ˜¯ &lt;code&gt;0001-01-01T00:00:00Z&lt;/code&gt; ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;omitzeroæ ‡ç­¾&#34;&gt;Omitzeroæ ‡ç­¾
&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/discussions/63397&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;encoding/json/v2&lt;/code&gt;&lt;/a&gt; ä¸­ï¼Œä¼šæ·»åŠ ä¸€ä¸ªæ–°çš„æ ‡ç­¾  &lt;code&gt;omitzero&lt;/code&gt;ï¼Œæ·»åŠ äº†ä¸¤ä¸ªåŠŸèƒ½ï¼Œæ¥è§£å†³ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ã€‚ï¼ˆç›®å‰è¿™ä¸ªåŠŸèƒ½è¿˜åœ¨å¼€å‘ä¸­ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡&lt;a class=&#34;link&#34; href=&#34;https://github.com/go-json-experiment/json&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;go-json-experiment/json&lt;/a&gt;æå‰ä½“éªŒæ–°åŠŸèƒ½ï¼‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ›´å¥½çš„&lt;code&gt;time.Time&lt;/code&gt; å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯æŒè‡ªå®šä¹‰&lt;code&gt;IsZero&lt;/code&gt;å‡½æ•°ã€‚&lt;br&gt;
æ¯”å¦‚ä¸‹é¢ä¸‹é¢çš„ä»£ç ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;encoding/json&amp;#34;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;v2_json&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;github.com/go-json-experiment/json&amp;#34;&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;math&amp;#34;&lt;/span&gt;    &lt;span class=&#34;s&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Id&lt;/span&gt;         &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;           &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;id,omitempty,omitzero&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;CreateTime&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Time&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;create_time,omitempty,omitzero&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;TagList&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Tag&lt;/span&gt;           &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;tag_list,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;          &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;name,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Score&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;ScoreType&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;score,omitempty,omitzero&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Category&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;Category&lt;/span&gt;        &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;category,omitempty,omitzero&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;LikePost&lt;/span&gt;   &lt;span class=&#34;kd&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Post&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;like,omitempty&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ScoreType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ScoreType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;IsZero&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MinInt64&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Tag&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;id&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;name&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Category&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;ID&lt;/span&gt;   &lt;span class=&#34;kt&#34;&gt;float64&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;id&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;Name&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;  &lt;span class=&#34;s&#34;&gt;`json:&amp;#34;name&amp;#34;`&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;v1String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Post&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v1String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;v2String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v2_json&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Marshal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Post&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;v2String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è·Ÿ&lt;code&gt;encoding/json&lt;/code&gt; ç›¸æ¯” &lt;code&gt;encoding/json/v2&lt;/code&gt; è§£å†³äº†ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;create_time&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;0001-01-01T00:00:00Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;category&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;#34;score&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º
&lt;/h2&gt;&lt;p&gt;é€šè¿‡å¼•å…¥&lt;code&gt;omitzero&lt;/code&gt;æ ‡ç­¾ï¼ŒGoè¯­è¨€åœ¨è§£å†³JSONç¼–ç ä¸­â€ç©ºâ€å€¼å¤„ç†çš„ç—›ç‚¹ä¸Šè¿ˆå‡ºäº†é‡è¦ä¸€æ­¥ã€‚è¿™ä¸ªæ–¹æ¡ˆä¸ä»…æ»¡è¶³äº†å¼€å‘è€…å¯¹æ›´çµæ´»çš„â€ç©ºâ€å€¼å®šä¹‰çš„éœ€æ±‚ï¼Œè¿˜ä¿æŒäº†ä¸ç°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§ã€‚ç›®å‰è¯¥&lt;code&gt;omitzero&lt;/code&gt;çš„è½åœ°æ—¶é—´å°šæœªç¡®å®šï¼Œæœ€æ—©ä¹Ÿè¦ç­‰åˆ°&lt;code&gt;Go 1.24&lt;/code&gt;ç‰ˆæœ¬ã€‚æ­¤å¤–ï¼Œencoding/xmlç­‰ä¹Ÿä¼šæ•ˆä»¿jsonåŒ…ï¼Œå¢åŠ &lt;code&gt;omitzero&lt;/code&gt;æ ‡ç­¾ã€‚&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/discussions/63397&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;&lt;code&gt;encoding/json/v2&lt;/code&gt;&lt;/a&gt; è¿˜åŒ…æ‹¬ æ€§èƒ½ç­‰å…¶ä»–æ–¹é¢çš„æ›´æ–°ï¼Œ æœ‰å…´è¶£çš„Gopher å¯ä»¥ æå‰äº†è§£è¿™äº›æ”¹åŠ¨ï¼Œæœ¬åšå®¢ä¹Ÿä¼šä¸€ç›´å…³æ³¨è¿™ä¸ªproposal&lt;br&gt;
Goè¯­è¨€å¼€å§‹èµ°å‘æˆç†Ÿã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>go é«˜æ€§èƒ½ç¼–ç¨‹EP11 lock-free å®è·µ.zh-cn</title>
        <link>https://huizhou92.com/zh-cn/p/go-%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%96%E7%A8%8Bep11-lock-free-%E5%AE%9E%E8%B7%B5.zh-cn/</link>
        <pubDate>Mon, 09 Sep 2024 09:46:47 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/go-%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%96%E7%A8%8Bep11-lock-free-%E5%AE%9E%E8%B7%B5.zh-cn/</guid>
        <description>&lt;p&gt;åœ¨[ä¸Šä¸€ç¯‡](013 ä¸¤ä¸ªæœ‰ç”¨çš„ Golang æ— é”ç¼–ç¨‹æŠ€å·§.zh-cn)æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸¤ä¸ªæ— é”ç¼–ç¨‹æ€æƒ³ã€‚æ€»ç»“å°±æ˜¯ï¼šé€šè¿‡ç²¾å¿ƒçš„è®¾è®¡æ¶ˆé™¤æ•°æ®å…±äº«æˆ–è€…æ¶ˆé™¤å¹¶å‘è®¿é—®åŒä¸€ä¸ªæ•°æ®ã€‚å°½ç®¡æˆ‘ä»¬ä¸€ç›´æƒ³è¿½æ±‚å®Œå…¨çš„æ— é”ç¼–ç¨‹ï¼Œä½†äº‹å®æ˜¯è¿™åŸºæœ¬ä¸å¯èƒ½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬è®¨è®ºlook-freeï¼Œæ˜¯å› ä¸ºæƒ³è¦é¿å…åŠ é”ï¼Œé‚£ä¹ˆä½¿ç”¨CASæ˜¯ä¸€ç§ä¸é”™çš„é€‰æ‹©ã€‚å¦‚æœCAS éƒ½ä¸èƒ½å¤Ÿæ»¡è¶³è¦æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°½é‡å°†Mutex çš„ç²’åº¦ç¼©å°ï¼Œæˆ–è€…ä½¿ç”¨&lt;code&gt;RWmutex &lt;/code&gt;æ›¿æ¢&lt;code&gt;Mutex&lt;/code&gt;ç­‰ã€‚&lt;br&gt;
&lt;code&gt;lock-free&lt;/code&gt;çš„ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘çº¿ç¨‹é˜»å¡å’Œç­‰å¾…æ—¶é—´&lt;/li&gt;
&lt;li&gt;é¿å…çº¿ç¨‹çš„ä¼˜å…ˆçº§åè½¬&lt;/li&gt;
&lt;li&gt;æé«˜å¹¶å‘æ€§èƒ½&lt;/li&gt;
&lt;li&gt;æ¶ˆé™¤ç«æ€æ¡ä»¶ï¼ˆrace conditionï¼‰ã€æ­»é”ã€é¥¿æ­»ç­‰æ½œåœ¨é—®é¢˜&lt;/li&gt;
&lt;li&gt;ä»£ç æ›´åŠ æ¸…æ™°æ˜“æ‡‚&lt;br&gt;
æœ¬æ–‡æˆ‘ä»¬å°†ä½¿ç”¨Goå®è·µä¸€ä¸‹å‡ ç§&lt;code&gt;lock-free&lt;/code&gt;ç¼–ç¨‹çš„æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;channel&#34;&gt;Channel
&lt;/h3&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://go.dev/blog/codelab-share&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Share Memory By Communicating&lt;/a&gt; æ˜¯Goè¯­è¨€å®˜æ–¹æ¨èçš„å…±äº«å†…å­˜æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸è¦é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡ï¼›ç›¸åï¼Œé€šè¿‡é€šä¿¡æ¥å…±äº«å†…å­˜ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;channelå®ç° lock-free çš„ åŸå› æ˜¯&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;channel å°†æ•°æ®æ‰€æœ‰å…¨äº¤å‡ºå»äº†&lt;/li&gt;
&lt;li&gt;channel å†…éƒ¨ä½¿ç”¨äº†é”&lt;br&gt;
åœ¨å®˜æ–¹åšå®¢çš„ä¾‹å­ä¸­&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Resource&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Poller&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;chan&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Resource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;range&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// poll the URL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// send the processed Resource to out&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nx&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;r&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ•°æ®é€šè¿‡ inï¼Œout ä¸¤ä¸ª&lt;code&gt;channel&lt;/code&gt; æµè½¬ï¼Œä¸å­˜åœ¨åŒä¸€ä¸ªæ—¶é—´æœ‰å¤šä¸ª&lt;code&gt;goroutine&lt;/code&gt; åŒæ—¶æ“ä½œä¸€ä»½æ•°æ®ï¼Œæ‰€ä»¥è¿™å°±æ˜¯&lt;code&gt;lock-free&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cas&#34;&gt;CAS
&lt;/h3&gt;&lt;p&gt;ç°åœ¨å‡ ä¹æ‰€æœ‰çš„ CPU æŒ‡ä»¤éƒ½æ”¯æŒÂ &lt;code&gt;CAS&lt;/code&gt;Â çš„åŸå­æ“ä½œï¼Œ&lt;br&gt;
&lt;code&gt;CAS&lt;/code&gt;Â (compare and swap) æ˜¯åŸå­æ“ä½œçš„ä¸€ç§ï¼Œ&lt;strong&gt;ç”¨äºåœ¨å¤šçº¿ç¨‹ä¸­å®ç°åŸå­æ•°æ®äº¤æ¢&lt;/strong&gt;ï¼Œé¿å…å¤šçº¿ç¨‹åŒæ—¶æ”¹å†™æŸä¸€å…±äº«æ•°æ®æ—¶ï¼Œ&lt;strong&gt;ç”±äºæ‰§è¡Œé¡ºåºä¸ç¡®å®šæ€§ä»¥åŠä¸­æ–­çš„ä¸å¯é¢„çŸ¥æ€§äº§ç”Ÿçš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜&lt;/strong&gt;ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨Â &lt;code&gt;CAS&lt;/code&gt;Â æ¥å®ç°Â &lt;code&gt;lock free&lt;/code&gt;çš„æ•°æ®ç»“æ„ã€‚&lt;br&gt;
å¦‚æœæˆ‘ä»¬è¦å®ç°ä¸€ä¸ªstack æ•°æ®ç»“æ„ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨&lt;code&gt;slice&lt;/code&gt;+ &lt;code&gt;RWmutex&lt;/code&gt; ,ä¿è¯å¹¶å‘å®‰å…¨ï¼Œ åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨CASæ¥å®ç° è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œå®Œæ•´çš„ ä»£ç å¦‚ä¸‹ï¼š&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/432ec000d4d9f59bd75e5fdc535822ad.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;p&gt;é€šè¿‡ç®€å•çš„benchmark  æµ‹è¯•ï¼Œ lock-free ç‰ˆæœ¬çš„ stack è¦æ¯” &lt;code&gt;slice&lt;/code&gt;+ &lt;code&gt;RWmutex&lt;/code&gt; å¿«å¤§çº¦20%ï¼Œå¦‚æœæ˜¯åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œlock-free çš„æ€§èƒ½è¡¨ç°å¯èƒ½è¿˜ä¼šæ›´å¥½ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BenchmarkConcurrentPushLockFree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;stack&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewStackByLockFree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;stack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Push&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BenchmarkConcurrentPushSlice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;stack&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewStackBySlice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;stack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Push&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;âœ  lock-free git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;main&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; âœ— go &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; --bench&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;BenchmarkConcurrentPushLockFree-10      &lt;span class=&#34;m&#34;&gt;22657522&lt;/span&gt;                49.66 ns/op
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;BenchmarkConcurrentPushSlice-10         &lt;span class=&#34;m&#34;&gt;29135671&lt;/span&gt;                59.04 ns/op
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id=&#34;struct-copy&#34;&gt;Struct Copy
&lt;/h3&gt;&lt;p&gt;ä»æœ¬è´¨ä¸Šè®²&lt;code&gt;Struct Copy&lt;/code&gt; æ˜¯ä¸€ç§ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚å¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š&lt;br&gt;
&lt;script src=&#34;https://gist.github.com/hxzhouh/903bc495c956a887b3c97f822ce79ab3.js&#34;&gt;&lt;/script&gt;
&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SingleBuffer&lt;/code&gt; æ˜¯ä¸€ä¸ªå…±äº«èµ„æºï¼Œå¤–éƒ¨ä»£ç æ¯æ¬¡ä½¿ç”¨å®ƒçš„æ—¶å€™éœ€è¦åŠ é”ï¼Œ ä½†æ˜¯å¦‚æœç”¨ä¸€ä¸ª&lt;code&gt;BufferWrapper&lt;/code&gt; å°†å®ƒåŒ…è£¹èµ·æ¥ï¼Œè®©æ¯ä¸ªgoroutine æŒæœ‰ä¸€ä¸ªå•ç‹¬çš„&lt;code&gt;BufferWrapper&lt;/code&gt;ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¸ç”¨å»è€ƒè™‘&lt;code&gt;dataracing&lt;/code&gt;äº†ï¼Ÿ ï¼ˆä½¿ç”¨&lt;code&gt;sync.pool&lt;/code&gt;æ˜¯ä¸ºäº†å‡å°‘å†…å­˜åˆ†é…ï¼‰&lt;/p&gt;
&lt;p&gt;æ€§èƒ½æµ‹è¯•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BenchmarkSingleBuffer_print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nf&#34;&gt;run_buff_bench&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;singleBuff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BenchmarkBufferWrapper_print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;testing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;bufferWrapper&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NewBufferWrapper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nf&#34;&gt;run_buff_bench&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufferWrapper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run_buff_bench&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buff&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;printId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;sync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;WaitGroup&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;f&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;defer&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Done&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          &lt;span class=&#34;nx&#34;&gt;buff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;go&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;wg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;BenchmarkSingleBuffer_print-10                 &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;         &lt;span class=&#34;m&#34;&gt;261640427&lt;/span&gt; ns/op
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;BenchmarkBufferWrapper_print-10               &lt;span class=&#34;m&#34;&gt;67&lt;/span&gt;          &lt;span class=&#34;m&#34;&gt;18320110&lt;/span&gt; ns/op
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/valyala/fastjson&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;fastjson&lt;/a&gt; çš„ &lt;a class=&#34;link&#34; href=&#34;https://github.com/valyala/fastjson/blob/93f67d942133e9d219dbbae7a541433f8bbbe7c4/pool.go#L15&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Parser&lt;/a&gt; ä¹Ÿæ˜¯å¦‚æ­¤åšçš„ï¼Œ æˆ‘ä»¬åœ¨å¾ˆå¤šæ€§èƒ½ä¼˜åŒ–åœºæ™¯ä¸‹éƒ½èƒ½è§åˆ°è¿™ç§æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“
&lt;/h3&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†ä¸‰ç§å®ç° &lt;code&gt;lock-free&lt;/code&gt; ç¼–ç¨‹çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡å®é™…çš„ä»£ç å’Œæ€§èƒ½æµ‹è¯•éªŒè¯äº†å®ƒä»¬çš„æœ‰æ•ˆæ€§ã€‚å°½ç®¡å®Œå…¨å®ç°æ— é”ç¼–ç¨‹æ˜¯ä¸€ä¸ªè‰°éš¾çš„ç›®æ ‡ï¼Œä½†é€šè¿‡åˆç†çš„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘é”çš„ä½¿ç”¨ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ CAS å’Œ Struct Copyï¼›åœ¨æ•°æ®æµè½¬æ¸…æ™°ã€æ“ä½œç®€å•çš„åœºæ™¯ä¸­ï¼ŒChannel æ˜¯ä¸€ç§éå¸¸è‡ªç„¶çš„é€‰æ‹©ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>è§£æGo: varint çš„ä½¿ç”¨ä¸å®ç°åŸç†</title>
        <link>https://huizhou92.com/zh-cn/p/%E8%A7%A3%E6%9E%90go-varint-%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</link>
        <pubDate>Fri, 06 Sep 2024 15:33:15 +0800</pubDate>
        
        <guid>https://huizhou92.com/zh-cn/p/%E8%A7%A3%E6%9E%90go-varint-%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</guid>
        <description>&lt;p&gt;æœ€è¿‘å‘ç° &lt;code&gt;Golang&lt;/code&gt; æ ‡å‡†åº“ç«Ÿç„¶è‡ªå¸¦äº† &lt;code&gt;varint&lt;/code&gt; çš„å®ç°ï¼Œä»£ç ä½ç½®åœ¨Â &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/9e9b1f57c26a6d13fdaebef67136718b8042cdba/src/encoding/binary/varint.go&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;encoding/binary/varint.go&lt;/a&gt;ï¼Œè¿™ä¸ªè·Ÿprotobufé‡Œé¢çš„varintå®ç°åŸºæœ¬æ˜¯ä¸€è‡´çš„ã€‚åˆšå¥½å€ŸåŠ© &lt;code&gt;golang&lt;/code&gt; æ ‡å‡†åº“çš„ &lt;code&gt;varint&lt;/code&gt; æºç ï¼Œæˆ‘ä»¬æ¥ç³»ç»Ÿåœ°å­¦ä¹ å’Œæ¢³ç†ä¸‹ &lt;code&gt;varint&lt;/code&gt;ã€‚&lt;br&gt;
ç†Ÿæ‚‰ &lt;code&gt;protobuf&lt;/code&gt; çš„äººè‚¯å®šå¯¹ &lt;code&gt;varint&lt;/code&gt; ä¸é™Œç”Ÿï¼Œ&lt;code&gt;protobuf&lt;/code&gt; é‡Œé¢é™¤äº†å¸¦ fix (å¦‚ fixed32ã€fixed64) ä¹‹å¤–çš„æ•´æ•°ç±»å‹, éƒ½æ˜¯ &lt;code&gt;varint&lt;/code&gt; ç¼–ç ã€‚&lt;br&gt;
&lt;code&gt;varint&lt;/code&gt; çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æ•ˆç‡&lt;/strong&gt;ï¼šä»¥ &lt;code&gt;uint64&lt;/code&gt; ç±»å‹ä¸ºä¾‹ï¼Œå¯ä»¥è¡¨ç¤ºçš„æœ€å¤§å€¼ä¸º 18446744073709551615ã€‚ç„¶è€Œåœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¤„ç†çš„æ•´æ•°å€¼è¿œå°äº uint64 çš„æœ€å¤§å€¼ã€‚å‡è®¾åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä¸­ï¼Œéœ€è¦å¤„ç†çš„æ•´æ•°å€¼ä»…ä¸º 1ï¼Œä½†åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å´éœ€è¦ä½¿ç”¨ &lt;code&gt;8 ä¸ªå­—èŠ‚&lt;/code&gt;æ¥è¡¨ç¤ºè¿™ä¸ªå€¼ã€‚è¿™å°±å¯¼è‡´äº†å¤§é‡çš„ç©ºé—´æµªè´¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å­—èŠ‚å¹¶æ²¡æœ‰å®é™…å­˜å‚¨æœ‰æ•ˆçš„ä¿¡æ¯ã€‚varint ç¼–ç é€šè¿‡ä½¿ç”¨å¯å˜é•¿åº¦çš„å­—èŠ‚åºåˆ—æ¥è¡¨ç¤ºæ•´æ•°ï¼Œä½¿å¾—å°çš„æ•´æ•°å¯ä»¥ç”¨æ›´å°‘çš„å­—èŠ‚è¡¨ç¤ºï¼Œæé«˜ç©ºé—´æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¼å®¹æ€§&lt;/strong&gt;ï¼švarint ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸æ”¹å˜ç¼–ç  / è§£ç é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œå¤„ç†ä¸åŒå¤§å°çš„æ•´æ•°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä¸ç ´åå‘åå…¼å®¹æ€§çš„æƒ…å†µä¸‹ï¼Œå°†ä¸€ä¸ªå­—æ®µä»è¾ƒå°çš„æ•´æ•°ç±»å‹ï¼ˆå¦‚ uint32ï¼‰å‡çº§åˆ°è¾ƒå¤§çš„æ•´æ•°ç±»å‹ï¼ˆå¦‚ uint64ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬æ–‡å°†é€šè¿‡åˆ†æ Golang æ ‡å‡†åº“è‡ªå¸¦çš„ varint æºç å®ç°ï¼Œä»‹ç» varint çš„è®¾è®¡åŸç†ä»¥åŠGolangæ ‡å‡†åº“æ˜¯å¦‚ä½•è§£å†³ varint åœ¨ç¼–ç è´Ÿæ•°æ—¶é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;!-- more--&gt;
&lt;blockquote&gt;
&lt;p&gt;This article was first published in the Medium MPP plan. If you are a Medium user, please follow me on &lt;a class=&#34;link&#34; href=&#34;https://medium.huizhou92.com/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Medium&lt;/a&gt;. Thank you very much.&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id=&#34;varint-çš„è®¾è®¡åŸç†&#34;&gt;Varint çš„è®¾è®¡åŸç†
&lt;/h2&gt;&lt;p&gt;varint çš„è®¾è®¡åŸç†éå¸¸ç®€å•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;7bit ä¸ºä¸€ç»„ï¼šå°†æ•´æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºåˆ†ä¸º 7 ä¸ª bit ä½ä¸€ç»„ã€‚ä»ä½ä½åˆ°é«˜ä½ï¼Œæ¯ 7 ä¸ª bit ä½ä½œä¸ºä¸€ä¸ªå•å…ƒã€‚&lt;/li&gt;
&lt;li&gt;æœ€é«˜ä½è¡¨ç¤º â€œç»§ç»­â€ æ ‡å¿—ã€‚åœ¨æ¯ä¸ª 7 ä½çš„å•å…ƒå‰é¢æ·»åŠ ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå½¢æˆä¸€ä¸ª 8 ä½çš„å­—èŠ‚ã€‚å¦‚æœåé¢è¿˜æœ‰æ›´å¤šçš„å­—èŠ‚ï¼Œè¿™ä¸ªæ ‡å¿—ä½å°±è®¾ç½®ä¸º 1ï¼Œå¦åˆ™è®¾ç½®ä¸º 0ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼šå¯¹äºä¸€ä¸ªæ•´æ•° &lt;code&gt;uint64(300)&lt;/code&gt;ï¼Œå®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯Â &lt;code&gt;100101100&lt;/code&gt;ã€‚æˆ‘ä»¬å¯ä»¥å°†å®ƒåˆ†ä¸ºä¸¤ç»„ï¼Œå³Â &lt;code&gt;10&lt;/code&gt;Â å’ŒÂ &lt;code&gt;0101100&lt;/code&gt;ã€‚ç„¶ååœ¨æ¯ç»„å‰é¢æ·»åŠ æ ‡å¿—ä½ï¼Œå¾—åˆ°ä¸¤ä¸ªå­—èŠ‚Â &lt;code&gt;00000010&lt;/code&gt;Â å’ŒÂ &lt;code&gt;10101100&lt;/code&gt;ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚å°±æ˜¯ 300 çš„ &lt;code&gt;varint&lt;/code&gt; ç¼–ç ã€‚ç›¸æ¯”äºç”¨ &lt;code&gt;uint64&lt;/code&gt; çš„ 4 å­—èŠ‚è¡¨ç¤ºï¼Œå°‘äº† 75% çš„å­˜å‚¨ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;binary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;AppendUvarint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;%08b &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/09/5968188c58521a4262e1c0f76fcc010a.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Figure 1: varint encoding &#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ— ç¬¦å·æ•´æ•°çš„-varint&#34;&gt;æ— ç¬¦å·æ•´æ•°çš„ Varint
&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;code&gt;Golang&lt;/code&gt; æ ‡å‡†åº“ä¸­æœ‰ä¸¤å¥— &lt;code&gt;varint&lt;/code&gt; çš„å‡½æ•°: åˆ†åˆ«ç”¨äºæ— ç¬¦å·æ•´æ•°çš„ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/9e9b1f57c26a6d13fdaebef67136718b8042cdba/src/encoding/binary/varint.go#L51&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;PutUvarint&lt;/a&gt;å’Œ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/9e9b1f57c26a6d13fdaebef67136718b8042cdba/src/encoding/binary/varint.go#L68&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Uvarint&lt;/a&gt;ï¼Œä»¥åŠç”¨äºæœ‰ç¬¦å·æ•´æ•°çš„ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/9e9b1f57c26a6d13fdaebef67136718b8042cdba/src/encoding/binary/varint.go#L115&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Varint&lt;/a&gt; å’Œ &lt;a class=&#34;link&#34; href=&#34;https://github.com/golang/go/blob/9e9b1f57c26a6d13fdaebef67136718b8042cdba/src/encoding/binary/varint.go#L101&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;PutVarint&lt;/a&gt;&lt;br&gt;
æˆ‘ä»¬å…ˆçœ‹ä¸‹æ— ç¬¦å·æ•´æ•°çš„ varint å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;br&gt;
list1: go src PutUvarint&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PutUvarint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x80&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»£ç é‡Œæœ‰ä¸ªéå¸¸é‡è¦çš„å¸¸é‡ï¼š0x80ï¼Œå¯¹åº”äºäºŒè¿›åˆ¶ç¼–ç å°±æ˜¯Â &lt;code&gt;1000 0000&lt;/code&gt;ã€‚è¿™ä¸ªå¸¸é‡å¯¹æ¥ä¸‹æ¥çš„é€»è¾‘éå¸¸é‡è¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;x &amp;gt;= 0x80&lt;/code&gt;ã€‚è¿™æ„å‘³ç€ x çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼è‡³å°‘æœ‰ 8 ä½ï¼Œæˆ‘ä»¬åˆšæ‰è®²åˆ° 7 ä¸ª bit ä½ä¸ºä¸€ç»„ï¼Œé‚£ x å°±éœ€è¦è¢«æ‹†åˆ†äº†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;byte(x) | 0x80&lt;/code&gt;ã€‚å°† x çš„æœ€ä½ 8 ä½ä¸Â &lt;code&gt;1000 0000&lt;/code&gt;Â è¿›è¡ŒæŒ‰ä½æˆ–æ“ä½œï¼Œç„¶åå°†ç»“æœå­˜å‚¨åœ¨ buf[i] ä¸­ã€‚è¿™æ ·Â &lt;strong&gt;æ—¢å¯ä»¥å°†æœ€é«˜ä½è®¾ç½®ä¸º 1ï¼ŒåŒæ—¶ä¹Ÿæå–å‡ºäº† x çš„æœ€ä½ 7 ä½&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x &amp;gt;&amp;gt;= 7&lt;/code&gt;. å°† x å³ç§» 7 ä½ï¼Œå¤„ç†ä¸‹ä¸€ä¸ªåˆ†ç»„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;buf[i] = byte(x)&lt;/code&gt;ã€‚å½“ for å¾ªç¯ç»“æŸæ—¶ï¼Œå³æ„å‘³ç€ x çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼æœ€é«˜ä½å¿…ç„¶æ˜¯ 0ã€‚æ­¤æ—¶å°±ä¸ç”¨åšé¢å¤–çš„è¡¥é›¶æ“ä½œäº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;Uvarint&lt;/code&gt;Â æ˜¯Â &lt;code&gt;PutUvarint&lt;/code&gt;Â çš„é€†è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œvarint å°†æ•´æ•°åˆ’åˆ†ä¸º 7 ä½ä¸€ç»„ã€‚è¿™æ„å‘³ç€ï¼Œå¯¹äºå¤§æ•´æ•° varint å°†ä¼šå‡ºç°è´Ÿå‘ä¼˜åŒ–ã€‚ä¾‹å¦‚å¯¹äº uint64 çš„æœ€å¤§å€¼æ¥è¯´ï¼Œæœ¬æ¥åªéœ€è¦ 8 ä¸ª byte æ¥è¡¨ç¤ºï¼Œä½†åœ¨ varint ä¸­å´éœ€è¦ 10 ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºäº†ã€‚ï¼ˆ&lt;code&gt;64/7 â‰ˆ 10&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;è´Ÿæ•°çš„ç¼–ç zigzag-ç¼–ç &#34;&gt;è´Ÿæ•°çš„ç¼–ç ï¼šzigzag ç¼–ç 
&lt;/h2&gt;&lt;p&gt;çœ‹ä¼¼ varint ç¼–ç å·²ç»å®Œç¾æ— ç¼ºäº†ï¼Œä½†ä»¥ä¸Šå¿½ç•¥äº†ä¸€ç‚¹ï¼šè´Ÿæ•°çš„å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è®¡ç®—æœºä¸­æ•°å­—æ˜¯ç”¨è¡¥ç æ¥è¡¨ç¤ºçš„ï¼Œè€Œè´Ÿæ•°çš„è¡¥ç åˆ™æ˜¯å°†å…¶ç»å¯¹å€¼æŒ‰ä½å–åå†åŠ  1ã€‚è¿™å°±æ„å‘³ç€ä¸€ä¸ªå¾ˆå°çš„è´Ÿæ•°ï¼Œå®ƒçš„äºŒè¿›åˆ¶å½¢å¼å¯¹åº”äºä¸€ä¸ªéå¸¸å¤§çš„æ•´æ•°ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼šå¯¹äºä¸€ä¸ª 32 ä½çš„æ•´æ•°Â &lt;code&gt;-5&lt;/code&gt;Â æ¥è¯´ï¼Œå…¶ç»å¯¹å€¼ 5 çš„äºŒè¿›åˆ¶å½¢å¼æ˜¯Â &lt;code&gt;101&lt;/code&gt;ã€‚ ä½†Â &lt;code&gt;-5&lt;/code&gt;Â çš„äºŒè¿›åˆ¶å½¢å¼å´æ˜¯Â &lt;code&gt;11111111111111111111111111111011&lt;/code&gt;ï¼Œå¦‚æœä½¿ç”¨ &lt;code&gt;varint&lt;/code&gt; å¯¹å…¶ç¼–ç , éœ€è¦ 5 ä¸ªå­—èŠ‚æ‰èƒ½è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;Golangæ ‡å‡†åº“å¼•å…¥äº† &lt;code&gt;zigzag&lt;/code&gt; ç¼–ç æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ&lt;code&gt;zigzag&lt;/code&gt; çš„åŸç†éå¸¸ç®€å•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºæ­£æ•° nï¼Œä¼šå°†å…¶æ˜ å°„ä¸ºÂ &lt;code&gt;2n&lt;/code&gt;ã€‚ä¾‹å¦‚æ•´æ•° 2ï¼Œç»è¿‡ zigzag ç¼–ç ä¹‹åå˜æˆäº† 4ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºè´Ÿæ•°Â &lt;code&gt;-n&lt;/code&gt;Â æ¥è¯´ï¼Œä¼šå°†å…¶æ˜ å°„ä¸ºÂ &lt;code&gt;2n-1&lt;/code&gt;ã€‚ä¾‹å¦‚è´Ÿæ•°Â &lt;code&gt;-3&lt;/code&gt;ï¼Œç»è¿‡ zigzag ç¼–ç ä¹‹åå˜æˆäº† 5ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è¿™æ ·è´Ÿæ•°å’Œæ­£æ•°åœ¨æ•°å€¼ä¸Šå®Œå…¨ä¸ä¼šå†²çªï¼Œæ­£æ•´æ•°å’Œè´Ÿæ•´æ•°äº¤é”™æ’åˆ—&lt;/strong&gt;ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå«åš zigzag ç¼–ç  (é”¯é½¿å½¢ç¼–ç ï¼‰çš„åŸå› ã€‚&lt;br&gt;
åŒæ—¶ï¼Œè´Ÿæ•°è¢«è½¬æ¢æˆæ­£æ•°ä¹‹åï¼ŒäºŒè¿›åˆ¶ç¼–ç ä¹Ÿç²¾ç®€äº†è®¸å¤šã€‚&lt;br&gt;
ä¾‹å¦‚ï¼š å¯¹Â &lt;code&gt;int32(-5)&lt;/code&gt;Â è¿›è¡Œ zigzag ç¼–ç åï¼Œå˜æˆäº† 9ï¼Œå¯¹åº”äºäºŒè¿›åˆ¶ä¸ºÂ &lt;code&gt;00000000000000000000000000001001&lt;/code&gt;ï¼Œä½¿ç”¨ 1 ä¸ªå­—èŠ‚å³å¯è¡¨ç¤º varintã€‚&lt;br&gt;
æˆ‘ä»¬çœ‹ä¸‹ Golang æ ‡å‡†åº“çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PutVarint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;nx&#34;&gt;ux&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;nx&#34;&gt;ux&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;^&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ux&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;PutUvarint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ux&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºæœ‰ç¬¦å·æ•´æ•°çš„varintå®ç°ï¼Œgolangæ ‡å‡†åº“è¿™é‡Œåˆ†æˆäº†ä¸¤æ­¥ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ˆå¯¹æ•´æ•°è¿›è¡Œ zigzag ç¼–ç è¿›è¡Œè½¬æ¢&lt;/li&gt;
&lt;li&gt;å¯¹è½¬æ¢ä¹‹åçš„æ•°å€¼å†è¿›è¡Œ varint ç¼–ç &lt;br&gt;
å¯¹äºè´Ÿæ•°ï¼Œå¤šäº†ä¸€æ­¥ &lt;code&gt;ux = ^ux&lt;/code&gt; ï¼Œè¿™å°±æœ‰äº›éš¾ä»¥ç†è§£äº†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè½¬æ¢ä¹‹åå°±ç­‰äº&lt;code&gt;2n - 1&lt;/code&gt;äº†ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å¤§æ¦‚æ¨å¯¼ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸ªæ•´æ•°Â &lt;code&gt;-n&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹åŸæ•°å€¼å…ˆå·¦ç§»ï¼Œå†è¿›è¡Œå–åã€‚å…¶å®å¯ä»¥çœ‹åšï¼šå¯¹åŸæ•°å€¼å…ˆå–åï¼Œå†å·¦ç§»ï¼Œç„¶å+1ã€‚ å³Â &lt;code&gt;2*(~(-n))+1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬çŸ¥é“&lt;code&gt;è´Ÿæ•°çš„è¡¥ç =ç»å¯¹å€¼æŒ‰ä½å–å+1&lt;/code&gt;ï¼Œé‚£å¦‚ä½•æ ¹æ®è¡¥ç å†æ¨å¯¼å‡ºç»å¯¹å€¼ï¼Ÿè¿™é‡Œæœ‰ä¸ªå…¬å¼æ˜¯ï¼š&lt;code&gt;|A| = ~A+1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬å°†è¿™ä¸ªå…¬å¼å¸¦åˆ°ç¬¬ä¸€æ­¥çš„å¼å­é‡Œé¢ï¼šÂ &lt;code&gt;2*(n-1) + 1 = 2n - 1&lt;/code&gt;ã€‚è¿™å°±å®Œç¾å¯¹åº”ä¸Šäº†è´Ÿæ•°çš„ ZigZag ç¼–ç  (æ•°å­¦å¤šä¹ˆç¾å¦™)ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://images.hxzhouh.com/blog-images/2024/09/4a36258701ba672eb68d4ec7da38285e.png&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;Figure 2: ZigZag encoding &#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ Golang æ ‡å‡†åº“é‡Œé¢ï¼Œè°ƒç”¨ &lt;code&gt;PutUvarint&lt;/code&gt; æ—¶åªä¼šä½¿ç”¨ &lt;code&gt;varint&lt;/code&gt; ç¼–ç ï¼Œè°ƒç”¨ &lt;code&gt;PutVarint&lt;/code&gt; ä¼šå…ˆè¿›è¡Œ &lt;code&gt;zigzag&lt;/code&gt; ç¼–ç ï¼Œå†è¿›è¡Œ &lt;code&gt;varint&lt;/code&gt; ç¼–ç ã€‚&lt;br&gt;
è€Œåœ¨ &lt;code&gt;protobuf&lt;/code&gt; ä¸­ï¼Œå¦‚æœç±»å‹æ˜¯&lt;code&gt; int32&lt;/code&gt;ã€&lt;code&gt;int64&lt;/code&gt;ã€&lt;code&gt;uint32&lt;/code&gt;ã€&lt;code&gt;uint64&lt;/code&gt;ï¼Œåªä¼šä½¿ç”¨ &lt;code&gt;varint&lt;/code&gt; ç¼–ç ã€‚ä½¿ç”¨ &lt;code&gt;sint32&lt;/code&gt;ã€&lt;code&gt;sint64&lt;/code&gt; å°†å…ˆè¿›è¡Œ &lt;code&gt;zigzag&lt;/code&gt; ç¼–ç ï¼Œå†è¿›è¡Œ &lt;code&gt;varint&lt;/code&gt; ç¼–ç &lt;/p&gt;
&lt;h2 id=&#34;varint-ä¸é€‚ç”¨çš„æƒ…å†µ&#34;&gt;Varint ä¸é€‚ç”¨çš„æƒ…å†µ
&lt;/h2&gt;&lt;p&gt;è™½ç„¶ varint ç¼–ç è®¾è®¡éå¸¸ç²¾å¦™ï¼Œä½†å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰çš„åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤§æ•´æ•°&lt;/strong&gt;ï¼šå¯¹äºéå¸¸å¤§çš„æ•´æ•°ï¼Œvarint ç¼–ç å¯èƒ½ä¼šæ¯”å›ºå®šé•¿åº¦çš„ç¼–ç æ›´æ¶ˆè€—ç©ºé—´ã€‚ä¾‹å¦‚å½“æ‰€æœ‰çš„æ•´æ•°å€¼åŸŸå¤§äºÂ &lt;code&gt;2^63&lt;/code&gt;ï¼Œé‚£ä½¿ç”¨ varint ä¼šç”¨åˆ° 10 å­—èŠ‚ã€‚ç›¸æ¯”äºä¼ ç»Ÿçš„å…«å­—èŠ‚æ•´æ•°ï¼Œåè€Œå¤šç”¨äº† 25% çš„ç©ºé—´&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦å¿«é€Ÿéšæœºè®¿é—®çš„æ•°æ®&lt;/strong&gt;ï¼šç”±äº varint æ˜¯å˜é•¿ç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ç›´æ¥é€šè¿‡ç´¢å¼•æ¥è®¿é—®ç‰¹å®šçš„æ•´æ•°ï¼Œå¿…é¡»ä»å¤´å¼€å§‹è§£ç ï¼Œç›´åˆ°æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ•´æ•°ã€‚è¿™ä½¿å¾— varint ç¼–ç ä¸é€‚åˆç”¨äºéœ€è¦å¿«é€Ÿéšæœºè®¿é—®çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦é¢‘ç¹è¿›è¡Œæ•°å­¦è¿ç®—çš„æ•°æ®&lt;/strong&gt;ï¼šç”±äº varint ç¼–ç çš„æ•°æ®éœ€è¦å…ˆè§£ç æ‰èƒ½è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªåº”ç”¨éœ€è¦é¢‘ç¹åœ°å¯¹æ•°æ®è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œé‚£ä¹ˆä½¿ç”¨ varint ç¼–ç å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®‰å…¨æ•æ„Ÿçš„åº”ç”¨&lt;/strong&gt;ï¼švarint ç¼–ç çš„æ•°æ®å¯èƒ½ä¼šæš´éœ²å‡ºä¸€äº›å…³äºåŸå§‹æ•´æ•°çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å®ƒçš„å¤§å°ã€‚åœ¨æŸäº›å®‰å…¨æ•æ„Ÿçš„åº”ç”¨ä¸­ï¼Œè¿™å¯èƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        
    </channel>
</rss>
