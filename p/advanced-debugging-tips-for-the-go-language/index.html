<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name="baidu-site-verification" content="codeva-3VTxLtnqFP" /><meta name='description' content="Learning to debug makes you a better programmer.">
<title>Advanced Debugging Tips for the Go Language</title>

<link rel='canonical' href='https://huizhou92.com/p/advanced-debugging-tips-for-the-go-language/'>

<link rel="stylesheet" href="/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css"><meta property='og:title' content="Advanced Debugging Tips for the Go Language">
<meta property='og:description' content="Learning to debug makes you a better programmer.">
<meta property='og:url' content='https://huizhou92.com/p/advanced-debugging-tips-for-the-go-language/'>
<meta property='og:site_name' content='huizhou92&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='golang' /><meta property='article:published_time' content='2024-02-04T13:54:42&#43;00:00'/><meta property='article:modified_time' content='2024-02-04T13:54:42&#43;00:00'/>
<meta name="twitter:site" content="@https://x.com/piaopiaopig">
    <meta name="twitter:creator" content="@https://x.com/piaopiaopig"><meta name="twitter:title" content="Advanced Debugging Tips for the Go Language">
<meta name="twitter:description" content="Learning to debug makes you a better programmer.">
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-JMPMQ2QREG"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-JMPMQ2QREG');
        }
      </script>
    
  

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9000447749076746"
     crossorigin="anonymous"></script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_huda2458f72ce188392d75c5d51cd8e24e_373_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">😄</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">huizhou92&#39;s Blog</a></h1>
            <h2 class="site-description">Backend Engineer With A Focus On Golang, Cloud Computing, Data Storage And Efficiency Tools. Lifelong Learner.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/hxzhouh'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/piaopiaopig'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/column/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Column</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://huizhou92.com/" selected>English</option>
                                
                                    <option value="https://huizhou92.com/zh-cn/" >中文</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#nm">nm</a></li>
    <li><a href="#compile">compile</a></li>
    <li><a href="#objdump">objdump</a></li>
    <li><a href="#pprof">pprof</a></li>
    <li><a href="#trace">trace</a></li>
  </ol>

  <ol>
    <li><a href="#running-unittests">Running Unit Tests</a></li>
    <li><a href="#running-gotest">Running <code>go test</code></a></li>
    <li><a href="#compilation-and-execution">Compilation and Execution</a></li>
  </ol>

  <ol>
    <li><a href="#dlv-debugging">dlv Debugging</a>
      <ol>
        <li>
          <ol>
            <li><a href="#debugging-binaries">Debugging Binaries</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#debugging-processes">Debugging Processes</a>
      <ol>
        <li>
          <ol>
            <li><a href="#debugging-corefiles">Debugging Core Files</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#system-summary">System Summary</a></li>
    <li><a href="#breakpoint-related"><strong>Breakpoint-related</strong></a></li>
    <li><a href="#information-printing"><strong>Information Printing</strong></a></li>
    <li><a href="#goroutine-related"><strong>Goroutine-related</strong></a></li>
    <li><a href="#stack-related"><strong>Stack-related</strong></a></li>
    <li><a href="#other-commands"><strong>Other Commands</strong></a>
      <ol>
        <li><a href="#gdb-debugging">gdb Debugging</a>
          <ol>
            <li><a href="#dlv-debugging-example">dlv Debugging Example</a></li>
            <li><a href="#gdb-debugging-example">gdb Debugging Example</a></li>
          </ol>
        </li>
        <li><a href="#tips-andtricks">Tips and Tricks</a></li>
        <li><a href="#dont-know-how-to-set-breakpoints-in-functions">Don’t know how to set breakpoints in functions?</a></li>
        <li><a href="#dont-know-the-callingcontext">Don’t know the calling context?</a></li>
        <li><a href="#dont-know-how-to-enablepprof">Don’t know how to enable pprof?</a></li>
        <li><a href="#why-does-the-code-sometimes-execute-unexpectedly-during-single-step-debugging">Why does the code sometimes execute unexpectedly during single-step debugging?</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/go/" style="background-color: #2a9d8f; color: #ffff;">
                go
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/advanced-debugging-tips-for-the-go-language/">Advanced Debugging Tips for the Go Language</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Learning to debug makes you a better programmer.
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 04, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    11 minute read
                </time>
            </div>
        
         
        <div class="article-analysic">&nbsp
    
            <?xml version="1.0" encoding="utf-8"?>

<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg fill="#000000" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  
  <g id="read">
    <g>
      <path  d="M12,18.883a10.8,10.8,0,0,1-9.675-5.728,2.6,2.6,0,0,1,0-2.31A10.8,10.8,0,0,1,12,5.117a10.8,10.8,0,0,1,9.675,5.728h0a2.6,2.6,0,0,1,0,2.31A10.8,10.8,0,0,1,12,18.883ZM12,6.117a9.787,9.787,0,0,0-8.78,5.176,1.586,1.586,0,0,0,0,1.415A9.788,9.788,0,0,0,12,17.883a9.787,9.787,0,0,0,8.78-5.176,1.584,1.584,0,0,0,0-1.414h0A9.787,9.787,0,0,0,12,6.117Z"/>
      <path  d="M12,16.049A4.049,4.049,0,1,1,16.049,12,4.054,4.054,0,0,1,12,16.049Zm0-7.1A3.049,3.049,0,1,0,15.049,12,3.052,3.052,0,0,0,12,8.951Z"/>
      <circle  cx="12" cy="12" r="2.028"/>
    </g>
  </g>
</svg>
            <time class="article-words">
                <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span> &nbspReads</span>
            </time>
        </div>
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>Last time we shared the method of <a class="link" href="https://medium.com/@hxzhouh/how-to-analyze-go-code-in-assembly-81cada6d4f0a"  target="_blank" rel="noopener"
    >debugging Go code using assembly language</a>. Assembly language allows us to easily trace low-level knowledge of the Go runtime and other underlying details. In this article, we will introduce the powerful debugging tool called “go tool”, which, when mastered, can elevate your development skills to the next level.</p>
<p><img src="https://cdn-images-1.medium.com/max/800/0*2Qecdc1lDBmffp1b"
	
	
	
	loading="lazy"
	
	
></p>
<p>This article focuses on practical techniques for debugging in Golang and the effective usage of related tools, so you no longer need to worry about how to debug Golang code. Golang, as a modern language, comes with built-in debugging capabilities from the very beginning:</p>
<ul>
<li>Golang tools are directly integrated into the language tools, supporting memory analysis, CPU analysis, and blocking lock analysis, among others.</li>
<li>Delve and GDB are the most commonly used debug tools, allowing you to dive deeper into program debugging.</li>
<li>Delve is currently the most user-friendly Golang debugging program, and IDE debugging is essentially calling dlv, such as in Goland.</li>
<li>Unit testing is deeply integrated into the language design, making it very convenient to execute unit tests and generate code coverage.</li>
</ul>
<h1 id="golang-tools">Golang tools
</h1><p>Golang integrates a variety of useful tools at the language level, which are the essence of the experience accumulated by Robert Griesemer, Rob Pike, Ken Thompson, and other experts. After installing Golang, you can see all the built-in tools by executing <code>go tool</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">hxzhouh@hxzhouhdeMacBook-Pro ~&gt; go tool
</span></span><span class="line"><span class="cl"> addr2line
</span></span><span class="line"><span class="cl"> asm
</span></span><span class="line"><span class="cl"> buildid
</span></span><span class="line"><span class="cl"> cgo
</span></span><span class="line"><span class="cl"> compile
</span></span><span class="line"><span class="cl"> covdata
</span></span><span class="line"><span class="cl"> cover
</span></span><span class="line"><span class="cl"> dist
</span></span><span class="line"><span class="cl"> distpack
</span></span><span class="line"><span class="cl"> doc
</span></span><span class="line"><span class="cl"> fix
</span></span><span class="line"><span class="cl"> link
</span></span><span class="line"><span class="cl"> nm
</span></span><span class="line"><span class="cl"> objdump
</span></span><span class="line"><span class="cl"> pack
</span></span><span class="line"><span class="cl"> pprof
</span></span><span class="line"><span class="cl"> test2json
</span></span><span class="line"><span class="cl"> trace
</span></span><span class="line"><span class="cl"> vet
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here, I will focus on selecting several commonly used debug tools:</p>
<ul>
<li><code>nm</code>: view the symbol table (equivalent to the system <code>nm</code> command).</li>
<li><code>objdump</code>: disassembly tool, used to analyze binary files (equivalent to the system <code>objdump</code> command).</li>
<li><code>pprof</code>: metric and performance analysis tool.</li>
<li><code>cover</code>: code coverage generation.</li>
<li><code>trace</code>: sampling over a period of time, metric tracking and analysis tool.</li>
<li><code>compile</code>: code assembly.</li>
</ul>
<p>Now, I will demonstrate the usage of these tools with an example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl"> <span class="err">​</span>
</span></span><span class="line"><span class="cl"> <span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;log&#34;</span>
</span></span><span class="line"><span class="cl">     <span class="s">&#34;net&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="err">​</span>
</span></span><span class="line"><span class="cl"> <span class="kd">var</span> <span class="nx">helloCount</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"> <span class="err">​</span>
</span></span><span class="line"><span class="cl"> <span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nx">listener</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:50050&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">defer</span> <span class="nx">listener</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="err">​</span>
</span></span><span class="line"><span class="cl">     <span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nx">conn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">listener</span><span class="p">.</span><span class="nf">Accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">         <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="nx">tcpConn</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.(</span><span class="o">*</span><span class="nx">net</span><span class="p">.</span><span class="nx">TCPConn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="nx">err</span> <span class="p">=</span> <span class="nx">tcpConn</span><span class="p">.</span><span class="nf">SetNoDelay</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">             <span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="k">go</span> <span class="nf">handleConnection</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="err">​</span>
</span></span><span class="line"><span class="cl"> <span class="kd">func</span> <span class="nf">handleConnection</span><span class="p">(</span><span class="nx">conn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">defer</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">     <span class="nx">helloCount</span><span class="o">++</span>
</span></span><span class="line"><span class="cl">     <span class="nx">resp</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;Hello count: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="nx">resp</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">resp</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nb">rune</span><span class="p">(</span><span class="nx">helloCount</span><span class="p">)))</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="nx">resp</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">resp</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="nx">conn</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="c1">// go build main.go
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="nm">nm
</h2><p>The <code>nm</code> command is used to view the symbol table, which is equivalent to the system <code>nm</code> command and is very useful. When setting breakpoints, if you don&rsquo;t know the function symbol of the breakpoint, you can use this command to find out (this command operates on binary program files).</p>
<h2 id="compile">compile
</h2><p>Assemble a specific file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go tool compile -N -l -S main.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>You will be able to see the assembly code corresponding to your Go code (please note that this command operates on Go code text), which is cool.</p>
<h2 id="objdump">objdump
</h2><p>The objdump tool is used to disassemble binaries, equivalent to the system <code>objdump</code> (please note that this command parses binary program files).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go tool objdump main.o
</span></span><span class="line"><span class="cl">go tool objdump -s DoFunc main.o  // Disassembling specific functions
</span></span></code></pre></td></tr></table>
</div>
</div><p>Assembly code may not be needed in 90% of scenarios, but if you have experience working with C programs, in certain special situations, inferring application behavior by disassembling a piece of logic may be your only way out. This is because the code running in production usually has optimization enabled, which can cause your code to not match. Furthermore, you cannot attach to processes at will in production environments. Many times, you only have a core file to troubleshoot.</p>
<h2 id="pprof">pprof
</h2><p>pprof supports four types of analysis:</p>
<ul>
<li><code>CPU</code>: CPU analysis, sampling calls that consume CPU resources, which is generally used to locate and troubleshoot areas of high computational resource consumption in programs.</li>
<li><code>Memory</code>: Memory analysis, which is generally used to troubleshoot memory usage, memory leaks, and other issues.</li>
<li><code>Block</code>: Blocking analysis, which samples the blocking calls in the program.</li>
<li><code>Mutex</code>: Mutex analysis, which samples the competition for mutex locks.</li>
</ul>
<p>For more information about pprof, you can refer to this article.</p>
<h2 id="trace">trace
</h2><p>Program trace debugging:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go tool trace -http<span class="o">=</span><span class="s2">&#34;:6060&#34;</span> ./ssd_336959_20190704_105540_trace
</span></span></code></pre></td></tr></table>
</div>
</div><p>The trace command allows you to trace and collect information over a period of time, then dump it to a file, and finally analyze the dump file using <code>go tool trace</code> and open it in a web format.</p>
<h1 id="unit-testing">Unit Testing
</h1><p>The importance of unit testing is self-evident. In Golang, files ending with <code>_test.go</code> are considered test files. As a modern language, Golang supports unit testing at the language tool level.</p>
<h2 id="running-unittests">Running Unit Tests
</h2><p>There are two ways to execute unit tests:</p>
<ul>
<li>Run <code>go test</code> directly, which is the simplest method.</li>
<li>Compile the test files first, then run them. This method provides more flexibility.</li>
</ul>
<h2 id="running-gotest">Running <code>go test</code>
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">// Run go <span class="nb">test</span> directly in your project directory.
</span></span><span class="line"><span class="cl"> go <span class="nb">test</span> .
</span></span><span class="line"><span class="cl"> // Specify the running <span class="k">function</span>.
</span></span><span class="line"><span class="cl"> go <span class="nb">test</span> -run<span class="o">=</span>TestPutAndGetKeyValue
</span></span><span class="line"><span class="cl"> // Print details.
</span></span><span class="line"><span class="cl"> go <span class="nb">test</span> -v
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="compilation-and-execution">Compilation and Execution
</h2><p>Essentially, running Golang unit tests involves compiling <code>*_test.go</code> files into binaries and then running these binaries. When you execute <code>go test</code>, the tool handles these actions for you, but you can also perform them separately.</p>
<p>Compile the test files to generate the test executable:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">// Compile the .test file first.
</span></span><span class="line"><span class="cl">go <span class="nb">test</span> -c -coverpkg<span class="o">=</span>. -covermode<span class="o">=</span>atomic -o 1TestSwapInt32_in_sync_atomic.test sync/atomic
</span></span><span class="line"><span class="cl"> // Specify running a file.
</span></span><span class="line"><span class="cl">./1TestSwapInt32_in_sync_atomic.test -test.timeout<span class="o">=</span>10m0s -test.v<span class="o">=</span><span class="nb">true</span> -test.run<span class="o">=</span>TestSwapInt32
</span></span></code></pre></td></tr></table>
</div>
</div><p>This method is usually used in the following scenarios:</p>
<ol>
<li>Compile on one machine and run tests on another.</li>
<li>Debugging test programs.</li>
</ol>
<h1 id="code-coverageanalysis">Code Coverage Analysis
</h1><p>Golang’s code coverage is based on unit tests, which serve as the starting point for measuring code coverage of your business code. The operation is simple:</p>
<ol>
<li>Add the <code>-coverprofile</code> parameter when running tests to record code coverage.</li>
<li>Use the <code>go tool cover</code> command to analyze and generate coverage reports.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go <span class="nb">test</span> -coverprofile<span class="o">=</span>coverage.out
</span></span><span class="line"><span class="cl">go tool cover -func<span class="o">=</span>coverage.out
</span></span></code></pre></td></tr></table>
</div>
</div><p>The output will be similar to the following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">hxzhouh@hxzhouhdeMacBook-Pro ~/w/g/s/sync&gt; go tool cover -func<span class="o">=</span>coverage.out                                                                                                                heads/go1.21.4?
</span></span><span class="line"><span class="cl">sync/cond.go:47:        NewCond                         100.0%
</span></span><span class="line"><span class="cl">sync/cond.go:66:        Wait                            100.0%
</span></span><span class="line"><span class="cl">sync/cond.go:81:        Signal                          100.0%
</span></span><span class="line"><span class="cl">sync/cond.go:90:        Broadcast                       100.0%
</span></span><span class="line"><span class="cl">sync/cond.go:98:        check                           100.0%
</span></span><span class="line"><span class="cl">sync/cond.go:116:       Lock                            0.0%
</span></span><span class="line"><span class="cl">sync/cond.go:117:       Unlock                          0.0%
</span></span><span class="line"><span class="cl">sync/map.go:104:        newEntry                        100.0%
</span></span><span class="line"><span class="cl">sync/map.go:110:        loadReadOnly                    100.0%
</span></span><span class="line"><span class="cl">sync/map.go:120:        Load                            100.0%
</span></span><span class="line"><span class="cl">sync/map.go:145:        load                            100.0%
</span></span><span class="line"><span class="cl">.......
</span></span></code></pre></td></tr></table>
</div>
</div><p>This way, you can see the code coverage for each function.</p>
<h1 id="program-debugging">Program Debugging
</h1><p>Program debugging mainly relies on two tools:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">1. dlv
</span></span><span class="line"><span class="cl">2. gdb
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here, I recommend dlv because GDB’s functionality is limited. GDB does not understand Golang’s specific types such as channels, maps, and slices. GDB’s native support for goroutines is limited since it only understands threads. However, GDB has one irreplaceable feature, which is the <code>gcore</code> command.</p>
<h2 id="dlv-debugging">dlv Debugging
</h2><h4 id="debugging-binaries">Debugging Binaries
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv <span class="nb">exec</span> &lt;path/to/binary&gt; <span class="o">[</span>flags<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv <span class="nb">exec</span> ./main
</span></span></code></pre></td></tr></table>
</div>
</div><p>Debugging binaries with dlv and passing arguments:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv <span class="nb">exec</span> ./main -- --audit<span class="o">=</span>./d
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="debugging-processes">Debugging Processes
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv attach <span class="si">${</span><span class="nv">pid</span><span class="si">}</span> <span class="o">[</span>executable<span class="o">]</span> <span class="o">[</span>flags<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The process ID is mandatory. For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv attach <span class="m">12808</span> ./main
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="debugging-corefiles">Debugging Core Files
</h4><p>Debugging core files with dlv and redirecting standard output to a file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv core &lt;executable&gt; &lt;core&gt; <span class="o">[</span>flags<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv core ./main core.277282
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="common-debugging-syntax">Common Debugging Syntax
</h1><h2 id="system-summary">System Summary
</h2><p><strong>Program Execution</strong></p>
<ol>
<li>call: call a function (note that this will cause the entire program to run).</li>
<li>continue: resume execution.</li>
<li>next: step over.</li>
<li>restart: restart.</li>
<li>step: step into a function.</li>
<li>step-instruction: step into a specific assembly instruction.</li>
<li>stepout: step out of the current function.</li>
</ol>
<h2 id="breakpoint-related"><strong>Breakpoint-related</strong>
</h2><ol>
<li>break (alias: b): set a breakpoint.</li>
<li>breakpoints (alias: bp): print all breakpoint information.</li>
<li>clear: clear a breakpoint.</li>
<li>clearall: clear all breakpoints.</li>
<li>condition (alias: cond): set a conditional breakpoint.</li>
<li>on: set a command to be executed when a breakpoint is hit.</li>
<li>trace (alias: t): set a tracepoint, which is also a breakpoint but does not stop the program when hit; it only prints a line of information. This command is useful in certain scenarios where stopping the program affects logic (e.g., business timeouts), and you only want to print a specific variable.</li>
</ol>
<h2 id="information-printing"><strong>Information Printing</strong>
</h2><ul>
<li>args: print function arguments.</li>
<li>examinemem (alias: x): a powerful command for examining memory, similar to gdb’s <code>x</code> command.</li>
<li>locals: print local variables.</li>
<li>print (alias: p): print an expression or variable.</li>
<li>regs: print register information.</li>
<li>set: set variable value.</li>
<li>vars: print global variables (package variables).</li>
<li>whatis: print type information.</li>
</ul>
<h2 id="goroutine-related"><strong>Goroutine-related</strong>
</h2><ul>
<li>goroutine (alias: gr): print information of a specific goroutine.</li>
<li>goroutines (alias: grs): list all goroutines.</li>
<li>thread (alias: tr): switch to a specific thread.</li>
<li>threads: print information of all threads.</li>
</ul>
<h2 id="stack-related"><strong>Stack-related</strong>
</h2><ul>
<li>deferred: execute commands in the context of a defer function.</li>
<li>down: move up the stack.</li>
<li>frame: jump to a specific stack frame.</li>
<li>stack (alias: bt): print stack information.</li>
<li>up: move down the stack.</li>
</ul>
<h2 id="other-commands"><strong>Other Commands</strong>
</h2><ul>
<li>config: modify configurations.</li>
<li>disassemble (alias: disass): disassemble.</li>
<li>edit (alias: ed): omitted.</li>
<li>exit (alias: quit | q): omitted.</li>
<li>funcs: print all function symbols.</li>
<li>libraries: print all loaded dynamic libraries.</li>
<li>list (alias: ls | l): display source code.</li>
<li>source: load commands.</li>
<li>sources: print source code.</li>
<li>types: print all type information.</li>
</ul>
<p>The above commands cover the complete set of commands supported by dlv, which meet our debugging needs (some commands are only applicable during development and debugging, as it is not possible to single-step debug on production code in most cases).</p>
<p>Application Examples</p>
<p><strong>Print Global Variables</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">vars</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is very useful for inspecting global variables.</p>
<p><strong>Conditional Breakpoints</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Set a breakpoint first.</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>dlv<span class="o">)</span> b
</span></span><span class="line"><span class="cl"><span class="c1"># Check breakpoint information.</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>dlv<span class="o">)</span> bp
</span></span><span class="line"><span class="cl"><span class="c1"># Customize the condition.</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>dlv<span class="o">)</span> condition <span class="m">2</span> <span class="nv">i</span><span class="o">==</span><span class="m">2</span> <span class="o">&amp;&amp;</span> <span class="nv">j</span><span class="o">==</span><span class="m">7</span> <span class="o">&amp;&amp;</span> <span class="nv">z</span><span class="o">==</span><span class="m">32</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Inspecting the Stack</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Show all stacks.</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>dlv<span class="o">)</span> goroutines
</span></span><span class="line"><span class="cl"><span class="c1"># Expand all stacks.</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>dlv<span class="o">)</span> goroutines -t
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Examining Memory</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>dlv<span class="o">)</span> x -fmt hex -len <span class="m">20</span> 0xc00008af38
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>x</code> command is the same as gdb&rsquo;s <code>x</code> command.</p>
<h3 id="gdb-debugging">gdb Debugging
</h3><p>GDB’s support for Golang debugging is achieved through a Python script called <code>src/runtime/runtime-gdb.py</code>, so its functionality is limited. GDB can only perform basic variable printing and cannot understand some of Golang&rsquo;s specific types such as channels, maps, and slices. GDB cannot directly debug goroutines because it only understands threads. However, GDB has one feature that cannot be replaced, which is the <code>gcore</code> command.</p>
<h4 id="dlv-debugging-example">dlv Debugging Example
</h4><p>Debugging a Binary</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv <span class="nb">exec</span> ./main
</span></span></code></pre></td></tr></table>
</div>
</div><p>Debugging a Process</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv attach <span class="m">12808</span> ./main
</span></span></code></pre></td></tr></table>
</div>
</div><p>Debugging a Core File</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">dlv core ./main core.277282
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="gdb-debugging-example">gdb Debugging Example
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdb ./main
</span></span></code></pre></td></tr></table>
</div>
</div><p>Print Global Variables (note the single quotation marks)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p <span class="s1">&#39;runtime.firstmoduledata&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Due to GDB’s limited understanding of Golang’s type system, sometimes it may not be able to print variables, so please pay attention to this.</p>
<p>Print Array Length</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>gdb<span class="o">)</span> p <span class="nv">$len</span><span class="o">(</span>xxx<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Therefore, I usually only use GDB to generate core files.</p>
<h3 id="tips-andtricks">Tips and Tricks
</h3><h3 id="dont-know-how-to-set-breakpoints-in-functions">Don’t know how to set breakpoints in functions?
</h3><p>Sometimes you don’t know how to set breakpoints in a function. You can use <code>nm</code> to query the function and then set a breakpoint, which will ensure that you hit the breakpoint.</p>
<h3 id="dont-know-the-callingcontext">Don’t know the calling context?
</h3><p>Add the following line in your code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">debug.PrintStack<span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will print the stack trace at the current code position, allowing you to understand the calling path of the function.</p>
<h3 id="dont-know-how-to-enablepprof">Don’t know how to enable pprof?
</h3><p>There are two ways to enable pprof, corresponding to two packages:</p>
<ul>
<li>net/http/pprof: used in web server scenarios.</li>
<li>runtime/pprof: used in non-server applications.</li>
</ul>
<p>These two packages are essentially the same, with <code>net/http/pprof</code> being a web wrapper on top of <code>runtime/pprof</code>.</p>
<p><strong>Using</strong> <code>net/http/pprof</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nx">_</span> <span class="s">&#34;net/http/pprof&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Using</strong> <code>runtime/pprof</code></p>
<p>This method is usually used for performance optimization. When running a program that is not a server application, you want to find bottlenecks, so you typically use this method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// CPU pprof file path
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s">&#34;cpufile.pprof&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Start CPU pprof
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">pprof</span><span class="p">.</span><span class="nf">StartCPUProfile</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">pprof</span><span class="p">.</span><span class="nf">StopCPUProfile</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="why-does-the-code-sometimes-execute-unexpectedly-during-single-step-debugging">Why does the code sometimes execute unexpectedly during single-step debugging?
</h3><p>This situation is usually caused by compiler optimization, such as function inlining and removal of redundant logic and parameters from the compiled binary. This can cause unexpected execution during dlv single-step debugging or prevent the printing of certain variables. The solution to this problem is to disable compiler optimization.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go build -gcflags <span class="s2">&#34;-N -l&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="conclusion">Conclusion
</h1><p>This article provides a systematic overview of the techniques and usage of Golang program debugging:</p>
<ol>
<li>The language tool package provides built-in tools that support assembly, disassembly, pprof analysis, symbol table queries, and other practical functions.</li>
<li>The language tool package integrates unit testing, and code coverage relies on triggering unit tests.</li>
<li>The powerful dlv/gdb tools serve as the main debugging tools, supporting the analysis of binaries, processes, and core files.</li>
</ol>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/golang/">Golang</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/go-action-error-handling-in-grpc/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go Action: Error Handling In gRPC</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/secure-communication-with-grpc-from-ssl/tls-certification-to-san-certification/">
        
        

        <div class="article-details">
            <h2 class="article-title">Secure Communication with gRPC: From SSL/TLS Certification to SAN Certification</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/smart-go-compiler-slimming/">
        
        

        <div class="article-details">
            <h2 class="article-title">Smart Go compiler: Slimming</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/if-google-no-longer-supports-golang/">
        
        

        <div class="article-details">
            <h2 class="article-title">If Google No Longer supports Golang</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/analyzing-high-performance-network-framework-nbio-in-go/">
        
        

        <div class="article-details">
            <h2 class="article-title">Analyzing High-Performance Network Framework nbio in Go</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="//cdn.jsdelivr.net/npm/twikoo@1.6.21/dist/twikoo.all.min.js"></script>
<div id="tcomment"></div>
<style>
    .twikoo {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
    :root[data-scheme="dark"] {
        --twikoo-body-text-color-main: rgba(255, 255, 255, 0.9);
        --twikoo-body-text-color: rgba(255, 255, 255, 0.7);
    }
    .twikoo .el-input-group__prepend,
    .twikoo .tk-action-icon,
    .twikoo .tk-submit-action-icon,
    .twikoo .tk-time,
    .twikoo .tk-comments-no,
    .twikoo .tk-comments-count {
        color: var(--twikoo-body-text-color);
    }
    .twikoo .el-input__inner,
    .twikoo .el-textarea__inner,
    .twikoo .tk-preview-container,
    .twikoo .tk-content,
    .twikoo .tk-nick,
    .twikoo .tk-send {
        color: var(--twikoo-body-text-color-main);
    }
    .twikoo .el-button{
        color: var(--twikoo-body-text-color)!important;
    }
    .twikoo .el-input__count {
        color: var(--twikoo-body-text-color) !important;
    }
    .OwO .OwO-body {
        background-color: var(--body-background) !important;
        color: var(--body-text-color) !important;
    }
</style><script>
    twikoo.init({
        envId: 'https:\/\/twikoo.yixiao9206.cn',
        el: '#tcomment',})
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2024 Copyright © 2023 huizhou92
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
    
     	
	
	<div class="busuanzi-footer">
	<span id="busuanzi_container_site_pv">
		Total site visits: <span id="busuanzi_value_site_pv"></span>
	</span>
	<span id="busuanzi_container_site_uv">
		Total Visitors: <span id="busuanzi_value_site_uv"></span>
	</span>
	</div></footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
