<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name="baidu-site-verification" content="codeva-3VTxLtnqFP" /><meta name='description' content="Will it become the standard library for go maps?">
<title>SwissTable: A High-Performance Hash Table Implementation</title>

<link rel='canonical' href='https://huizhou92.com/p/swisstable-a-high-performance-hash-table-implementation/'>

<link rel="stylesheet" href="/scss/style.min.7a8650e463f7bf12cc86f69675ab60349b39aa794883f0c4ba0547d9e71cd5b5.css"><meta property='og:title' content="SwissTable: A High-Performance Hash Table Implementation">
<meta property='og:description' content="Will it become the standard library for go maps?">
<meta property='og:url' content='https://huizhou92.com/p/swisstable-a-high-performance-hash-table-implementation/'>
<meta property='og:site_name' content='huizhou92&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='golang' /><meta property='article:tag' content='map' /><meta property='article:tag' content='Swissmap' /><meta property='article:published_time' content='2024-09-30T11:45:52&#43;08:00'/><meta property='article:modified_time' content='2024-09-30T11:45:48&#43;08:00'/><meta property='og:image' content='https://images.hxzhouh.com/blog-images/2024/09/f08c74aea8485d51d461d18494df416e.png' />
<meta name="twitter:site" content="@piaopiaopig">
    <meta name="twitter:creator" content="@piaopiaopig"><meta name="twitter:title" content="SwissTable: A High-Performance Hash Table Implementation">
<meta name="twitter:description" content="Will it become the standard library for go maps?"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://images.hxzhouh.com/blog-images/2024/09/f08c74aea8485d51d461d18494df416e.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-JMPMQ2QREG"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-JMPMQ2QREG');
        }
      </script>
    
  

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9000447749076746"
crossorigin="anonymous"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9000447749076746"
     crossorigin="anonymous"></script>

<script defer src="https://cloud.umami.is/script.js" data-website-id="e4ee8ffe-fb88-4635-9953-715598461baa"></script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu82a0a27be0be6253ef292d06d582a6ab_94926_300x0_resize_q75_box.jpeg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">huizhou92&#39;s Blog</a></h1>
            <h2 class="site-description">Backend Engineer With A Focus On Golang, Cloud Computing, Data Storage And Efficiency Tools. Lifelong Learner.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/hxzhouh'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/piaopiaopig'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://huizhou92.com/" selected>English</option>
                                
                                    <option value="https://huizhou92.com/zh-cn/" >中文</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>


<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-9000447749076746"
   data-ad-slot="5063552270"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
<script>
   (adsbygoogle = window.adsbygoogle || []).push({});
</script>


    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#traditional-hashtable">Traditional <code>Hashtable</code></a>
      <ol>
        <li><a href="#chaining">Chaining</a></li>
        <li><a href="#linear-probing">Linear Probing</a></li>
        <li><a href="#go-map-data-storage">Go Map Data Storage</a></li>
      </ol>
    </li>
    <li><a href="#swisstable-an-efficient-hashtable-implementation">SwissTable: An Efficient Hashtable Implementation</a>
      <ol>
        <li><a href="#basic-structure-of-swisstable">Basic Structure of SwissTable</a></li>
        <li><a href="#adding-data">Adding Data</a></li>
        <li><a href="#advantages-of-swisstable">Advantages of SwissTable</a></li>
      </ol>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#references">References</a></li>
  </ol>
</nav>
        </div>
    </section>


<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-9000447749076746"
   data-ad-slot="5063552270"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
<script>
   (adsbygoogle = window.adsbygoogle || []).push({});
</script>
            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/swisstable-a-high-performance-hash-table-implementation/">
                
                    <img src="https://images.hxzhouh.com/blog-images/2024/09/f08c74aea8485d51d461d18494df416e.png" loading="lazy" alt="Featured image of post SwissTable: A High-Performance Hash Table Implementation" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/tech/" style="background-color: #2a9d8f; color: #ffff;">
                tech
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/swisstable-a-high-performance-hash-table-implementation/">SwissTable: A High-Performance Hash Table Implementation</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Will it become the standard library for go maps?
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 30, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    9 minute read
                </time>
            </div>
        
         
        <div class="article-analysic">&nbsp
    
            <?xml version="1.0" encoding="utf-8"?>

<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg fill="#000000" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  
  <g id="read">
    <g>
      <path  d="M12,18.883a10.8,10.8,0,0,1-9.675-5.728,2.6,2.6,0,0,1,0-2.31A10.8,10.8,0,0,1,12,5.117a10.8,10.8,0,0,1,9.675,5.728h0a2.6,2.6,0,0,1,0,2.31A10.8,10.8,0,0,1,12,18.883ZM12,6.117a9.787,9.787,0,0,0-8.78,5.176,1.586,1.586,0,0,0,0,1.415A9.788,9.788,0,0,0,12,17.883a9.787,9.787,0,0,0,8.78-5.176,1.584,1.584,0,0,0,0-1.414h0A9.787,9.787,0,0,0,12,6.117Z"/>
      <path  d="M12,16.049A4.049,4.049,0,1,1,16.049,12,4.054,4.054,0,0,1,12,16.049Zm0-7.1A3.049,3.049,0,1,0,15.049,12,3.052,3.052,0,0,0,12,8.951Z"/>
      <circle  cx="12" cy="12" r="2.028"/>
    </g>
  </g>
</svg>
            <time class="article-words">
                <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span> &nbspReads</span>
            </time>
        </div>
    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://huizhou92.com/zh-cn/p/swisstable-%E4%BC%9A%E6%88%90%E4%B8%BA-golang-std-map%E5%98%9B/" class="link">中文</a>
                
            </div>
        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="introduction">Introduction
</h2><p>In 2022, ByteDance proposed an <a class="link" href="https://github.com/golang/go/issues/54766"  target="_blank" rel="noopener"
    >issue</a> recommending that <code>Golang</code> adopt SwissTable for its map implementation. In 2023, Dolt published a blog post titled <a class="link" href="https://www.dolthub.com/blog/2023-03-28-swiss-map/"  target="_blank" rel="noopener"
    >SwissMap: A Smaller, Faster Golang Hash Table</a>, detailing their design of a <code>swisstable</code>, which garnered widespread attention. The Go core team is reevaluating the <code>swisstable</code> design and has added some related code in the <a class="link" href="https://github.com/golang/go/blob/6a730e1ef0b7f312fe01815086a2eb5a25739f2d/src/runtime/map_swiss.go#L7"  target="_blank" rel="noopener"
    ><code>runtime</code></a>. With some free time during the holidays, let&rsquo;s delve deeper into the principles, compare it to the <code>runtime map</code>, and understand why it might become the standard for <code>map</code> implementation.</p>
<!-- more-->
<blockquote>
<p>This article was first published in the Medium MPP plan. If you are a Medium user, please follow me on <a class="link" href="https://medium.huizhou92.com/"  target="_blank" rel="noopener"
    >Medium</a>. Thank you very much.</p>
</blockquote>
<p>This article will not fully explain the principles of <code>hashtable</code> or <code>swisstable</code>. A basic understanding of <code>hashtable</code> is required.</p>
<p>A <code>hashtable</code> provides a mapping from a <code>key</code> to a corresponding <code>value</code> by converting the <code>key</code> to some &ldquo;position&rdquo; using a <code>hash function</code>. From this position, we can directly retrieve the desired value.</p>
<h2 id="traditional-hashtable">Traditional <code>Hashtable</code>
</h2><p>A <code>hashtable</code> provides a mapping from a <code>key</code> to a corresponding value by converting the key to some &ldquo;position&rdquo; using a hash function. However, even if the hash function is perfect, conflicts are still inevitable when mapping an infinite number of keys into a finite memory space: two different keys will be mapped to the same position. To solve this, traditional hashtables have several conflict resolution strategies, most commonly <code>chaining</code> and <code>linear probing</code>.</p>
<h3 id="chaining">Chaining
</h3><p>Chaining is the most common method where if multiple keys map to the same position, these keys and values are stored in a linked list. During lookups, the hash function is used to find the position, and then the linked list at that position is traversed to find the matching key. Its structure is similar to this:</p>
<p><strong>Figure 1: Chaining implementation of <code>hashtable</code></strong><br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/096dbea584499aaf3f2adb6111a89b0e.png"
	
	
	
	loading="lazy"
	
		alt="Pasted image 20240929145217"
	
	
></p>
<p>Chaining is straightforward to implement, with fewer boundary conditions to consider. Data insertion and deletion are quick, using head insertion to add new entries and adjusting the next pointer for deletion. Chaining can also prevent performance degradation by converting overly long chains into search trees. However, chaining is not cache-friendly, and performance can be affected if there are many conflicts. Different <code>slots</code> can be widely spread in memory, leading to poor spatial locality of the data structure overall.</p>
<h3 id="linear-probing">Linear Probing
</h3><p>Linear probing is another standard hash table conflict resolution method. Unlike chaining, when a hash conflict occurs, it searches sequentially from the conflict position until it finds an empty slot or loops back to the conflict position. At this point, it resizes and rehashes the entries.</p>
<p><strong>Figure 2: Linear probing animation</strong><br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/bfb5cfbb7f611f0fed2f4d58c0eceaf4.gif"
	
	
	
	loading="lazy"
	
		alt="Linear probing"
	
	
></p>
<p>Lookups work similarly: calculate the hash position for the key and then compare each key starting from that position, skipping any deleted entries until an empty slot is reached, indicating the key is not in the table. Deletion uses a tombstone marker.</p>
<p><strong>Figure 3: Linear probing lookup animation</strong><br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/f0052b66a4e66fb5e9558c4e48601bd7.gif"
	
	
	
	loading="lazy"
	
		alt="Linear probing lookup"
	
	
></p>
<p>Linear probing has comparable time complexity to chaining. Its advantages include being cache-friendly and implementable with tight data structures like arrays. However, its drawbacks are:</p>
<ol>
<li>Complex implementation with three states for a <code>slot</code>: occupied, empty, and deleted.</li>
<li>Chain reaction of conflicts, leading to more frequent resizing than chaining and potentially more significant memory usage.</li>
<li>Higher likelihood of lookup process degradation to <code>O(n)</code> without the ability to convert heavily conflicted areas into search trees.</li>
</ol>
<p>Many libraries use chaining due to the difficulties with element deletion and conflict chain reactions in linear probing. Despite its drawbacks, linear probing&rsquo;s cache friendliness and memory efficiency provide significant performance advantages on modern computers, leading to its use in languages like <code>golang</code> and <code>Python</code>.</p>
<h3 id="go-map-data-storage">Go Map Data Storage
</h3><p>Let&rsquo;s recap how <code>Go Map</code> stores data:</p>
<p>**Figure 4: Go map **<br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/02e000848c6f7972b40e08647618d409.png"
	
	
	
	loading="lazy"
	
		alt="Pasted image 20240927142057"
	
	
></p>
<p>Quick summary:</p>
<ul>
<li>Go <code>map</code> uses a hash function to map keys to multiple <code>buckets</code>, each with a fixed number of key-value <code>slots</code> for storage.</li>
<li>Each <code>bucket</code> stores up to 8 key-value pairs. The conflicting keys and values are stored within the same bucket when conflicts occur.</li>
<li>The map uses a hash function to compute the key&rsquo;s hash value and locate the corresponding <code>bucket</code>.</li>
<li>If a <code>bucket</code> is complete (all 8 <code>slots</code> used), an <code>overflow bucket</code> is generated to continue storing new key-value pairs.</li>
<li>For lookups, the key&rsquo;s hash value is calculated, the corresponding <code>bucket</code> is determined, and each <code>slot</code> within the <code>bucket</code> is checked. If there is an <code>overflow bucket</code>, its keys are also checked sequentially.</li>
</ul>
<h2 id="swisstable-an-efficient-hashtable-implementation">SwissTable: An Efficient Hashtable Implementation
</h2><p><code>SwissTable</code> is a <code>hashtable</code> implementation based on an improved linear probing method. Its core idea is to optimize performance and memory usage by enhancing the <code>hashtable</code> structure and metadata storsage. SwissTable uses a new metadata control mechanism to significantly reduce unnecessary <code>key</code> comparisons and leverages SIMD instructions to boost throughput.</p>
<p>Reviewing the two standard <code>hashtable</code> implementations shows they either waste memory, need to be cache-friendly or suffer performance drops in lookup, insertion, and deletion operations after conflicts. These issues persist even with a &ldquo;perfect hash function.&rdquo; Using a suboptimal hash function dramatically increases the probability of key conflicts and worsens performance, possibly even falling short of linear searches in an array.</p>
<p>The industry sought a hash table algorithm that was friendly to cache and resistant to lookup performance degradation. Many focused on developing better hash functions close to &ldquo;perfect hash function&rdquo; quality while optimizing calculation performance; others worked on improving the hash table&rsquo;s structure to balance cache friendliness, performance, and memory usage. <a class="link" href="https://abseil.io/about/design/swisstables"  target="_blank" rel="noopener"
    ><code>swisstable</code></a> belongs to the latter.</p>
<p><code>SwissTable</code>&rsquo;s time complexity is similar to linear probing, while its space complexity is between chaining and linear probing. The implementation I&rsquo;ve referenced is primarily based on <a class="link" href="https://github.com/dolthub/swiss/tree/main"  target="_blank" rel="noopener"
    >dolthub/swiss</a>.</p>
<h3 id="basic-structure-of-swisstable">Basic Structure of SwissTable
</h3><p>Although the name has changed, <code>swisstable</code> is still a <code>hashtable</code> utilizing an improved linear probing method for hash collisions. Its underlying structure resembles an array. Now, let&rsquo;s delve into the structure of <code>swisstable</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Map</span><span class="p">[</span><span class="nx">K</span> <span class="nx">comparable</span><span class="p">,</span> <span class="nx">V</span> <span class="nx">any</span><span class="p">]</span> <span class="kd">struct</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">ctrl</span>     <span class="p">[]</span><span class="nx">metadata</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">groups</span>   <span class="p">[]</span><span class="nx">group</span><span class="p">[</span><span class="nx">K</span><span class="p">,</span> <span class="nx">V</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">hash</span>     <span class="nx">maphash</span><span class="p">.</span><span class="nx">Hasher</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">resident</span> <span class="kt">uint32</span>   
</span></span><span class="line"><span class="cl">    <span class="nx">dead</span>     <span class="kt">uint32</span>   
</span></span><span class="line"><span class="cl">    <span class="nx">limit</span>    <span class="kt">uint32</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">metadata</span> <span class="p">[</span><span class="nx">groupSize</span><span class="p">]</span><span class="kt">int8</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">group</span><span class="p">[</span><span class="nx">K</span> <span class="nx">comparable</span><span class="p">,</span> <span class="nx">V</span> <span class="nx">any</span><span class="p">]</span> <span class="kd">struct</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">keys</span>   <span class="p">[</span><span class="nx">groupSize</span><span class="p">]</span><span class="nx">K</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">values</span> <span class="p">[</span><span class="nx">groupSize</span><span class="p">]</span><span class="nx">V</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In <code>swisstable</code>, <code>ctrl</code> is an array of <code>metadata</code>, corresponding to the <code>group[K, V]</code> array. Each <code>group</code> has 8 <code>slots</code>.</p>
<p>The hash is divided into <code>57 bits</code> for H1 to determine the starting <code>groups</code>, and the remaining <code>7 bits</code> called H2, stored in <code>metadata</code> as the hash signature of the current key for subsequent search and filtering.</p>
<p>The key advantage of <code>swisstable</code> over traditional hash tables lies in the metadata called <code>ctrl</code>. Control information includes:</p>
<ul>
<li>Whether a slot is empty: <code>0b10000000</code></li>
<li>Whether a slot has been deleted: <code>0b11111110</code></li>
<li>The key&rsquo;s hash signature (H2) in a slot: <code>0bh2</code></li>
</ul>
<p>The unique values of these states allow the use of SIMD instructions, maximizing performance.</p>
<h3 id="adding-data">Adding Data
</h3><p>The process of adding data in <code>swisstable</code> involves several steps:</p>
<ol>
<li>Calculate the hash value and split it into <code>h1</code> and <code>h2</code>. Using <code>h1</code>, determine the starting groups.</li>
<li>Use <code>metaMatchH2</code> to check the current group&rsquo;s <code>metadata</code> for a matching <code>h2</code>. If found, further check for the matching key and update the value if they match.</li>
<li>If no matching key is found, use <code>metaMatchEmpty</code> to check for empty <code>slots</code> in the current group. Insert the new key-value pair if an empty slot is found and update the <code>metadata</code> and <code>resident</code> count.</li>
<li>If no empty slots are available in the current group, perform linear probing to check the next <code>groups</code>.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">Map</span><span class="p">[</span><span class="nx">K</span><span class="p">,</span> <span class="nx">V</span><span class="p">])</span> <span class="nf">Put</span><span class="p">(</span><span class="nx">key</span> <span class="nx">K</span><span class="p">,</span> <span class="nx">value</span> <span class="nx">V</span><span class="p">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">m</span><span class="p">.</span><span class="nx">resident</span> <span class="o">&gt;=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">limit</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">        <span class="nx">m</span><span class="p">.</span><span class="nf">rehash</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nf">nextSize</span><span class="p">())</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">hi</span><span class="p">,</span> <span class="nx">lo</span> <span class="o">:=</span> <span class="nf">splitHash</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nf">Hash</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">g</span> <span class="o">:=</span> <span class="nf">probeStart</span><span class="p">(</span><span class="nx">hi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">{</span> <span class="c1">// inlined find loop  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">matches</span> <span class="o">:=</span> <span class="nf">metaMatchH2</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">m</span><span class="p">.</span><span class="nx">ctrl</span><span class="p">[</span><span class="nx">g</span><span class="p">],</span> <span class="nx">lo</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nx">matches</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">            <span class="nx">s</span> <span class="o">:=</span> <span class="nf">nextMatch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">matches</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">keys</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">{</span> <span class="c1">// update  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">keys</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">key</span>  
</span></span><span class="line"><span class="cl">                <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">values</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">value</span>  
</span></span><span class="line"><span class="cl">                <span class="k">return</span>  
</span></span><span class="line"><span class="cl">            <span class="p">}</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>  
</span></span><span class="line"><span class="cl">        <span class="nx">matches</span> <span class="p">=</span> <span class="nf">metaMatchEmpty</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">m</span><span class="p">.</span><span class="nx">ctrl</span><span class="p">[</span><span class="nx">g</span><span class="p">])</span>  
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nx">matches</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span> <span class="c1">// insert  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">s</span> <span class="o">:=</span> <span class="nf">nextMatch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">matches</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">            <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">keys</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">key</span>  
</span></span><span class="line"><span class="cl">            <span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">[</span><span class="nx">g</span><span class="p">].</span><span class="nx">values</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nx">value</span>  
</span></span><span class="line"><span class="cl">            <span class="nx">m</span><span class="p">.</span><span class="nx">ctrl</span><span class="p">[</span><span class="nx">g</span><span class="p">][</span><span class="nx">s</span><span class="p">]</span> <span class="p">=</span> <span class="nb">int8</span><span class="p">(</span><span class="nx">lo</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">            <span class="nx">m</span><span class="p">.</span><span class="nx">resident</span><span class="o">++</span>  
</span></span><span class="line"><span class="cl">            <span class="k">return</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>  
</span></span><span class="line"><span class="cl">        <span class="nx">g</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">// linear probing  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="nx">g</span> <span class="o">&gt;=</span> <span class="nb">uint32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">groups</span><span class="p">))</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">            <span class="nx">g</span> <span class="p">=</span> <span class="mi">0</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">metaMatchH2</span><span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">metadata</span><span class="p">,</span> <span class="nx">h</span> <span class="nx">h2</span><span class="p">)</span> <span class="nx">bitset</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">hasZeroByte</span><span class="p">(</span><span class="nf">castUint64</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">^</span> <span class="p">(</span><span class="nx">loBits</span> <span class="o">*</span> <span class="nb">uint64</span><span class="p">(</span><span class="nx">h</span><span class="p">)))</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">nextMatch</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">bitset</span><span class="p">)</span> <span class="kt">uint32</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">s</span> <span class="o">:=</span> <span class="nb">uint32</span><span class="p">(</span><span class="nx">bits</span><span class="p">.</span><span class="nf">TrailingZeros64</span><span class="p">(</span><span class="nb">uint64</span><span class="p">(</span><span class="o">*</span><span class="nx">b</span><span class="p">)))</span>  
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nx">b</span> <span class="o">&amp;=</span> <span class="p">^(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="nx">s</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">s</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Although the steps are few, they involve complex bit operations. Normally, <code>h2</code> needs to be compared with all keys sequentially until the target is found. <code>swisstable</code> cleverly achieves this by:</p>
<ul>
<li>Multiplying <code>h2</code> by <code>0x0101010101010101</code> to get a uint64, allowing simultaneous comparison with 8 <code>ctrl</code> values.</li>
<li>Performing <code>xor</code> with <code>meta</code>. If <code>h2</code> exists in <code>metadata</code>, the corresponding bit will be zero. The <code>metaMatchH2</code> function helps us understand this process.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestMetaMatchH2</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">metaData</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="nx">metadata</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">metaData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="kt">int8</span><span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">m</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">metaData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">h</span> <span class="o">:=</span> <span class="mh">0x7f</span>
</span></span><span class="line"><span class="cl">    <span class="nx">metaUint64</span> <span class="o">:=</span> <span class="nf">castUint64</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">h2Pattern</span> <span class="o">:=</span> <span class="nx">loBits</span> <span class="o">*</span> <span class="nb">uint64</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">xorResult</span> <span class="o">:=</span> <span class="nx">metaUint64</span> <span class="p">^</span> <span class="nx">h2Pattern</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;metaUint64: %b\n&#34;</span><span class="p">,</span> <span class="nx">xorResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">r</span> <span class="o">:=</span> <span class="nf">hasZeroByte</span><span class="p">(</span><span class="nx">xorResult</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;r: %b\n&#34;</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">r</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nf">nextMatch</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">r</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">----</span>
</span></span><span class="line"><span class="cl"><span class="nx">output</span>
</span></span><span class="line"><span class="cl"><span class="c1">// metaUint64: 00000000 11111110 11111110 11111110 0000000 01111111 01111111 00000000
</span></span></span><span class="line"><span class="cl"><span class="c1">// r: 10000000 00000000 00000000 00000000 10000000 00000000 00000000 10000000
</span></span></span><span class="line"><span class="cl"><span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1">// 3
</span></span></span><span class="line"><span class="cl"><span class="c1">// 7
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="advantages-of-swisstable">Advantages of SwissTable
</h3><p>Reviewing SwissTable implementation reveals several key benefits:</p>
<ul>
<li>Operations are shifted from <code>slots</code> to <code>ctrl</code>, which are smaller and easily placed in the CPU cache, speeding up operations despite the additional step of locating <code>slots</code>.</li>
<li>Records hash signatures, reducing meaningless key comparisons—the main cause of linear probing performance drops.</li>
<li>Batch operations on <code>ctrl</code> for <code>slots</code> increase throughput significantly.</li>
<li>Metadata and memory layout are optimized for SIMD instructions, maximizing performance.</li>
<li><code>Slot</code> optimizations, such as compressing large data, increase cache hit rates.</li>
</ul>
<p><code>swisstable</code> solves spatial locality issues and exploits modern CPU features for batch element operations, significantly boosting performance.</p>
<p>Finally, running a benchmark on a local MacBook M1 (without SIMD support) shows significant performance improvements in large map scenarios.</p>
<p><strong>Figure 5: Official <code>swisstable</code> benchmark</strong><br>
<img src="https://images.hxzhouh.com/blog-images/2024/09/a59e237341d6076ed79395bd1d1b5f90.png"
	
	
	
	loading="lazy"
	
		alt="Pasted image 20240930110905"
	
	
></p>
<h2 id="conclusion">Conclusion
</h2><p>Currently, the official implementation of <code>swisstable</code> in Go is still under discussion, and there are a few community implementations like <a class="link" href="https://github.com/mhmtszr/concurrent-swiss-map"  target="_blank" rel="noopener"
    >concurrent-swiss-map</a> and <a class="link" href="https://github.com/dolthub/swiss"  target="_blank" rel="noopener"
    >swiss</a>. However, they are not perfect; in small map scenarios, <code>swisstable</code> may even underperform compared to <code>runtime_map</code>. Nonetheless, the potential demonstrated by <code>swisstable</code> in other languages indicates that it is worth anticipation.</p>
<h2 id="references">References
</h2><ul>
<li>Dolthub: <a class="link" href="https://www.dolthub.com/blog/2023-03-28-swiss-map/"  target="_blank" rel="noopener"
    >SwissMap</a></li>
<li>SwissTable principles: <a class="link" href="https://abseil.io/about/design/swisstables"  target="_blank" rel="noopener"
    >Abseil SwissTables</a></li>
<li>Original SwissTable proposal at cppcon: <a class="link" href="https://www.youtube.com/watch?v=ncHmEUmJZf4"  target="_blank" rel="noopener"
    >cppcon talk</a></li>
<li>Improvements to SwissTable algorithm: <a class="link" href="https://www.youtube.com/watch?v=JZE3_0qvrMg"  target="_blank" rel="noopener"
    >YouTube link</a></li>
<li>Bit manipulation primer: <a class="link" href="http://graphics.stanford.edu/~seander/bithacks.html##ValueInWord"  target="_blank" rel="noopener"
    >Stanford Bit Hacks</a></li>
<li>Hash function comparisons: <a class="link" href="https://aras-p.info/blog/2016/08/09/More-Hash-Function-Tests/"  target="_blank" rel="noopener"
    >Hash function tests</a></li>
<li>An additional bit manipulation article: <a class="link" href="https://lemire.me/blog/2016/06/27/a-fast-alternative-to-the-modulo-reduction/"  target="_blank" rel="noopener"
    >Fast Modulo Reduction</a></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/golang/">Golang</a>
        
            <a href="/tags/map/">Map</a>
        
            <a href="/tags/swissmap/">Swissmap</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on Sep 30, 2024 11:45 CST
        </span>
    </section></footer>


    
</article>

    

    

<ins class="adsbygoogle"
   style="display:block"
   data-ad-client="ca-pub-9000447749076746"
   data-ad-slot="5063552270"
   data-ad-format="auto"
   data-full-width-responsive="true"></ins>
<script>
   (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/htmx-first-experience/">
        
        
            <div class="article-image">
                
                    <img src="https://images.hxzhouh.com/blog-images/2025/01/e6c9c9915295ea19685f460d4e7e13e5.png" loading="lazy" data-key="" data-hash="https://images.hxzhouh.com/blog-images/2025/01/e6c9c9915295ea19685f460d4e7e13e5.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HTMX First Experience</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/go-1.24-new-std-lib-synctest/">
        
        
            <div class="article-image">
                
                    <img src="https://images.hxzhouh.com/blog-images/2024/12/260aeb6207be4b765d34328515c144dc.png" loading="lazy" data-key="" data-hash="https://images.hxzhouh.com/blog-images/2024/12/260aeb6207be4b765d34328515c144dc.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Go 1.24: New STD-lib synctest</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/go1.24-new-std-lib-os.root/">
        
        

        <div class="article-details">
            <h2 class="article-title">GO1.24: New Std-Lib os.Root</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/bigcache-high-performance-memory-caching-in-go/">
        
        
            <div class="article-image">
                
                    <img src="https://images.hxzhouh.com/blog-images/2024/12/d1288ea91074f2a22a8ac4fec04d8b90.png" loading="lazy" data-key="" data-hash="https://images.hxzhouh.com/blog-images/2024/12/d1288ea91074f2a22a8ac4fec04d8b90.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">BigCache: High-Performance Memory Caching in Go</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/go-high-performance-programming-ep10-two-useful-golang-lock-free-programming-tips/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go High-Performance Programming EP10: Two Useful Golang Lock-Free Programming Tips</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>


    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2025 Copyright © 2023 huizhou92
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
    <script src="/js/adblock-detection.js" defer></script>
     
	
	<div class="busuanzi-footer">
	<span id="busuanzi_container_site_pv">
		Total site visits: <span id="busuanzi_value_site_pv"></span>
	</span>
	<span id="busuanzi_container_site_uv">
		Total Visitors: <span id="busuanzi_value_site_uv"></span>
	</span>
	</div></footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
